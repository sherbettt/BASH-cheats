Основные команды Aptly:

## **Работа с локальными репозиториями**

```bash
# Список локальных репозиториев
aptly repo list

# Создать новый репозиторий
aptly repo create имя-репозитория

# Показать информацию о репозитории
aptly repo show имя-репозитория

# Добавить пакеты в репозиторий
aptly repo add имя-репозитория /путь/к/пакетам/

# Добавить пакеты и удалить исходные файлы
aptly repo add -remove-files имя-репозитория /путь/к/пакетам/

# Удалить пакеты из репозитория
aptly repo remove имя-репозитория "пакет(=версия)"

# Поиск пакетов в репозитории
aptly repo search имя-репозитория "запрос"

# Очистить репозиторий
aptly repo cleanup имя-репозитория
```

## **Публикация репозиториев**

```bash
# Список опубликованных репозиториев
aptly publish list

# Опубликовать локальный репозиторий
aptly publish repo имя-локального-репозитория дистрибутив

# Пример: опубликовать репозиторий runtel-bookworm как bookworm
aptly publish repo runtel-bookworm bookworm

# Обновить опубликованный репозиторий
aptly publish update дистрибутив

# Пример: обновить published репозиторий bookworm
aptly publish update bookworm

# Удалить опубликованный репозиторий
aptly publish drop дистрибутив

# Переместить опубликованный репозиторий
aptly publish switch дистрибутив новый-репозиторий
```

## **Снимки (снапшоты)**

```bash
# Создать снимок репозитория
aptly snapshot create имя-снимка from repo имя-репозитория

# Список снимков
aptly snapshot list

# Опубликовать снимок
aptly publish snapshot имя-снимка дистрибутив

# Объединить снимки
aptly snapshot merge имя-нового-снимка снимок1 снимок2
```

## **Отображение и поиск**

```bash
# Поиск пакетов во всех репозиториях
aptly package search "запрос"

# Показать детали пакета
aptly package show имя-пакета

# Отобразить зависимости пакета
aptly package depends имя-пакета
```

## **Экспорт/Импорт**

```bash
# Экспорт репозитория или снимка
aptly repo export имя-репозитория файл.json

# Импорт репозитория
aptly repo import файл.json имя-нового-репозитория
```

## **Очистка и обслуживание**

```bash
# Очистить кэш
aptly db cleanup

# Проверить целостность базы данных
aptly db recover

# Показать статистику
aptly db stats
```

## **Полезные комбинации**

```bash
# Добавить все DEB файлы из директории и опубликовать
aptly repo add -remove-files runtel-bookworm /tmp/debs/ && aptly publish update bookworm

# Посмотреть все пакеты в репозитории
aptly repo show -with-packages имя-репозитория

# Проверить наличие конкретного пакета
aptly repo search имя-репозитория "пакет"

# Удалить старые версии пакета
aptly repo remove имя-репозитория "пакет (<< версия)"

# Создать и опубликовать снимок для бэкапа
aptly snapshot create backup-$(date +%Y%m%d) from repo имя-репозитория
aptly publish snapshot backup-$(date +%Y%m%d) дистрибутив-backup
```

## **Проверка состояния**

```bash
# Проверить все опубликованные репозитории
aptly publish list

# Проверить все локальные репозитории
aptly repo list

# Проверить конкретный репозиторий
aptly repo show имя-репозитория

# Проверить наличие пакета
aptly package show имя-пакета
```

## **Ваши текущие репозитории:**
```bash
# PROD репозитории
aptly repo show runtel-bookworm      # Debian 12 PROD
aptly repo show runtel-bullseye      # Debian 11 PROD  
aptly repo show runtel-astra         # Astra PROD

# DEV репозитории
aptly repo show runtel-bookworm-dev  # Debian 12 DEV
aptly repo show runtel-bullseye-dev  # Debian 11 DEV
aptly repo show runtel-astra-dev     # Astra DEV
```



------------------------
Вводные данные 
```bash
www-data@a60:/root$ aptly repo list
List of local repos:
 * [runtel-astra-dev] (packages: 0)
 * [runtel-astra] (packages: 428)
 * [runtel-bookworm-dev] (packages: 11)
 * [runtel-bookworm] (packages: 471)
 * [runtel-bullseye-dev] (packages: 0)
 * [runtel-bullseye] (packages: 489)
 * [runtel] (packages: 28)

To get more information about local repository, run `aptly repo show <name>`.

www-data@a60:/root$ aptly repo show runtel-bookworm-dev
Name: runtel-bookworm-dev
Comment: 
Default Distribution: 
Default Component: main
Number of packages: 11

www-data@a60:/root$ aptly repo show runtel-bookworm
Name: runtel-bookworm
Comment: 
Default Distribution: 
Default Component: main
Number of packages: 471
```

Видно, что:
1. **`runtel-bookworm-dev`** существует и содержит 11 пакетов ✓
2. **`runtel-bookworm`** существует и содержит 471 пакет ✓

**Проблема:** Опубликованный репозиторий `bookworm-dev` не создан!

**Проверьте опубликованные репозитории:**
```bash
aptly publish list

www-data@a60:/root$ aptly publish list
Published repositories:
  * ./1.7_x86-64 [amd64] publishes {main: [runtel-astra]}
  * ./bookworm [amd64] publishes {main: [runtel-bookworm]}
  * ./bullseye [amd64] publishes {main: [runtel-bullseye]}
  * ./buster [amd64] publishes {main: [runtel]}
```

**Решения:**

**Вариант 1: Создать опубликованный DEV репозиторий:**
```bash
aptly publish repo runtel-bookworm-dev bookworm-dev
```

**Проверьте сейчас:** выполните первый вариант (создать вручную), чтобы DEV сборки сразу заработали:
```bash
aptly publish repo runtel-bookworm-dev bookworm-dev
```

**После этого проверьте:**
```bash
aptly publish list
```

Должно появиться:
```
...
* bookworm [amd64] publishes {runtel-bookworm: [bookworm]}
* bookworm-dev [amd64] publishes {runtel-bookworm-dev: [bookworm-dev]}
...
```

**Также проверьте другие репозитории:** возможно у `runtel-astra-dev`, `runtel-bullseye-dev` та же проблема.

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —É—Ç–∏–ª–∏—Ç—ã `mount` –≤ Linux
–£—Ç–∏–ª–∏—Ç–∞ `mount` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤—ã—Ö —Å–∏—Å—Ç–µ–º (—Ä–∞–∑–¥–µ–ª–æ–≤ –¥–∏—Å–∫–æ–≤, —Å–µ—Ç–µ–≤—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤ –∏ —Ç.–¥.) –∫ –∫–∞—Ç–∞–ª–æ–≥—É –≤ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ Linux.

#### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:
1. **–ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö —Å–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤—ã—Ö —Å–∏—Å—Ç–µ–º**  
   ```bash
   mount
   ```
   - **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –≤—ã–≤–æ–¥–∞** (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ç–æ–ª—å–∫–æ ext4):  
     ```bash
     mount -t ext4
     ```
     ```bash
     # —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ç–∏–ø—É —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã
     mount | grep -E '^/dev'
     ```

2. **–ú–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞**  
   ```bash
   mount /dev/sdX# /–ø—É—Ç—å/–∫/—Ç–æ—á–∫–µ_–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
   ```
   - –ü—Ä–∏–º–µ—Ä:  
     ```bash
     mount /dev/sdb1 /mnt/mydrive
     ```

3. **–ú–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º —Ç–∏–ø–∞ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã**  
   ```bash
   mount -t —Ç–∏–ø_—Ñ—Å /dev/sdX# /—Ç–æ—á–∫–∞_–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
   ```
   - –ü—Ä–∏–º–µ—Ä (–¥–ª—è NTFS):  
     ```bash
     mount -t ntfs /dev/sdc1 /mnt/win
     ```

4. **–ú–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –æ–ø—Ü–∏—è–º–∏**  
   ```bash
   mount -o –æ–ø—Ü–∏–∏ /dev/sdX# /—Ç–æ—á–∫–∞_–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
   ```
   - –ü—Ä–∏–º–µ—Ä—ã –æ–ø—Ü–∏–π:  
     ```bash
     mount -o ro /dev/sdb1 /mnt/readonly  # —Ç–æ–ª—å–∫–æ –¥–ª—è —á—Ç–µ–Ω–∏—è
     mount -o remount,rw /                 # –ø–µ—Ä–µ–º–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ—Ä–µ–Ω—å –≤ —Ä–µ–∂–∏–º–µ –∑–∞–ø–∏—Å–∏
     ```

5. **–ú–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤—ã—Ö —Å–∏—Å—Ç–µ–º –∏–∑ `/etc/fstab`**  
   ```bash
   mount -a
   ```

6. **–†–∞–∑–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**  
   ```bash
   umount /—Ç–æ—á–∫–∞_–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è  # –∏–ª–∏
   umount /dev/sdX#
   ```

---

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —É—Ç–∏–ª–∏—Ç—ã `findmnt` –≤ Linux
–£—Ç–∏–ª–∏—Ç–∞ `findmnt` –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö –≤ —É–¥–æ–±–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ (–≤ –≤–∏–¥–µ –¥–µ—Ä–µ–≤–∞ –∏–ª–∏ —Å–ø–∏—Å–∫–∞).

#### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:
1. **–í—ã–≤–æ–¥ –≤—Å–µ—Ö —Å–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –§–° –≤ –≤–∏–¥–µ –¥–µ—Ä–µ–≤–∞**  
   ```bash
   findmnt
   ```

2. **–í—ã–≤–æ–¥ –≤ –≤–∏–¥–µ —Å–ø–∏—Å–∫–∞**  
   ```bash
   findmnt -l
   ```

3. **–ü–æ–∏—Å–∫ –ø–æ —Ç–æ—á–∫–µ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è**  
   ```bash
   findmnt /—Ç–æ—á–∫–∞_–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
   ```
   - –ü—Ä–∏–º–µ—Ä:  
     ```bash
     findmnt /mnt/mydrive
     ```

4. **–ü–æ–∏—Å–∫ –ø–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤—É**  
   ```bash
   findmnt /dev/sdX#
   ```
   - –ü—Ä–∏–º–µ—Ä:  
     ```bash
     findmnt /dev/sdb1
     ```

5. **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ç–∏–ø—É —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã**  
   ```bash
   findmnt -t —Ç–∏–ø_—Ñ—Å
   ```
   - –ü—Ä–∏–º–µ—Ä (–ø–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ NFS):  
     ```bash
     findmnt -t nfs
     ```

6. **–í—ã–≤–æ–¥ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –≤ JSON**  
   ```bash
   findmnt --json
   ```

7. **–ü–æ–∏—Å–∫ –≤ `/etc/fstab`** (–Ω–µ —Å–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã)  
   ```bash
   findmnt --fstab
   ```

---

### –ü—Ä–∏–º–µ—Ä—ã —Å–æ–≤–º–µ—Å—Ç–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
1. **–ú–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞**  
   ```bash
   mount /dev/sdb1 /mnt/data && findmnt /mnt/data
   ```

2. **–ü–æ–∏—Å–∫ –≤—Å–µ—Ö —Å–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö ext4-—Ä–∞–∑–¥–µ–ª–æ–≤**  
   ```bash
   findmnt -t ext4
   ```

3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–Ω—è—Ç–æ—Å—Ç–∏ —Ç–æ—á–∫–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–µ—Ä–µ–¥ —Ä–∞–∑–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º**  
   ```bash
   findmnt /mnt/data  # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ –ª–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ
   umount /mnt/data   # –†–∞–∑–º–æ–Ω—Ç–∏—Ä—É–µ–º, –µ—Å–ª–∏ –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
   ```
----------------------------------
----------------------------------
–ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø—Ä–∏–º–µ—Ä —Å Jira –∫–ª–∞—Å—Ç–µ—Ä–æ–º –∏–∑ —Å—Ç–∞—Ç—å–∏ [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Jira Data Center cluster](https://github.com/sherbettt/BASH-cheats/blob/main/System%20engineering/18.%20–ù–∞—Å—Ç—Ä–æ–π–∫–∞%20Jira%20Data%20Center%20cluster.md)
–ö–∞–∫ –¥–æ–ª–∂–Ω–æ –±—ã–ª–æ –±—ã—Ç—å –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ.

### üéØ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ–±—â–∞—è NFS-–ø–∞–ø–∫–∞ –≤ –≤–∞—à–µ–º –∫–ª–∞—Å—Ç–µ—Ä–µ

**–¢–µ–∫—É—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**
1. **NFS-—Å–µ—Ä–≤–µ—Ä**: pmx5 (192.168.87.3)  
   - –ü–∞–ø–∫–∞: `/stg/8tb/share/jira`
   - –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ NFS –≤—Å–µ–º —É–∑–ª–∞–º Jira

2. **NFS-–∫–ª–∏–µ–Ω—Ç—ã**:  
   - jira-new (192.168.87.17)
   - jira-node (192.168.46.3 ‚Üí 192.168.87.X?)
   - jira-node2 (192.168.46.4 ‚Üí 192.168.87.X?)
   - –ú–æ–Ω—Ç–∏—Ä—É—é—Ç –ø–∞–ø–∫—É –≤: `/var/atlassian/application-data/jira-shared`

---

### üîß –ö–∞–∫ —ç—Ç–æ –±—ã–ª–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ (–ø–æ—à–∞–≥–æ–≤–æ):

#### 1. **–ù–∞ —Å—Ç–æ—Ä–æ–Ω–µ ProxMox (NFS-—Å–µ—Ä–≤–µ—Ä)**
```bash
# 1. –°–æ–∑–¥–∞–ª–∏ –ø–∞–ø–∫—É –¥–ª—è —à–∞—Ä—ã
mkdir -p /stg/8tb/share/jira

# 2. –ù–∞—Å—Ç—Ä–æ–∏–ª–∏ —ç–∫—Å–ø–æ—Ä—Ç –≤ /etc/exports
/stg/8tb/share/jira 192.168.87.17(rw,sync,no_subtree_check)
/stg/8tb/share/jira 192.168.87.20(rw,sync,no_subtree_check)
/stg/8tb/share/jira 192.168.87.6(rw,sync,no_subtree_check)

# 3. –ó–∞–ø—É—Å—Ç–∏–ª–∏ NFS-—Å–µ—Ä–≤–µ—Ä
systemctl enable --now nfs-server
```

#### 2. **–ù–∞ —É–∑–ª–∞—Ö Jira (NFS-–∫–ª–∏–µ–Ω—Ç—ã)**
```bash
# 1. –°–æ–∑–¥–∞–ª–∏ —Ç–æ—á–∫—É –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
mkdir -p /var/atlassian/application-data/jira-shared

# 2. –î–æ–±–∞–≤–∏–ª–∏ –≤ /etc/fstab (–∏–ª–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–ª–∏ –≤—Ä—É—á–Ω—É—é)
192.168.87.3:/stg/8tb/share/jira /var/atlassian/application-data/jira-shared nfs rw,hard,intr 0 0

# 3. –ü—Ä–∏–º–µ–Ω–∏–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è
mount -a
```

---

### ‚ùå –ü—Ä–æ–±–ª–µ–º—ã –≤ —Ç–µ–∫—É—â–µ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–µ:
1. **–†–∞–∑–Ω—ã–µ UID/GID**:
   - –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ —Ñ–∞–π–ª—ã —Å–æ–∑–¥–∞—é—Ç—Å—è —Å UID=100000 (nobody)
   - –ù–∞ –∫–ª–∏–µ–Ω—Ç–∞—Ö Jira –æ–∂–∏–¥–∞–µ—Ç—Å—è UID=1000 (jira)

2. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –ø—Ä–∞–≤**:
   ```bash
   # –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:
   drwxrwxrwx 13 100000 100000  # –ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ –¥–ª—è jira (UID=1000)

   # –ù–∞ –∫–ª–∏–µ–Ω—Ç–µ:
   drwxrwxrwx 13 root root      # –î–æ–ª–∂–Ω–æ –±—ã—Ç—å jira:jira
   ```

3. **–ù–µ–ø–æ–ª–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ NFS**:
   - –ù–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ `all_squash,anonuid,anongid`
   - –†–∞–∑–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ NFS (v3/v4)

---

### ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ):

#### 1. –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ pmx5:
```bash
# –ò—Å–ø—Ä–∞–≤–ª—è–µ–º –≤–ª–∞–¥–µ–ª—å—Ü–∞
chown -R 1000:1000 /stg/8tb/share/jira

# –û–±–Ω–æ–≤–ª—è–µ–º /etc/exports
/stg/8tb/share/jira 192.168.87.17(rw,sync,no_subtree_check,all_squash,anonuid=1000,anongid=1000)
/stg/8tb/share/jira 192.168.87.20(rw,sync,no_subtree_check,all_squash,anonuid=1000,anongid=1000)
/stg/8tb/share/jira 192.168.87.6(rw,sync,no_subtree_check,all_squash,anonuid=1000,anongid=1000)

# –ü—Ä–∏–º–µ–Ω—è–µ–º
exportfs -ra
```

#### 2. –ù–∞ –≤—Å–µ—Ö —É–∑–ª–∞—Ö Jira:
```bash
# –û–±–Ω–æ–≤–ª—è–µ–º fstab
192.168.87.3:/stg/8tb/share/jira /var/atlassian/application-data/jira-shared nfs rw,hard,intr,vers=4.2,uid=1000,gid=1000 0 0

# –ü–µ—Ä–µ–º–æ–Ω—Ç–∏—Ä—É–µ–º
umount -l /var/atlassian/application-data/jira-shared
mount -a
```

#### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞:
```bash
# –ù–∞ –∫–ª–∏–µ–Ω—Ç–µ:
sudo -u jira touch /var/atlassian/application-data/jira-shared/test_file

# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:
ls -n /stg/8tb/share/jira/test_file  # –î–æ–ª–∂–Ω–æ –±—ã—Ç—å uid=1000
```

----------------------------------

–ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø—Ä–∏–º–µ—Ä —Å Jira –∫–ª–∞—Å—Ç–µ—Ä–æ–º –∏–∑ —Å—Ç–∞—Ç—å–∏ [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Jira Data Center cluster](https://github.com/sherbettt/BASH-cheats/blob/main/System%20engineering/18.%20–ù–∞—Å—Ç—Ä–æ–π–∫–∞%20Jira%20Data%20Center%20cluster.md)

<details>
<summary>‚ùó –î—É–±–ª–∏–∫–∞—Ç—ã –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è ‚ùó</summary>
   
```text
# prox4
192.168.87.17:/stg/8tb/share  on  /mnt/pve/nfs_storage         type  nfs4         (rw,relatime,vers=4.2,rsize=1048576,wsize=1048576,namlen=255,hard,proto=tcp,timeo=600,retrans=2,sec=sys,clientaddr=192.168.87.17,local_lock=none,addr=192.168.87.17)
192.168.87.17:/stg/8tb/share  on  /mnt/pve/nfs-storage         type  nfs4         (rw,relatime,vers=4.2,rsize=1048576,wsize=1048576,namlen=255,hard,proto=tcp,timeo=600,retrans=2,sec=sys,clientaddr=192.168.87.17,local_lock=none,addr=192.168.87.17)
192.168.87.3:/stg/8tb/share   on  /mnt/pve/nfs_storage         type  nfs4         (rw,relatime,vers=4.2,rsize=1048576,wsize=1048576,namlen=255,hard,proto=tcp,timeo=600,retrans=2,sec=sys,clientaddr=192.168.87.17,local_lock=none,addr=192.168.87.3)
192.168.87.3:/stg/8tb/share   on  /mnt/share                   type  nfs4         (rw,nosuid,relatime,vers=4.2,rsize=1048576,wsize=1048576,namlen=255,soft,proto=tcp,timeo=600,retrans=2,sec=sys,clientaddr=192.168.87.17,local_lock=none,addr=192.168.87.3)
tmpfs                         on  /run/user/0                  type  tmpfs        (rw,nosuid,nodev,relatime,size=13166004k,nr_inodes=3291501,mode=700,inode64)


# pmx5
192.168.87.17:/stg/8tb/share  on  /mnt/pve/nfs_storage         type  nfs4         (rw,relatime,vers=4.2,rsize=1048576,wsize=1048576,namlen=255,hard,proto=tcp,timeo=600,retrans=2,sec=sys,clientaddr=192.168.87.20,local_lock=none,addr=192.168.87.17)
192.168.87.3:/stg/8tb/share   on  /mnt/pve/nfs_storage         type  nfs4         (rw,relatime,vers=4.2,rsize=1048576,wsize=1048576,namlen=255,hard,proto=tcp,timeo=600,retrans=2,sec=sys,clientaddr=192.168.87.20,local_lock=none,addr=192.168.87.3)
192.168.87.3:/stg/8tb/share   on  /mnt/share                   type  nfs4         (rw,nosuid,relatime,vers=4.2,rsize=1048576,wsize=1048576,namlen=255,soft,proto=tcp,timeo=600,retrans=2,sec=sys,clientaddr=192.168.87.20,local_lock=none,addr=192.168.87.3)


# pmx6
192.168.87.17:/stg/8tb/share  on  /mnt/pve/nfs_storage         type  nfs4         (rw,relatime,vers=4.2,rsize=1048576,wsize=1048576,namlen=255,hard,proto=tcp,timeo=600,retrans=2,sec=sys,clientaddr=192.168.87.6,local_lock=none,addr=192.168.87.17)
192.168.87.17:/stg/8tb/share  on  /mnt/share                   type  nfs4         (rw,relatime,vers=4.2,rsize=1048576,wsize=1048576,namlen=255,hard,proto=tcp,timeo=600,retrans=2,sec=sys,clientaddr=192.168.87.6,local_lock=none,addr=192.168.87.17)
192.168.87.3:/stg/8tb/share   on  /mnt/pve/nfs_storage         type  nfs4         (rw,relatime,vers=4.2,rsize=1048576,wsize=1048576,namlen=255,hard,proto=tcp,timeo=600,retrans=2,sec=sys,clientaddr=192.168.87.6,local_lock=none,addr=192.168.87.3)
192.168.87.3:/stg/8tb/share   on  /mnt/share                   type  nfs4         (rw,relatime,vers=4.2,rsize=1048576,wsize=1048576,namlen=255,hard,proto=tcp,timeo=600,retrans=2,sec=sys,clientaddr=192.168.87.6,local_lock=none,addr=192.168.87.3)
/dev/fuse                     on  /etc/pve                     type  fuse         (rw,nosuid,nodev,relatime,user_id=0,group_id=0,default_permissions,allow_other)

```
</details>



### –ü–æ–ª–Ω–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤—ã—Å–æ–∫–æ–¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ NFS-–∫–ª–∞—Å—Ç–µ—Ä–∞ —Å –ø–ª–∞–≤–∞—é—â–∏–º IP

#### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –≤—Å–µ—Ö —É–∑–ª–æ–≤ (prox4, pmx5, pmx6)

**–ù–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–µ—Ä–∞—Ö –≤—ã–ø–æ–ª–Ω–∏—Ç—å:**

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –ø–∞–∫–µ—Ç–æ–≤
apt update && apt install -y nfs-kernel-server keepalived

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ NFS
systemctl status nfs-kernel-server

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö NFS-–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–π
umount /mnt/share 2>/dev/null
umount /mnt/pve/nfs_storage 2>/dev/null
umount /mnt/pve/nfs-storage 2>/dev/null
```

#### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ NFS (–∞–∫—Ç—É–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)

**–ù–∞ –≤—Å–µ—Ö —É–∑–ª–∞—Ö –æ—Å—Ç–∞–≤–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π /etc/exports –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π:**

```bash
# /etc/exports —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ (—É–∂–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ):
/stg/8tb/share  192.168.87.17(rw,sync,no_subtree_check) 192.168.87.20(rw,sync,no_subtree_check) 192.168.87.6(rw,sync,no_subtree_check)

# –ü—Ä–∏–º–µ–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
exportfs -ra
systemctl restart nfs-kernel-server
```

**–ü–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∏ –≤–ª–∞–¥–µ–Ω–∏–µ –ø–∞–ø–∫–∏ `/var/atlassian/application-data/jira-shared/` –Ω–∞ –∫–∞–∂–¥–æ–π –Ω–æ–¥–µ**
```bash
# –°–Ω–∞—á–∞–ª–∞ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å –æ–ø—Ü–∏–µ–π -f:
chown -Rf jira:jira /var/atlassian/application-data/jira-shared/

# –ï—Å–ª–∏ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π –ø–æ–¥—Ö–æ–¥:
find /var/atlassian/application-data/jira-shared/ -exec chown jira:jira {} \; -exec chmod 750 {} \;
```
**–æ—Å–æ–±—ã–µ —Å–ª—É—á–∞–∏–∏ `.osgi-plugins`**
```bash
# –í—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏
chattr -i /var/atlassian/application-data/jira-shared/plugins/.osgi-plugins/*

# –ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–∞–≤
chown -R jira:jira /var/atlassian/application-data/jira-shared/plugins/
```
**–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏**
```bash
# –í–µ—Ä–Ω–∏—Ç–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø—Ä–∞–≤–∞:
find /var/atlassian/application-data/jira-shared/ -type d -exec chmod 750 {} \;
find /var/atlassian/application-data/jira-shared/ -type f -exec chmod 640 {} \;

# –î–ª—è –æ—Å–æ–±—ã—Ö –∫–∞—Ç–∞–ª–æ–≥–æ–≤:
chmod 770 /var/atlassian/application-data/jira-shared/tmp/
chmod 770 /var/atlassian/application-data/jira-shared/node-status/
```



#### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Keepalived –¥–ª—è –ø–ª–∞–≤–∞—é—â–µ–≥–æ IP (192.168.87.3)

**–ù–∞ prox4 (–æ—Å–Ω–æ–≤–Ω–æ–π —É–∑–µ–ª, 192.168.87.17):**

```bash
cat > /etc/keepalived/keepalived.conf <<'EOF'
! Configuration File for keepalived
global_defs {
    router_id LVS_DEVEL
}

vrrp_instance VI_NFS {
    state MASTER
    interface eth0
    virtual_router_id 51
    priority 150
    advert_int 1
    authentication {
        auth_type PASS
        auth_pass nfs_ha_pass
    }
    virtual_ipaddress {
        192.168.87.3/24
    }
    notify_master "/usr/local/bin/nfs_vip_up.sh"
    notify_backup "/usr/local/bin/nfs_vip_down.sh"
    notify_fault "/usr/local/bin/nfs_vip_down.sh"
}
EOF
```

**–ù–∞ pmx5 (—Ä–µ–∑–µ—Ä–≤–Ω—ã–π —É–∑–µ–ª, 192.168.87.20):**

```bash
cat > /etc/keepalived/keepalived.conf <<'EOF'
! Configuration File for keepalived
global_defs {
    router_id LVS_DEVEL
}

vrrp_instance VI_NFS {
    state BACKUP
    interface eth0
    virtual_router_id 51
    priority 100
    advert_int 1
    authentication {
        auth_type PASS
        auth_pass nfs_ha_pass
    }
    virtual_ipaddress {
        192.168.87.3/24
    }
    notify_master "/usr/local/bin/nfs_vip_up.sh"
    notify_backup "/usr/local/bin/nfs_vip_down.sh"
    notify_fault "/usr/local/bin/nfs_vip_down.sh"
}
EOF
```

**–ù–∞ pmx6 (—Ä–µ–∑–µ—Ä–≤–Ω—ã–π —É–∑–µ–ª, 192.168.87.6):**

```bash
cat > /etc/keepalived/keepalived.conf <<'EOF'
! Configuration File for keepalived
global_defs {
    router_id LVS_DEVEL
}

vrrp_instance VI_NFS {
    state BACKUP
    interface eth0
    virtual_router_id 51
    priority 50
    advert_int 1
    authentication {
        auth_type PASS
        auth_pass nfs_ha_pass
    }
    virtual_ipaddress {
        192.168.87.3/24
    }
    notify_master "/usr/local/bin/nfs_vip_up.sh"
    notify_backup "/usr/local/bin/nfs_vip_down.sh"
    notify_fault "/usr/local/bin/nfs_vip_down.sh"
}
EOF
```

#### 4. –°–æ–∑–¥–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–æ–≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –¥–ª—è Keepalived

**–ù–∞ –≤—Å–µ—Ö —É–∑–ª–∞—Ö —Å–æ–∑–¥–∞–µ–º:**

```bash
cat > /usr/local/bin/nfs_vip_up.sh <<'EOF'
#!/bin/bash
# –°–∫—Ä–∏–ø—Ç –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –≤ MASTER —Å–æ—Å—Ç–æ—è–Ω–∏–µ
logger "NFS VIP 192.168.87.3 –ø–µ—Ä–µ—à–µ–ª –Ω–∞ $(hostname)"
systemctl restart nfs-kernel-server
EOF

cat > /usr/local/bin/nfs_vip_down.sh <<'EOF'
#!/bin/bash
# –°–∫—Ä–∏–ø—Ç –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –≤ BACKUP/FAULT —Å–æ—Å—Ç–æ—è–Ω–∏–µ
logger "NFS VIP 192.168.87.3 –ø–æ–∫–∏–¥–∞–µ—Ç $(hostname)"
EOF

chmod +x /usr/local/bin/nfs_vip_*.sh
```

#### 5. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è NFS —á–µ—Ä–µ–∑ –ø–ª–∞–≤–∞—é—â–∏–π IP

**–ù–∞ –≤—Å–µ—Ö —É–∑–ª–∞—Ö –ø—Ä–∞–≤–∏–º /etc/fstab:**

```bash
# –°–æ–∑–¥–∞–µ–º —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é
cp /etc/fstab /etc/fstab.bak

# –û–±–Ω–æ–≤–ª—è–µ–º fstab (–∑–∞–º–µ–Ω—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∑–∞–ø–∏—Å–∏)
sed -i '/192.168.87/d' /etc/fstab
cat >> /etc/fstab <<'EOF'
# –ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è Proxmox
192.168.87.3:/stg/8tb/share /mnt/pve/nfs_storage nfs rw,hard,intr,noatime,vers=4.2,_netdev,timeo=300,retrans=3,proto=tcp 0 0

# –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ç–æ—á–∫–∞ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
192.168.87.3:/stg/8tb/share /mnt/share nfs rw,hard,intr,noatime,vers=4.2,_netdev,timeo=300,retrans=3,proto=tcp 0 0
EOF

# –ü—Ä–∏–º–µ–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
systemctl daemon-reload
mount -a
```

#### 6. –ó–∞–ø—É—Å–∫ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤

**–ù–∞ –≤—Å–µ—Ö —É–∑–ª–∞—Ö –≤—ã–ø–æ–ª–Ω—è–µ–º:**

```bash
# –í–∫–ª—é—á–∞–µ–º –∏ –∑–∞–ø—É—Å–∫–∞–µ–º keepalived
systemctl enable --now keepalived

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å
systemctl status keepalived
ip addr show eth0 | grep 192.168.87.3

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º NFS
systemctl restart nfs-kernel-server
```

#### 7. –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏

1. –ù–∞ —Ç–µ–∫—É—â–µ–º master-—É–∑–ª–µ (–≥–¥–µ –≤–∏—Å–∏—Ç 192.168.87.3):
```bash
# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—É—â–∏–π master
ip a show eth0 | grep 192.168.87.3

# –ò–º–∏—Ç–∏—Ä—É–µ–º —Å–±–æ–π
systemctl stop keepalived
```

2. –ù–∞ —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö —É–∑–ª–∞—Ö –ø—Ä–æ–≤–µ—Ä—è–µ–º –ø–µ—Ä–µ—Ö–æ–¥ VIP:
```bash
watch -n 1 'ip a show eth0 | grep 192.168.87.3'
```

3. –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å NFS:
```bash
ls /mnt/share
touch /mnt/share/failover_test && rm /mnt/share/failover_test
```

#### 8. –§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

**–ù–∞ –≤—Å–µ—Ö —É–∑–ª–∞—Ö:**

```bash
# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
apt install -y monit

# –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º monit –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ NFS
cat > /etc/monit/conf.d/nfs_check <<'EOF'
check filesystem nfs_mount with path /mnt/share
    if space usage > 90% then alert
    if inode usage > 90% then alert
    if changed fsflags then alert
EOF

systemctl enable --now monit
```

#### 9. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. –î–ª—è –ª—É—á—à–µ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ NFS –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ /etc/sysctl.conf:
```bash
echo "sunrpc.tcp_max_slot_table_entries=128" >> /etc/sysctl.conf
sysctl -p
```

2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ firewall (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è):
```bash
ufw allow from 192.168.87.0/24 to any port nfs
ufw allow proto vrrp
```

3. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏:
```bash
echo "local0.* /var/log/keepalived.log" >> /etc/rsyslog.conf
systemctl restart rsyslog
```



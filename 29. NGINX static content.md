См.: [NGINX Load balancer](https://github.com/sherbettt/BASH-cheats/blob/main/28.%20NGINX%20Load%20balancer.md)
<br/> См.: [типы директивы location](https://github.com/sherbettt/BASH-cheats/blob/main/27.%20NGINX%2C%20типы%20директивы%20location.md)


Чтобы настроить NGINX для раздачи статического контента из `/tmp/front`, вам нужно создать конфигурацию, которая будет обслуживать эти файлы.  

### 1. **Создайте конфигурацию NGINX**  
- Создайте новый конфигурационный файл в `/etc/nginx/sites-available/` (например, `static_content`);
- чтобы NGINX увидел файлы, установите права (`chmod -R 755 /tmp/front`).

### 2. **Настройка сервера**  
Добавьте следующую конфигурацию (подключение будет через `192.168.87.112`):  

```nginx
server {
    listen 80;
    listen 192.168.56.1:80; # Если требуется подключение с другого интерфейса
    server_name 192.168.87.112;  # или просто _, если имя не важно

    root /tmp/front;  # корневая директория с файлами

    index index.html;  # если есть index.html, он будет отдаваться по умолчанию

    location / {
        try_files $uri $uri/ =404;  # ищет файл или возвращает 404
    }

    # Для .svg и .js можно добавить специфичные location, если нужно
    location ~* \.(svg|js)$ {
        expires 1d;  # кеширование на 1 день
        add_header Cache-Control "public";
    }
}
```

### 3. **Проверьте и перезапустите NGINX**  
```bash
sudo nginx -t  # проверка конфигурации
sudo systemctl restart nginx  # перезапуск NGINX
```

### 4. **Доступ к файлам**  
Теперь, если в `/tmp/front` лежит, например, `image.svg`, вы сможете получить его по:  
```
http://192.168.87.112/image.svg
```

### **Если нужен `index.html`**  
Если хотите, чтобы при обращении к корню (`http://192.168.87.112/`) открывался `index.html`, просто создайте его в `/tmp/front/`.  

Пример `index.html`:  
```html
<!DOCTYPE html>
<html>
<head>
    <title>Static Content</title>
</head>
<body>
    <h1>Welcome to Static Files</h1>
    <p><a href="/image.svg">SVG Image</a></p>
    <script src="/script.js"></script>
</body>
</html>
```
Проверьте доступность сервера с ноутбука:  
```bash
curl http://192.168.87.112/
```
---

В контексте раздачи статического контенте через NGINX, директива `try_files` играет ключевую роль. 
Она указывает серверу, в каком порядке искать запрашиваемые файлы и как обрабатывать запрос, если файл не найден.  

### **Как работает `try_files` в описанном случае?**  
В предложенной конфигурации:  
```nginx
location / {
    try_files $uri $uri/ =404;
}
```  
Директива `try_files` проверяет файлы **в указанном порядке** и использует **первый найденный**.  

#### Разберём параметры:
1. **`$uri`**  
   - NGINX ищет файл с **точным именем**, указанным в запросе.  
   - Например, для `http://192.168.87.112/script.js` сервер проверит наличие `/tmp/front/script.js`.  

2. **`$uri/`**  
   - Если файл не найден, NGINX проверяет, существует ли **директория** с таким именем.  
   - Например, для `http://192.168.87.112/images/` сервер проверит, есть ли `/tmp/front/images/`.  
   - Если да — NGINX попытается отдать `index.html` внутри этой папки (если `index` указан в конфиге).  

3. **`=404`**  
   - Если ни файл, ни директория не найдены — сервер вернёт **HTTP 404 Not Found**.  

---

### **Примеры работы**
#### 1. Запрос существующего файла  
**Запрос:** `http://192.168.87.112/logo.svg`  
**Проверка:**  
1. `/tmp/front/logo.svg` — **найден** → NGINX отдаёт файл.  
2. Дальнейшие проверки (`$uri/`, `=404`) не выполняются.  

#### 2. Запрос несуществующего файла  
**Запрос:** `http://192.168.87.112/nonexistent.js`  
**Проверка:**  
1. `/tmp/front/nonexistent.js` — не найден.  
2. `/tmp/front/nonexistent.js/` (директория) — не существует.  
3. → NGINX возвращает **404**.  

#### 3. Запрос директории с `index.html`  
**Запрос:** `http://192.168.87.112/docs/`  
**Проверка:**  
1. `/tmp/front/docs` (файл) — не найден.  
2. `/tmp/front/docs/` (директория) — существует.  
3. NGINX ищет `index.html` внутри `/tmp/front/docs/` (т.к. в конфиге есть `index index.html`).  

---

### **Дополнительные варианты использования `try_files`**
#### Если нужно отдавать `index.html` для всех путей (SPA, например Vue/React):  
```nginx
location / {
    try_files $uri $uri/ /index.html;
}
```
- Если файл/директория не найдены — NGINX отдаст `/index.html` (клиентский роутер обработает путь).  

#### Если нужно сначала проверять кэшированные файлы:  
```nginx
location / {
    try_files /cache/$uri $uri $uri/ =404;
}
```
- Сначала ищет файл в `/cache/`, затем в корне.  

---

### **Важные нюансы**
1. **Порядок аргументов в `try_files` важен** — NGINX остановится на первом совпадении.  
2. **`$uri/` проверяет директории** — если её нет, можно убрать (например, для API).  
3. **`=404` — это код ответа**, но можно использовать и другие (например, `=403`).  

Если ваш статический контент не отдаётся — проверьте:  
- Права на файлы (`chmod -R 755 /tmp/front`).  
- Корректность путей в `root`.  
- Логи NGINX (`sudo tail -f /var/log/nginx/error.log`).  

Директива `try_files` — это гибкий инструмент для управления обработкой запросов в NGINX!






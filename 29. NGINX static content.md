См.: [NGINX Load balancer](https://github.com/sherbettt/BASH-cheats/blob/main/28.%20NGINX%20Load%20balancer.md)
<br/> См.: [типы директивы location](https://github.com/sherbettt/BASH-cheats/blob/main/27.%20NGINX%2C%20типы%20директивы%20location.md)

Имеется файл `index.html` в директории `/tmp/front`. Т.е. это - Angular-приложение (или подобное SPA), которое требует правильной настройки NGINX для корректной работы.

```nginx
<!doctype html>
<html lang="en" class="notranslate" translate="no">
<head>
  <meta charset="utf-8">
  <meta name="google" content="notranslate"/>
  <title>VoIP PBX</title>
  <base href="/">
  <style>
    body:not(.material-icons-loaded) .mat-icon {
      display: none;
    }
    @font-face {
      font-family: 'Material Icons';
      font-style: normal;
      font-display: fallback;
      font-weight: 400;
      src:  url(assets/styles/icons/material-design-icons/MaterialIcons-Regular.woff2) format('woff2'),
            url(assets/styles/icons/material-design-icons/MaterialIcons-Regular.ttf) format('ttf');
    }
    #hideMe {
      -webkit-animation: cssAnimation 5s forwards;
      animation: cssAnimation 5s forwards;
    }
    @keyframes cssAnimation {
      0%   {opacity: 1;}
      90%  {opacity: 1;}
      100% {opacity: 0;}
    }
    @-webkit-keyframes cssAnimation {
      0%   {opacity: 1;}
      90%  {opacity: 1;}
      100% {opacity: 0;}
    }

    .bg-loader {
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      z-index: 9999;
      background: white !important;
    }
    .r-loader {
      position: fixed;
      top: calc(50% - 50px);
      left: calc(50% - 50px);
      transform: translate(-50%, -50%);
      transform: -webkit-translate(-50%, -50%);
      transform: -moz-translate(-50%, -50%);
      transform: -ms-translate(-50%, -50%);
      width: 120px;
      height: 120px;
      border-radius: 50%;
      background: conic-gradient(lightgray, transparent);

      animation: rotating 1s linear infinite;
    }

    .r-loader::before {
      content: '';
      position: absolute;
      width: 70px;
      height: 70px;
      top: 25px;
      left: 25px;
      border-radius: 50%;
      background: white !important;
    }

    @keyframes rotating {
      from {
        transform: rotate(360deg);
      }
      to {
        transform: rotate(0deg);
      }
    }
  </style>

  <meta name="viewport" content="width=device-width, initial-scale=1">
<!--  <script src="https://telegram.org/js/telegram-web-app.js" ></script>-->
<link rel="stylesheet" href="styles.450782dab24630ab.css"></head>
<body>
  <app-root>
    <div id="loader" class="bg-loader"><div class="r-loader"></div></div>
  </app-root>
  <script>
    window.addEventListener('load',function () {
      const loader = document.getElementById("loader");
      if (loader) {

        if (window.location.pathname == '/login') {
          loader.style.opacity = '0';
        }
        else if (window.location.pathname.includes('/webapp')) {
          loader.style.opacity = '0';
        }
        else {
          loader.style.opacity = '1';
        }
      }

    });
  </script>
<script src="runtime.bd68ea7a68b0ad50.js" type="module"></script><script src="polyfills.36dbc1e4d5dd6f3e.js" type="module"></script><script src="scripts.17c6b2093de53c7f.js" defer></script><script src="main.c9d8b78e79c558cf.js" type="module"></script></body>
</html>
```


### **Проблемы в текущей ситуации:**
1. **Базовый путь (`<base href="/">`)**  
   В `index.html` указан `<base href="/">`, значит, все ресурсы (JS, CSS, иконки) будут запрашиваться от корня (`/`), а не от `/tmp/front/`.  
   Это может привести к ошибкам 404, если NGINX неправильно настроен.

2. **Маршрутизация Angular (SPA)**  
   Приложение использует клиентский роутинг, поэтому NGINX должен перенаправлять все неизвестные пути на `index.html`.

3. **Статические файлы (JS, CSS, SVG)**  
   Нужно правильно раздавать статику, включая файлы из `/tmp/front/`.

---

## **Настройка NGINX для SPA (Angular/React/Vue)**
Создайте конфигурацию в `/etc/nginx/sites-available/static-content`:

```nginx
server {
    listen 82;
    server_name _;

    root /tmp/front;
    index index.html;

    # Раздача статики (JS, CSS, SVG, шрифты)
    location / {
        try_files $uri $uri/ /index.html;  # Для SPA: все пути → index.html
    }

    # Ускорение загрузки статики (кеширование)
    location ~* \.(js|css|svg|woff2|ttf|png|jpg|jpeg|gif|ico)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
        access_log off;
    }

    # Запрет доступа к .map (если не нужны)
    location ~* \.map$ {
        deny all;
        return 404;
    }
}
```

### **Что делает эта конфигурация?**
- `try_files $uri $uri/ /index.html` – если файл не найден, загружает `index.html` (нужно для SPA-роутинга).  
- Кеширует статику (`js|css|svg|woff2|ttf...`) на 1 год.  
- Блокирует доступ к `.map`-файлам (исходникам JS).  
- Раздаёт файлы из `/tmp/front/` как корневые (`/`).  

---

## **Проверка и перезапуск NGINX**
1. Проверить конфигурацию:
   ```bash
   nginx -t
   ```
2. Перезапустить NGINX:
   ```bash
   systemctl restart nginx
   ```
3. Открыть в браузере:
   ```
   http://192.168.87.112:82/
   ```

---

## **Если что-то не работает**
1. **404 на JS/CSS?**  
   - Проверьте, что файлы лежат в `/tmp/front/` (например, `runtime.bd68ea7a68b0ad50.js`).  
   - Если пути в `index.html` отличаются (`/assets/...`), нужно либо исправить `index.html`, либо добавить `alias` в NGINX.

2. **Бесконечная загрузка?**  
   - Возможно, NGINX не отдаёт `index.html` для маршрутов Angular.  
   - Убедитесь, что `try_files $uri $uri/ /index.html;` работает.

3. **Доступ с других интерфейсов (`eth1`, `eth2`)?**  
   - Если нужно разрешить доступ с `192.168.56.0/24` или `192.168.96.0/24`, добавьте:
     ```nginx
     server {
         listen 192.168.56.1:82;
         listen 192.168.96.113:82;
         ...
     }
     ```

Если нужна более тонкая настройка — уточните, какие ошибки появляются в браузере (`F12 → Console/Network`).







### ICMP Протокол
[Wiki-ICMP](https://ru.wikipedia.org/wiki/ICMP)
<br/> [netacademy-ICMP](https://net.academy.lv/lection/net_LS-10RU_icmp.pdf)

**Internet Control Message Protocol (ICMP)** — протокол межсетевых управляющих соединений, предназначенный главным образом для передачи служебных сообщений об ошибках между узлами сети. Сам протокол находится на сетевом уровне, однако также частично выполняет функции транспортного уровня.
<br/> Его основное назначение — обмен диагностической информацией и уведомлениями об ошибках. 
<br/> Примеры таких уведомлений включают сообщение о невозможности доставки пакета, превышении лимита TTL (Time To Live), перегрузке канала связи и другие события, возникающие при передаче пакетов IP.
<br/> Хотя формально протокол использует IP (ICMP-пакеты инкапсулируются в IP пакеты), он является неотъемлемой частью IP и обязателен при реализации стека TCP/IP. 
<br/> Текущая версия ICMP для IPv4 называется ICMPv4. В IPv6 существует аналогичный протокол ICMPv6.

ICMP является вспомогательным средством диагностики сетей и выявления проблем в маршрутах передачи данных, обеспечивая контроль над передачей и обработку критичных ситуаций.

#### Основные характеристики протокола ICMP:

- **Тип**: Это транспортный протокол управления, работающий поверх базового транспортного протокола IPv4/IPv6.
- **Порт**: У ICMP отсутствует понятие порта, поскольку он используется исключительно для обмена управляющими сообщениями и предназначен для поддержки функционирования основного IP-протокола.
  
Протокол ICMP позволяет отправлять следующие виды сообщений:

| Тип | Назначение |
|-----|------------|
| 0   | Echo Reply (ответ эхо-запроса) |
| 3   | Destination Unreachable (адрес назначения недоступен) |
| 8   | Echo Request (эхо-запрос)     |
| 11  | Time Exceeded (превышение таймаута) |
| 13  | Timestamp Request (запрос метки времени) |
| 14  | Timestamp Reply (ответ на запрос метки времени) |

Наиболее известные случаи использования ICMP:

- **Ping**: Используется для проверки доступности узла путем отправки echo request (типа 8) и ожидания echo reply (типа 0).
- **Traceroute**: Определяет путь прохождения пакетов от отправителя до конечного пункта, используя механизм изменения значения поля TTL и анализа полученных ошибок типа time exceeded (тип 11).

---

Сообщения типа 3 (Destination Unreachable) протокола ICMP используются для информирования отправителей о проблемах с достижением целевого адреса или ресурса. Эти сообщения отправляются промежуточными устройствами (маршрутизаторами) или конечными хостами, когда невозможно доставить пакет по указанному адресу. Они помогают обнаружить проблемы в пути следования пакетов и предотвратить бесполезную передачу трафика.

Основные причины возникновения сообщений типа 3:

1. **Host unreachable (код 1)** — целевой узел недоступен. Обычно возникает, когда маршрутизатор не может определить маршрут к запрашиваемому устройству.
   
2. **Protocol unreachable (код 2)** — указанный протокол недоступен на удалённом устройстве. Например, если адресат поддерживает только TCP, а отправлен UDP-пакет.

3. **Port unreachable (код 3)** — требуемый порт закрыт на конечном узле. Сообщение отправляется, если приложение на принимающей стороне не ожидает входящего соединения на указанном порте.

4. **Fragmentation needed but don't fragment bit set (код 4)** — размер пакета превышает MTU (Maximum Transmission Unit) маршрута, однако бит DF («Don't Fragment») установлен, запрещающий фрагментацию.

5. **Source route failed (код 5)** — используемый источник маршрута оказался некорректным.

---

## Типы сообщений ICMP

Протокол Internet Control Message Protocol (ICMP) определяет различные типы сообщений, используемых для диагностики и контроля состояния сети. Вот список наиболее распространённых типов сообщений ICMP и их коды:

### Информационные сообщения:

- **Type 0:** `Echo Reply` (ответ на эхо-запрос)
  - Код: 0 — Стандартный ответ на команду Ping
- **Type 8:** `Echo Request` (эхо-запрос)
  - Код: 0 — Запрос команды Ping для проверки доступности хоста
- **Type 13:** `Timestamp Request` (запрос временной отметки)
  - Код: 0 — Запрашивает временную отметку текущего момента времени
- **Type 14:** `Timestamp Reply` (ответ на запрос временной отметки)
  - Код: 0 — Ответ на запрос временной отметки

---

### Сообщения об ошибках:

- **Type 3:** `Destination Unreachable` (недоступность цели)
  - Коды:
    - 0: Net unreachable (сеть недоступна)
    - 1: Host unreachable (хост недоступен)
    - 2: Protocol unreachable (протокол недоступен)
    - 3: Port unreachable (порт недоступен)
    - 4: Fragmentation needed and Don't Fragment was set (нужна фрагментация, но бит запрета фрагментации установлен)
    - 5: Source Route Failed (неудача исходящей маршрутизации)
    
- **Type 4:** `Source Quench` (замедление источника)
  - Код: 0 — Отправляется для замедления скорости передачи, если устройство перегружено трафиком (устаревший метод контроля нагрузки)

- **Type 5:** `Redirect` (перенаправление)
  - Коды:
    - 0: Redirect Datagram for the Network (перенаправляет данные на другой шлюз для достижения определённой сети)
    - 1: Redirect Datagram for the Host (перенаправляет данные на другой шлюз для достижения конкретного хоста)
    - 2: Redirect Datagram for Type of Service and Network (перенаправляет исходя из класса обслуживания и сети)
    - 3: Redirect Datagram for Type of Service and Host (перенаправляет исходя из класса обслуживания и хоста)

- **Type 11:** `Time Exceeded` (истечение времени)
  - Коды:
    - 0: TTL Expired in Transit (пакет прошёл большее число прыжков, чем разрешил TTL)
    - 1: Fragment Reassembly Time Exceeded (время ожидания фрагментов для сборки пакета истёкло)

- **Type 12:** `Parameter Problem` (проблема параметра)
  - Код: 0 — Обнаружены неверные заголовочные параметры пакета

---

### Дополнительные сообщения:

- **Type 17:** `Address Mask Request` (запрос маски адреса)
  - Код: 0 — Запрашивается маска сети для указанного IP-адреса
- **Type 18:** `Address Mask Reply` (ответ на запрос маски адреса)
  - Код: 0 — Возвращается маска сети для указанного IP-адреса

---




См.: [Настройка NAT на роутере с Ubuntu](https://github.com/sherbettt/BASH-cheats/blob/main/26.%20Настройка%20NAT%20на%20роутере%20с%20Ubuntu.md)

Есть Ubuntu подобный роутер. На нём три интерфейса:
<br/> eth0 - 192.168.87.112 (смотрит в интернет), шлюз: 192.168.87.1;
<br/> eth1 - 192.168.56.1 (не смотрит в интернет, для связи с машинами);
<br/> eth2 - 192.168.96.113 (смотрит в интернет), шлюз: 192.168.96.1

Также есть две другие Ubuntu машины, подключённые к выше указанном роутеру с адресами:192.168.56.2/24; 192.168.56.3/24
<br/> На роутер установлен рабочий NGINX, проверяется через веб морду с ноута 192.168.87.136.

Для реализации **балансировки нагрузки** между двумя серверами (`192.168.56.2` и `192.168.56.3`) с поочерёдным отображением их веб-страниц при обновлении браузера можно использовать **nginx** в режиме **round-robin** (по умолчанию).  

### **1. Настройка nginx на роутере (192.168.87.112/192.168.56.1)**
Отредактируйте конфигурацию nginx (`/etc/nginx/nginx.conf` или `/etc/nginx/sites-available/default`):

```nginx
upstream backend {
    server 192.168.56.2; # weight=1 max_fails=9 fail_timeout=12s;
    server 192.168.56.3; # weight=1 max_fails=9 fail_timeout=18s;
}

server {
    listen 88 default_server;
    server_name _;

    location / {
        proxy_pass http://backend;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

После правки проверьте конфигурацию и перезапустите nginx:  
```bash
sudo nginx -t
sudo systemctl restart nginx
```

### **2. Настройка веб-серверов на 192.168.56.2 и 192.168.56.3**
На каждой машине создайте `/var/www/html/index.html` с разным содержимым, чтобы видеть, какой сервер отвечает.  

**На 192.168.56.2:**
```html
<!DOCTYPE html>
<html>
<head>
    <title>Server 1</title>
</head>
<body>
    <h1>Hello from Server 1 (192.168.56.2)</h1>
</body>
</html>
```

**На 192.168.56.3:**
```html
<!DOCTYPE html>
<html>
<head>
    <title>Server 2</title>
</head>
<body>
    <h1>Hello from Server 2 (192.168.56.3)</h1>
</body>
</html>
```

### **3. Проверка работы**
Откройте в браузере `http://192.168.56.1` (или `http://192.168.87.112:88`, если доступ извне) и обновляйте страницу. Должно поочерёдно показывать то один сервер, то другой.

### **4. (Опционально) Красивый index.html на самом роутере**
Если вы хотите, чтобы **сам роутер** тоже отдавал свою страницу (а не только проксировал запросы), можно добавить ещё один `server`-блок:

```nginx
server {
    listen 8080;  # Например, на другом порту
    server_name _;
    root /var/www/html;
    index index.html;
}
```

Создайте `/var/www/html/index.html` на роутере:
```html
<!DOCTYPE html>
<html>
<head>
    <title>Router Main Page</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            text-align: center;
            padding: 50px;
        }
        h1 {
            color: #333;
        }
        .info {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            max-width: 600px;
            margin: 0 auto;
        }
    </style>
</head>
<body>
    <div class="info">
        <h1>Welcome to the Router!</h1>
        <p>This is the main page of the router (192.168.56.1).</p>
        <p>To access balanced backend servers, go to <a href="/">http://192.168.56.1</a></p>
    </div>
</body>
</html>
```

### **Итог**
- Nginx на роутере балансирует нагрузку между `192.168.56.2` и `192.168.56.3`.  
- При обновлении страницы браузер будет получать ответ то от одного сервера, то от другого.  
- Сам роутер может отдавать свою страницу на отдельном порту (например, `8080`).  

Проверьте, что фаервол (`ufw`/`iptables`) разрешает входящие подключения на `80` и `8080` порты.

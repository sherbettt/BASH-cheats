# Шпаргалка по файловым дескрипторам, inode и ulimit в Linux

##  Inode (Index Node)

### Что такое inode?
**Inode** - это структура данных в файловой системе, содержащая метаинформацию о файле (кроме имени).

### Команды для работы с inode

```bash
# Показать inode файлов
ls -i filename.txt

# Показать inode с детальной информацией
ls -li filename.txt

# Показать inode всех файлов в директории
ls -ai

# Найти файл по inode
find /path -inum 1234567

# Показать информацию о файловой системе (доступные inode)
df -i
```

### Ключевая информация в inode:
- Права доступа
- Владелец и группа
- Размер файла
- Временные метки
- Ссылки на блоки данных

---

##  Файловые дескрипторы (File Descriptors)

### Что такое файловый дескриптор?
**FD** - числовой идентификатор, который ядро возвращает процессу при открытии файла/сокета.

### Команды для работы с файловыми дескрипторами

```bash
# Показать FD текущего shell-процесса
ls -l /proc/$$/fd/

# Показать FD конкретного процесса
ls -l /proc/<PID>/fd/

# Показать все открытые файлы в системе
lsof

# Показать открытые файлы процессом
lsof -p <PID>

# Показать процессы, использующие файл
lsof /path/to/file

# Создать FD вручную в bash
exec 3>file.txt    # FD 3 для записи
exec 4<file.txt    # FD 4 для чтения
echo "test" >&3    # запись через FD 3
```

### Стандартные файловые дескрипторы:
- **0** - stdin (стандартный ввод)
- **1** - stdout (стандартный вывод)  
- **2** - stderr (стандартный ошибка)

---

##  Ulimit - управление лимитами ресурсов

### Основные команды ulimit

```bash
# Показать все текущие лимиты
ulimit -a

# Показать лимит файловых дескрипторов
ulimit -n

# Установить лимит FD
ulimit -n 4096

# Показать hard limit
ulimit -H -n

# Показать soft limit  
ulimit -S -n

# Установить лимит процессов на пользователя
ulimit -u 1000
```

### Часто используемые опции:
```bash
-a  # Все лимиты
-n  # Количество открытых файлов
-u  # Максимум процессов
-t  # Максимум CPU time (секунды)
-v  # Максимум виртуальной памяти
-f  # Максимум размера файлов
```

---

##  Взаимосвязь понятий

### Цепочка доступа к файлу:
```
Процесс открывает файл 
    ↓
Ядро возвращает файловый дескриптор (FD)
    ↓
FD ссылается на системную таблицу файлов
    ↓
Системная таблица ссылается на inode
    ↓
Inode указывает на данные на диске
```

### Аналогия:
- **Inode** = Паспорт файла (постоянный)
- **File Descriptor** = Читательский билет (временный)
- **Ulimit** = Охранник, ограничивающий количество билетов

---

##  Практические примеры

### Диагностика проблем
```bash
# Проверить использование FD процессом
ls -l /proc/<PID>/fd/ | wc -l

# Найти утечки FD
lsof -p <PID> | wc -l

# Проверить доступные inode в ФС
df -i

# Увеличить лимит FD для веб-сервера
ulimit -n 65536
```

### Постоянная настройка лимитов
```bash
# Добавить в ~/.bashrc
ulimit -n 8192

# Или в /etc/security/limits.conf
# * soft nofile 8192
# * hard nofile 65536
```

---

##  Полезные советы

1. **При "Too many open files"** - увеличьте `ulimit -n`
2. **При "No space left on device"** - проверьте `df -i` (могли кончиться inode)
3. **Для серверных приложений** всегда настраивайте адекватные лимиты
4. **FD освобождаются автоматически** при завершении процесса
5. **Inode создаются при создании ФС** и их количество ограничено

---



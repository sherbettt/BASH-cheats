# **Полное руководство по пакетным менеджерам и управлению репозиториями в Manjaro**

---

## **Часть 1: Пакетные менеджеры (повторение с дополнениями)**

### **Основные пакетные менеджеры в Manjaro**

Manjaro использует систему управления пакетами от Arch Linux, но со своими удобными надстройками.

1.  **Pacman** — это **главный** низкоуровневый пакетный менеджер. Он работает напрямую с пакетами из репозиториев. Все остальные являются его фронтендами (обёртками).

2.  **Pamac** — это **основной графический и консольный менеджер по умолчанию** в Manjaro. Он дружелюбен к пользователю и имеет множество функций (установка из AUR, обновление системы, удобный поиск). В консоли также доступна команда `pamac`.

3.  **Octopi** / **Discover** — альтернативные графические менеджеры пакетов. Octopi мощный и подробный, Discover больше интегрирован с окружениями рабочего стола KDE.

---

### **Сравнение команд (Pacman/Pamac vs Apt)**

Вот таблица основных операций. **Для повседневного использования в Manjaro рекомендуется использовать `pamac`**, так как он проще и безопаснее (например, при работе с AUR).

| Действие | В Ubuntu/Debian (apt) | В Manjaro/Arch (Pacman) | В Manjaro (Pamac — **рекомендуется**) |
| :--- | :--- | :--- | :--- |
| **Обновить списки пакетов** | `sudo apt update` | `sudo pacman -Sy` | `sudo pamac update` (или `sudo pamac refresh`) |
| **Обновить все пакеты** | `sudo apt upgrade` | `sudo pacman -Syu` | `sudo pamac upgrade` |
| **Установить пакет** | `sudo apt install <пакет>` | `sudo pacman -S <пакет>` | `sudo pamac install <пакет>` |
| **Удалить пакет** | `sudo apt remove <пакет>` | `sudo pacman -R <пакет>` | `sudo pamac remove <пакет>` |
| **Удалить пакет + конфиги** | `sudo apt purge <пакет>` | `sudo pacman -Rns <пакет>` | `sudo pamac remove --orphans` (для чистки) |
| **Поиск пакета** | `apt search <запрос>` | `pacman -Ss <запрос>` | `pamac search <запрос>` |
| **Показать инфо о пакете** | `apt show <пакет>` | `pacman -Si <пакет>` | `pamac info <пакет>` |
| **Список установленных** | `apt list --installed` | `pacman -Q` | `pamac list --installed` |
| **Узнать, кто файл установил**| `dpkg -S /путь/файл` | `pacman -Qo /путь/файл` | `pamac search --files <имя_файла>` |

---

### **Важные особенности и советы**

1.  **Обновление системы (`-Syu`)** — это одна команда, которая и синхронизирует базу данных, и обновляет пакеты. **Всегда делайте это перед установкой нового ПО**, чтобы избежать конфликтов зависимостей.
    ```bash
    sudo pacman -Syu
    # или
    sudo pamac upgrade
    ```

2.  **AUR (Arch User Repository)** — это огромное сообщественное хранилище программ, которых нет в официальных репозиториях. **Pamac умеет с ним работать из коробки** (нужно включить в настройках). Это главное преимущество!
    *   Установка из AUR через Pamac: `sudo pamac build <имя-пакета-из-aur>`

3.  **Очистка кэша** — Pacman хранит все скачанные пакеты. Это можно безопасно чистить:
    ```bash
    # Удалить ВСЕ кэшированные пакеты (кроме последних версий)
    sudo pacman -Sc
    # Удалить ВСЕ пакеты из кэша
    sudo pacman -Scc
    # Более безопасная очистка через pamac
    sudo pamac clean --build-files --orphans
    ```

4.  **yay** — популярный консольный AUR-хелпер, который многие устанавливают дополнительно. Если он у вас будет, то его команды похожи на pacman (`yay -S <пакет_из_aur>`).

**Краткий итог для новичка в Manjaro:**
*   Для **обновления системы** и **установки программ из официальных репозиториев** используйте **`sudo pamac upgrade`** и **`sudo pamac install <программа>`**.
*   Если Pamac по какой-то причине не работает, смело используйте **`sudo pacman -Syu`** и **`sudo pacman -S <программа>`**.
*   Для установки программ из **AUR** включите его в настройках Pamac (GUI) или используйте `sudo pamac build <программа>`.

---

## **Часть 2: Управление репозиториями в Manjaro**

### **Структура репозиториев в Manjaro**

В Manjaro существует четкая иерархия репозиториев:

#### **1. Официальные репозитории Manjaro:**
```
core      - основные системные пакеты
extra     - дополнительные приложения
community - пакеты, поддерживаемые сообществом
multilib  - 32-битные библиотеки для 64-битных систем
```

#### **2. Ветки (branches):**
```
stable    - стабильная версия (по умолчанию)
testing   - тестируемые пакеты (менее стабильные)
unstable  - нестабильные/экспериментальные пакеты
```

### **Конфигурационные файлы репозиториев**

#### **Главный файл: `/etc/pacman.conf`**
```bash
sudo nano /etc/pacman.conf
```

Пример содержимого:
```ini
[options]
# Основные настройки pacman
HoldPkg     = pacman glibc
Architecture = auto
Color
CheckSpace
ILoveCandy  # Визуальные конфетки в выводе
SigLevel    = Required DatabaseOptional
LocalFileSigLevel = Optional

[core]
SigLevel = PackageRequired
Include = /etc/pacman.d/mirrorlist

[extra]
SigLevel = PackageRequired
Include = /etc/pacman.d/mirrorlist

[community]
SigLevel = PackageRequired
Include = /etc/pacman.d/mirrorlist

# Раскомментируйте для поддержки 32-битных приложений
[multilib]
SigLevel = PackageRequired
Include = /etc/pacman.d/mirrorlist
```

#### **Файл зеркал: `/etc/pacman.d/mirrorlist`**
```bash
sudo nano /etc/pacman.d/mirrorlist
```

Содержит список серверов-зеркал, например:
```ini
## Country : Russia
Server = https://mirror.yandex.ru/mirrors/manjaro/stable/$repo/$arch
Server = https://mirror.msiu.ru/manjaro/stable/$repo/$arch

## Country : Germany
Server = https://mirror.netcologne.de/manjaro/stable/$repo/$arch
```

### **Команды управления зеркалами**

```bash
# Обновить список зеркал и выбрать самые быстрые
sudo pacman-mirrors --fasttrack

# Выбрать зеркала из конкретных стран
sudo pacman-mirrors --country Russia,Germany,Sweden --fasttrack 5

# Показать статус всех зеркал
sudo pacman-mirrors --status

# Перегенерировать полный список зеркал
sudo pacman-mirrors --api --get-branch --all

# Изменить ветку (stable/testing/unstable)
sudo pacman-mirrors --api --set-branch stable  # или testing/unstable

# Проверить скорость зеркал
sudo pacman-mirrors -g
```

### **Добавление сторонних репозиториев**

#### **Пример 1: Chaotic-AUR (бинарные сборки AUR)**
```bash
# 1. Импорт GPG-ключа
sudo pacman-key --recv-key FBA220DFC880C036 --keyserver keyserver.ubuntu.com
sudo pacman-key --lsign-key FBA220DFC880C036

# 2. Установка ключей и списка зеркал
sudo pacman -U 'https://cdn-mirror.chaotic.cx/chaotic-aur/chaotic-keyring.pkg.tar.zst' \
              'https://cdn-mirror.chaotic.cx/chaotic-aur/chaotic-mirrorlist.pkg.tar.zst'

# 3. Добавление в pacman.conf
echo '[chaotic-aur]' | sudo tee -a /etc/pacman.conf
echo 'Include = /etc/pacman.d/chaotic-mirrorlist' | sudo tee -a /etc/pacman.conf

# 4. Обновление базы данных
sudo pacman -Syy
```

#### **Пример 2: Создание своего репозитория**
```bash
# 1. Создать отдельный файл конфигурации
sudo nano /etc/pacman.d/custom-repo

# 2. Добавить содержимое
echo '[custom-repo]' | sudo tee /etc/pacman.d/custom-repo
echo 'SigLevel = Optional TrustAll' | sudo tee -a /etc/pacman.d/custom-repo
echo 'Server = https://example.com/repo/$arch' | sudo tee -a /etc/pacman.d/custom-repo

# 3. Подключить в pacman.conf
echo 'Include = /etc/pacman.d/custom-repo' | sudo tee -a /etc/pacman.conf

# 4. Обновить
sudo pacman -Syy
```

### **Управление через Pamac (GUI)**

1. **Откройте Pamac** (Менеджер программ)
2. **Настройки → Official Repositories**:
   - Включение/выключение репозиториев (core, extra, community, multilib)
   - Выбор ветки (stable/testing/unstable)
3. **Настройки → Third Party**:
   - Включение поддержки AUR
   - Добавление сторонних репозиториев
4. **Настройки → Mirrors**:
   - Автовыбор быстрых зеркал
   - Ручной выбор страны
   - Тест скорости зеркал

### **Полезные команды для работы с репозиториями**

```bash
# Показать информацию о пакете и его репозитории
pacman -Si <пакет>          # Инфо из репозитория
pacman -Qi <пакет>          # Инфо об установленном пакете

# Список пакетов из конкретного репозитория
pacman -Sl core            # Пакеты из репозитория core
pacman -Sl extra           # Пакеты из репозитория extra

# Поиск пакета во всех репозиториях
pamac search <запрос>      # Поиск через pamac (лучше)
pacman -Ss <запрос>        # Поиск через pacman

# Узнать, из какого репозитория установлен пакет
pacman -Qi <пакет> | grep "Repository"

# Проверка обновлений из конкретных репозиториев
sudo pacman -Syuu --ignore=репозиторий  # Игнорировать репозиторий

# Показать все подключенные репозитории
grep -E '^\[.*\]' /etc/pacman.conf
```

### **Восстановление репозиториев по умолчанию**

Если что-то сломалось:
```bash
# Восстановить стандартный pacman.conf
sudo cp /etc/pacman.conf.pacnew /etc/pacman.conf 2>/dev/null || \
sudo cp /usr/share/pacman/pacman.conf /etc/pacman.conf

# Восстановить стандартные зеркала
sudo pacman-mirrors --api --get-branch --all

# Переустановить ключи pacman
sudo pacman-key --init
sudo pacman-key --populate archlinux manjaro
sudo pacman-key --refresh-keys

# Обновить систему
sudo pacman -Syyu
```

---

## **Часть 3: Практический пример - установка Яндекс.Браузера**

### **Способы установки Яндекс.Браузера в Manjaro**

#### **1. Лучший способ: установить из AUR (Arch User Repository)**
В AUR есть специальные скрипты, которые автоматически собирают пакет для Arch/Manjaro из официальных источников Яндекс.Браузера.

**Через Pamac (с графическим интерфейсом):**
1. Откройте **Pamac** (Менеджер программ).
2. В настройках (Preferences → Third Party) убедитесь, что включена опция **"Enable AUR support"**.
3. Найдите `yandex-browser` или `yandex-browser-beta`.
4. Нажмите "Установить".

**Через командную строку (с AUR-хелпером yay, который нужно сначала установить):**
```bash
# Установите yay (если еще нет)
sudo pacman -S --needed git base-devel
git clone https://aur.archlinux.org/yay.git
cd yay
makepkg -si

# Установите Яндекс.Браузер через yay
yay -S yandex-browser
# Или бета-версию
yay -S yandex-browser-beta
```

#### **2. Проверить репозиторий после установки:**
```bash
# Узнать, откуда установлен Яндекс.Браузер
pacman -Qi yandex-browser | grep -E "Repository|Version"

# Должно показать что-то вроде:
# Repository      : AUR
# Version         : 24.1.1.1104-1
```

### **Решение проблем с репозиториями**

#### **Ошибка: "репозиторий не обновлен"**
```bash
# Обновить ключи репозитория
sudo pacman-key --refresh-keys

# Принудительно обновить базу данных
sudo pacman -Syy

# Если не помогает, обновить зеркала
sudo pacman-mirrors --fasttrack
```

#### **Ошибка: "недействинная или поврежденная подпись"**
```bash
# Обновить ключи
sudo pacman-key --refresh-keys

# Или временно отключить проверку подписи (небезопасно!)
# В /etc/pacman.conf изменить:
# SigLevel = Never
```

---

## **Чек-лист для новичка в Manjaro**

1. **Обновление системы:**
   ```bash
   sudo pamac upgrade
   ```

2. **Установка программ:**
   ```bash
   # Из официальных репозиториев
   sudo pamac install <программа>
   
   # Из AUR
   sudo pamac build <программа-из-aur>
   ```

3. **Управление зеркалами:**
   ```bash
   sudo pacman-mirrors --country Russia --fasttrack 3
   sudo pacman -Syy
   ```

4. **Включение AUR в Pamac:**
   - Открыть Pamac → Настройки → Third Party
   - Включить "Enable AUR support"

5. **Очистка системы:**
   ```bash
   sudo pamac clean --build-files --orphans
   ```

---

## **Важные советы**

1. **Всегда обновляйтесь перед установкой новых пакетов**
2. **Используйте AUR с осторожностью** - проверяйте PKGBUILD
3. **Не добавляйте репозитории Arch Linux** в Manjaro
4. **Регулярно обновляйте зеркала** для лучшей скорости
5. **Используйте Timeshift** для резервного копирования системы


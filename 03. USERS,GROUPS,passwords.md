# § Пользователи

## Общее
<br/>Список пользователей посмотреть в файле */etc/passwd*
<br/>или командой: ```getent passwd```
<br/>Пароли хранятся в виде хешей в */etc/shadow*
<br/>Проверить существование пользователя: ```id <username>```
<br/>-----------------------------------------------------

- `user01:x:1000:1000:User One:/home/user01:/bin/bash` , где
    - **user01** - имя пользователя;
    - **x** - Пароль пользователя раньше хранился здесь в зашифрованном виде. Он был перенесен в файл /etc/shadow;
    - **1000** - Номер UID этой учетной записи пользователя;
    - **1000** - Номер GID основной группы для этой учетной записи пользователя;
    - **User One** - полное имя пользователя;
    - **/home/user01** - домашний каталог пользователя
    - **/bin/bash** - Программа оболочки по умолчанию для этого пользователя, которая запускается при входе в систему; для обычного пользователя это программа, предоставляющая командную строку. Системный пользователь может использовать команду **/sbin/nologin**, если интерактивный вход в систему для него не разрешен.



## Добавление:
1) ```useradd <имя пользователя> [опции]```
    -	-p - Задает пароль [useradd kiko0217 -p pass]
    -	-c - Создает комментарий для описания учетной записи [useradd kiko0217 -c "Пользователя для управления системой"]
    -	-m - При создании пользователя создать домашний каталог [useradd kiko0217 -m]
    -	-b - Задает базовый каталог для домашнего каталога [useradd kiko0217 -b /var/home]
    -	-d - Полный путь к домашнему каталогу пользователя [useradd kiko0217 -d /home/dmosk]
    -	-s - Путь до оболочки командной строки [useradd kiko0217 -s /bin/csh]
    -	-U - Имя группы будет таким же, как у пользователя
    -	-G - Задает дополнительные группы
    -	-g - Задает основную группу [useradd kiko0217 -g altternativegroup]
2) ```usermod -a -G <группы через запятую> <пользователь>```

## Редактирование:
1) Изменить имя пользователя:
<br/>	``sudo usermod --login new_username username``
2) Изменить UID:
<br/>	`sudo usermod --uid id username`
3) Изменить оболочку:
<br/>	`sudo usermod --shell path/to/shell username`
4) Изменить домашнюю папку:
<br/>	`sudo usermod --move-home --home path/to/new_home username`
5) Добавить доп. группы:
<br/>	`sudo usermod --append --groups group1,group2,... username`
6) passwd - смена для текущего пользователя
<br/> `passwd <имя пользователя> - конкретного`
7) mkpasswd -m sha-512 - генерация хэша пароля

## Удаление:
**Конфиги лежат в /etc/deluser.conf**
1) `userdel [список_опций] <имя_пользователя>`
    -	-f, --force - Принудительно удаляет пользователя, даже если у него есть запущенные процессы.
    -	-r, --remove - Удаляет домашнюю директорию учетной записи и все связанные с ней файлы.
    -	-Z, --selinux-user - Удаляет только SELinux-объекты, связанные с учетной записью.
2) `deluser [список_опций] <имя_пользователя>`
    -	--remove-all-files - Удаляет все файлы учетной записи, включая домашнюю директорию.
    -	--remove-all-groups - Удаляет учетную запись из всех групп.
3) удаление из группы
<br/>	`gpasswd --delete <пользователь> <группы через запятую>`
<br/>-----------------------------------------------------

# § Группы
1) `groupadd <группа> [опции]` - добавление
2) `groupmod <группа> [опции]` - редактирование
3) `groupdel <группа> [опции]` - удаление
<br/>-----------------------------------------------------
<br/> см. `getent passwd`
- `group01:x:978:root,user1,user2` , где
    - **group01** - имя группы;
    - **x** - Пароль пользователя раньше хранился здесь в зашифрованном виде. Он был перенесен в файл */etc/shadow*;
    - **978** - Номер GID группы;
    - **root,user1,user2** - Список участников этой группы, для которых она является дополнительной.

#### Примеры
-	`sudo useradd napo0721 -G wheel -m` - Создать учетную запись с возможностью получения привилегий суперпользователя (командой sudo su), для *CentOS*;
-	`sudo useradd napo0721 -G sudo -m` - для *DEB*.
-	`useradd dmosk -u 900 -g 950` - Создать пользователя с определенными UID и GID (соответственно идентификаторы пользователя и группы);
<br/> группа с используемым идентификатором (в данном примере 950) уже **должна быть *заранее* создана** с использованием команды groupadd
-	`useradd kiko0217 -d /home/new_kiko0217` - Создать пользователя *kiko0217* и указать путь к домашней директории
-	`useradd kiko0217 -s /sbin/nologin` - Создать учетную запись для пользователя *kiko0217* без возможности входа в систему
-	`chage -d 0 kiko0217` - Потребовать сменить пароль при следующем входе в систему
-	`chage -l kiko0217` - смотреть дату окончанию учётки
-	`chage -E -1 kiko0217` - бессрочная учётка
-	`sudo chage --maxdays 10 username` - включить истечение срока действия пароля через 10 дней
-	`sudo chage --mindays 3 username` - установить минимальное число дней (3) между сменой паролей
-	`sudo chage -W username` - установить кол-во пре дней о предупреждении смены пароля
-	`sudo chage --maxdays -1 username` - выключить истечение срока действия пароля
-	`sudo chage --expiredate YYYY-MM-DD username` - установить дату истечения срока действия учетной записи
-	`sudo chage --lastday 0 username` - вынудить пользователя сменить пароль при следующем входе в систему
-	`usermod kiko0217 -g thenewgroup` - Поменять пользователю *kiko0217* основную группу
-	`usermod kiko0217 -G sudo` - Задать пользователю *kiko0217* дополнительную группу с правами root
-	`usermod -a -G group kiko0217` - Добавить пользователя *kiko0217* в доп. группу
-	`usermod -d /var/www/kiko0217 kiko0217` - сменить домашнюю директорию


# § Привилегии

Для того, чтобы удалить ЛЮБОЙ файл из директории, достаточно иметь бит записи на родительскую директорию (и бит исполнения).

<br/> `chmod -Rv g+rX .` - чтобы на папке получить бит **5**, а на файле - **4** ; выполнять нужно именно с большим **X** ; бит исполнения будет на файлах в поддиректориях, которые к моменту исполнения уже имели бит исполнения; сделает чтение для файлов, но cd для каталогов, т.е. малый **x**.
```c
┌─ kiko0217 ~/storage
└─ $ lz
Octal Permissions Size User     Group    Date Created Name
0755  drwxr-xr-x  1,2k kiko0217 kiko0217  9 апр 16:50  ./
0750  drwxr-x---  138M kiko0217 kiko0217  3 мар 20:09  ../
0755  drwxr-xr-x     0 kiko0217 kiko0217  9 апр 17:16  dir2/
0755  drwxr-xr-x     0 kiko0217 kiko0217  9 апр 17:16  dir3/
0755  drwxr-xr-x     0 kiko0217 kiko0217  9 апр 17:16  dir4/
0644  .rw-r--r--  1,2k kiko0217 kiko0217  9 апр 16:50  file1
0644  .rw-r--r--     0 kiko0217 kiko0217  9 апр 17:15  file2
0644  .rw-r--r--     0 kiko0217 kiko0217  9 апр 17:15  file3
0644  .rw-r--r--     0 kiko0217 kiko0217  9 апр 17:15  file4
┌─ kiko0217 ~/storage
└─ $ chmod 745 dir2 dir3 dir4
┌─ kiko0217 ~/storage
└─ $ ll
итого 24K
drwxr-xr-x  5 kiko0217 kiko0217 4,0K апр  9 17:16 ./
drwxr-x--- 10 kiko0217 kiko0217 4,0K апр  9 16:50 ../
drwxr--r-x  2 kiko0217 kiko0217 4,0K апр  9 17:16 dir2/
drwxr--r-x  2 kiko0217 kiko0217 4,0K апр  9 17:16 dir3/
drwxr--r-x  2 kiko0217 kiko0217 4,0K апр  9 17:16 dir4/
-rw-r--r--  1 kiko0217 kiko0217 1,2K апр  9 16:51 file1
-rw-r--r--  1 kiko0217 kiko0217    0 апр  9 17:15 file2
-rw-r--r--  1 kiko0217 kiko0217    0 апр  9 17:15 file3
-rw-r--r--  1 kiko0217 kiko0217    0 апр  9 17:15 file4
┌─ kiko0217 ~/storage
└─ $ chmod -Rv g+rX .
права доступа '.' оставлены в виде 0755 (rwxr-xr-x)
права доступа './file4' оставлены в виде 0644 (rw-r--r--)
права доступа './dir4' изменены с 0745 (rwxr--r-x) на 0755 (rwxr-xr-x)
права доступа './file2' оставлены в виде 0644 (rw-r--r--)
права доступа './dir3' изменены с 0745 (rwxr--r-x) на 0755 (rwxr-xr-x)
права доступа './dir2' изменены с 0745 (rwxr--r-x) на 0755 (rwxr-xr-x)
права доступа './file3' оставлены в виде 0644 (rw-r--r--)
права доступа './file1' оставлены в виде 0644 (rw-r--r--)
┌─ kiko0217 ~/storage
└─ $ lz
Octal Permissions Size User     Group    Date Created Name
0755  drwxr-xr-x  1,2k kiko0217 kiko0217  9 апр 16:50  ./
0750  drwxr-x---  138M kiko0217 kiko0217  3 мар 20:09  ../
0755  drwxr-xr-x     0 kiko0217 kiko0217  9 апр 17:16  dir2/
0755  drwxr-xr-x     0 kiko0217 kiko0217  9 апр 17:16  dir3/
0755  drwxr-xr-x     0 kiko0217 kiko0217  9 апр 17:16  dir4/
0644  .rw-r--r--  1,2k kiko0217 kiko0217  9 апр 16:50  file1
0644  .rw-r--r--     0 kiko0217 kiko0217  9 апр 17:15  file2
0644  .rw-r--r--     0 kiko0217 kiko0217  9 апр 17:15  file3
0644  .rw-r--r--     0 kiko0217 kiko0217  9 апр 17:15  file4

```


# § Пароли
<br/> см. `getent shadow`
- `user03:$6$CSsX...output omitted...:17933:0:999:7:2:18113:` , где
    - **user03** - имя пользователя учетной записи, которой принадлежит этот пароль;
    - **$6$CSsX...output omitted...** - Зашифрованный пароль пользователя;
    - **17933** - День последнего изменения пароля. Он задается в днях с 01.01.1970 и рассчитывается в часовом поясе UTC;
    - **0** - Минимальное количество дней, которое должно пройти с момента последнего изменения пароля, прежде чем пользователь сможет изменить его снова.
    - **999** - Максимальное количество дней, которое может пройти без смены пароля до окончания срока его действия. Пустое поле означает, что срок действия не заканчивается и не зависит от времени последнего изменения.
    - **7** - Период предупреждения. Пользователь будет предупрежден об окончании срока действия пароля при входе в систему за это количество дней до окончания срока.
    - **2** - Период бездействия. После окончания срока действия пароля он все еще будет приниматься для входа в систему в течение этого количества дней. По окончании этого периода учетная запись будет заблокирована.
    - **18113** - День, когда заканчивается срок действия учетной записи. Он задается в днях с 01.01.1970 и рассчитывается в часовом поясе UTC. Пустое поле означает, что срок действия не заканчивается в определенную дату.

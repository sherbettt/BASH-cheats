См. на robotmoon.com: [A visual guide to SSH tunnels](https://robotmoon.com/ssh-tunnels/)
<br/> Начало в ст.: [Настройка NAT на роутере](https://github.com/sherbettt/BASH-cheats/blob/main/Настройка%20NAT%20для%20роутера%20Ubuntu.md)


### Метод установки SSH-туннеля (Local port forwarding)

Этот метод полезен, если у вас есть доступ к обоим устройствам через SSH и вам нужно временно настроить туннелирование.
Так как обе указанные вами машины находятся в разных сетях, и одна из машин (192.168.56.2) находится за NAT роутером (192.168.56.1), прямая связь невозможна без помощи промежуточного устройства — вашего роутера с тремя интерфейсами.

#### Шаг 1: Предварительный
1. Проверить строку в файле `/etc/ssh/sshd_config`, должно быть: `AllowTcpForwarding yes`
2. Если делаем форвардинг на другие хосты, отличные от 127.0.0.1, проверяем файл `/etc/ssh/ssh_config`, строка `GatewayPorts yes`

#### Шаг 2: создаём SSH-туннель  
   Теперь организуем SSH-туннель от вашей внешней машины (192.168.87.136) к внутренней (192.168.56.2). Мы воспользуемся роутером (192.168.56.1) как транзитным пунктом.

   Команда SSH выглядит следующим образом:

   ```bash
   ssh -L 2222:192.168.56.2:22 root@192.168.56.1
   ```

   Где:
   - `2222`: Порт на вашем внешнем компьютере (192.168.87.136), который теперь переадресуется внутрь.
   - `192.168.56.2:22`: Адрес и порт целевой машины внутри частной сети.
   - `root@192.168.56.1`: Ваш роутер, к которому вы подключаетесь, чтобы создать туннель.

3. **Проверяем работу SSH-туннеля**
   После установления туннельного соединения вы можете проверить работоспособность подключения к целевой машине изнутри внешнего компьютера:

   ```bash
   ssh localhost -p 2222
   ```

   Эта команда должна установить соединение с машиной 192.168.56.2 через открытый туннель.

### Важно!
- Убедитесь, что на всех устройствах открыты необходимые порты (например, TCP 22 для SSH).
- Проверьте настройки безопасности роутера и брандмауэра на обеих машинах, чтобы исключить блокировки соединений.

Эти инструкции позволят вам успешно настроить безопасный SSH-туннель между вашими устройствами даже при наличии разделения сетей.


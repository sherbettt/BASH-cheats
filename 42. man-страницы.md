# Размещение собственных man-страниц

## Стандартные директории для man-страниц

```bash
# Основные директории (по приоритету)
/usr/local/share/man/          # Локально установленные программы
/usr/share/man/                # Системные программы
/opt/<package>/share/man/      # Для программ в /opt
~/.local/share/man/            # Для пользовательских программ
```

## Структура по разделам

```
man1 - пользовательские команды
man2 - системные вызовы  
man3 - библиотечные функции
man5 - форматы файлов
man8 - административные команды
```

## Практический пример

### 1. Создание директории для man-страниц
```bash
# Создаем директорию для раздела 8 (административные команды)
sudo mkdir -p /usr/local/share/man/man8
```

### 2. Создание man-страницы
```bash
# Создаем файл man-страницы
sudo nano /usr/local/share/man/man8/myapp.8
```

### 3. Содержимое man-страницы
```groff
.TH MYAPP 8 "2024-01-15" "v1.0" "My Application Manual"
.SH NAME
myapp \- custom application for system management
.SH SYNOPSIS
.B myapp
[\-h] [\-v] [\-c \fICONFIG\fP]
.SH DESCRIPTION
.B myapp
is a custom system application that provides various services.
.SH OPTIONS
.TP
.B \-h, \-\-help
Show help message and exit
.TP
.B \-v, \-\-verbose
Enable verbose output
.TP
.B \-c, \-\-config \fICONFIG\fP
Specify configuration file
.SH EXAMPLES
.nf
myapp \-c /etc/myapp.conf
myapp \-\-verbose
.fi
.SH FILES
.I /etc/myapp.conf
.RS
Configuration file for myapp
.RE
.I /var/log/myapp.log
.RS
Log file
.RE
.SH SEE ALSO
systemd(1), journalctl(1)
.SH AUTHOR
Maintained by Your Name <email@example.com>
```

### 4. Обновление базы man-страниц
```bash
# Обновляем базу man-страниц
sudo mandb

# Или альтернативно (на некоторых системах)
sudo makewhatis /usr/local/share/man
```

### 5. Проверка доступности
```bash
# Проверяем, что man-страница доступна
man myapp
```

## Альтернативные варианты размещения

### Для системного пакета:
```bash
/usr/share/man/man8/myapp.8
```

### Для пользовательской установки:
```bash
~/.local/share/man/man8/myapp.8
# Добавляем в MANPATH
export MANPATH=$HOME/.local/share/man:$MANPATH
```

### Для программы в /opt:
```bash
/opt/myapp/share/man/man8/myapp.8
# Добавляем в manpath
export MANPATH=/opt/myapp/share/man:$MANPATH
```

## Обновление systemd сервиса

После создания man-страницы обновите сервисный файл:

```ini
[Unit]
Description=My Custom Service
Documentation=man:myapp(8)
# остальная конфигурация...
```

## Проверка всей цепочки

```bash
# Проверяем ссылку Documentation в systemd
systemctl show my-service.service -p Documentation

# Проверяем доступность man-страницы
man -w myapp        # Показывает путь к man-странице
man myapp           # Открывает man-страницу

# Проверяем сервис
systemctl status my-service.service
```

## Дополнительные возможности

### Несколько разделов:
```bash
/usr/local/share/man/man1/myapp.1      # Команда пользователя
/usr/local/share/man/man5/myapp.conf.5 # Конфигурационный файл
/usr/local/share/man/man8/myappd.8     # Демон
```

### Сжатие man-страниц (опционально):
```bash
# Сжимаем man-страницу
gzip /usr/local/share/man/man8/myapp.8
# Будет доступна как myapp.8.gz
```

Теперь ваша man-страница будет автоматически находиться systemd и доступна через команду `man myapp`.

---------------------------------------------------------------


 **Groff** - специальный язык разметки для создания man-страниц (и других документов). Это наследник старого **troff** системы.

## Основные команды Groff:

### .TH - Заголовок страницы
```groff
.TH MYAPP 8 "2024-01-15" "v1.0" "My Application Manual"
```
- `MYAPP` - имя команды
- `8` - раздел man (8 = административные команды)
- `"2024-01-15"` - дата
- `"v1.0"` - версия
- `"My Application Manual"` - описание

### .SH - Заголовок раздела
```groff
.SH NAME
.SH SYNOPSIS
.SH DESCRIPTION
```

### Форматирование текста
```groff
.B text    # Жирный (Bold)
.I text    # Курсив (Italic)
\fBtext\fP # Альтернативный способ (Bold)
\fItext\fP # Альтернативный способ (Italic)
```

### Специальные символы
```groff
\-        # Дефис (экранирование)
\\        # Обратный слеш
```

## Более простой пример для понимания:

```groff
.TH HELLO 1 "2024-01-15" "v1.0" "Simple Hello World"
.SH NAME
hello \- prints hello world
.SH SYNOPSIS
.B hello
[\-n \fINAME\fP]
.SH DESCRIPTION
.B hello
is a simple program that prints greeting messages.
.SH OPTIONS
.TP
.B \-n, \-\-name \fINAME\fP
Specify name to greet (default: World)
.SH EXAMPLES
.nf
hello
hello \-n Alice
.fi
.SH AUTHOR
John Doe
```

## Альтернативы создания man-страниц:

### 1. Markdown -> Groff (современный способ)
```bash
# Установите pandoc
sudo apt install pandoc

# Создайте markdown файл
cat > myapp.md << 'EOF'
% MYAPP(8) v1.0 | My Application Manual
% 2024-01-15

# NAME
myapp - custom application for system management

# SYNOPSIS
**myapp** [*-h*] [*-v*] [*-c* *CONFIG*]

# DESCRIPTION
**myapp** is a custom system application.

# OPTIONS
*-h, --help*
: Show help message

*-v, --verbose*
: Enable verbose output

*-c, --config* *CONFIG*
: Specify config file
EOF

# Конвертируйте в man-страницу
pandoc -s -t man myapp.md -o myapp.8
```

### 2. Использование готовых генераторов

**ronn** (Ruby):
```bash
sudo gem install ronn
```

**scdoc** (простой):
```bash
# Создайте .scd файл
cat > myapp.scd << 'EOF'
myapp(8) - "My Application"
# NAME

myapp - custom application for system management

# SYNOPSIS

*myapp* [-h] [-v] [-c _CONFIG_]

# DESCRIPTION

**myapp** is a custom system application.
EOF

scdoc < myapp.scd > myapp.8
```

### 3. Самый простой вариант - plain text
```bash
sudo nano /usr/local/share/man/man8/myapp.8
```
```text
MYAPP(8)                System Manager's Manual               MYAPP(8)

NAME
     myapp – custom application for system management

SYNOPSIS
     myapp [-h] [-v] [-c CONFIG]

DESCRIPTION
     myapp is a custom system application that provides various services.

OPTIONS
     -h, --help
             Show help message and exit

     -v, --verbose
             Enable verbose output

     -c, --config CONFIG
             Specify configuration file

SEE ALSO
     systemd(1), journalctl(1)

AUTHOR
     Maintained by Your Name <email@example.com>
```

## Рекомендация для начала:

Используйте **Markdown + pandoc** - это намного проще, чем изучать Groff. Когда Markdown файл готов, просто сконвертируйте его в man-страницу одной командой.

---------------------------------------------------------------

# Полный пример создания man-страницы из Markdown

## 1. Установка необходимых инструментов

```bash
# Устанавливаем pandoc
sudo apt update && sudo apt install pandoc

# Проверяем установку
pandoc --version
```

## 2. Создаем Markdown файл

```bash
# Создаем директорию для проекта
mkdir ~/myapp-manpage
cd ~/myapp-manpage

# Создаем Markdown файл
nano myapp.md
```

## 3. Содержимое Markdown файла

````markdown
% MYAPP(8) Version 1.0 | My Application Manual
% Your Name
% January 19, 2027

# NAME

myapp - custom application for system management

# SYNOPSIS

**myapp** [*OPTIONS*] [*COMMAND*]

# DESCRIPTION

**myapp** is a custom system application that provides various services for system administration and monitoring.

The application supports multiple operation modes and can be configured via command-line options or configuration files.

# OPTIONS

*-h, --help*
: Show help message and exit

*-v, --verbose*
: Enable verbose output. Use multiple times for more detail (e.g., -vvv)

*-c, --config* *FILE*
: Specify configuration file (default: /etc/myapp/config.yaml)

*-d, --daemon*
: Run as daemon in background

*-l, --log-level* *LEVEL*
: Set log level (debug, info, warning, error). Default: info

# COMMANDS

*start*
: Start the service

*stop*
: Stop the service

*status*
: Show service status

*reload*
: Reload configuration

# CONFIGURATION

Configuration is read from */etc/myapp/config.yaml*. Example configuration:

```yaml
server:
  host: localhost
  port: 8080
database:
  url: postgresql://localhost/myapp
logging:
  level: info
  file: /var/log/myapp.log
```

# FILES

*/etc/myapp/config.yaml*
: Main configuration file

*/var/log/myapp.log*
: Log file

*/var/run/myapp.pid*
: PID file when running in daemon mode

# EXAMPLES

Start the application in foreground:
```bash
myapp --config /etc/myapp/config.yaml
```

Run as daemon with verbose logging:
```bash
myapp --daemon --verbose --log-level debug
```

Check service status:
```bash
myapp status
```

# ENVIRONMENT

*MYAPP_CONFIG*
: Alternative configuration file path

*MYAPP_LOG_LEVEL*
: Set log level (overrides command line)

# EXIT STATUS

*0*
: Success

*1*
: General error

*2*
: Configuration error

*3*
: Network error

# SEE ALSO

**systemd**(8), **journalctl**(1), **myapp.conf**(5)

# BUGS

Report bugs to <your-email@example.com>

# AUTHOR

Your Name <your-email@example.com>

# COPYRIGHT

Copyright © 2024 Your Name. License MIT.
````

## 4. Конвертация в man-страницу

```bash
# Конвертируем Markdown в man-страницу
pandoc -s -t man myapp.md -o myapp.8

# Просматриваем результат
man ./myapp.8
```

## 5. Установка man-страницы в систему

```bash
# Создаем директорию для man-страниц
sudo mkdir -p /usr/local/share/man/man8

# Копируем man-страницу
sudo cp myapp.8 /usr/local/share/man/man8/

# Обновляем базу man-страниц
sudo mandb

# Проверяем установку
man myapp
```

## 6. Автоматизация скриптом

Создаем скрипт для автоматизации процесса:

```bash
nano build-manpage.sh
```

```bash
#!/bin/bash

# Script to build and install manpage from Markdown

set -e

APP_NAME="myapp"
MAN_SECTION="8"
MD_FILE="${APP_NAME}.md"
MAN_FILE="${APP_NAME}.${MAN_SECTION}"
INSTALL_DIR="/usr/local/share/man/man${MAN_SECTION}"

echo "Building manpage from ${MD_FILE}..."

# Check if pandoc is installed
if ! command -v pandoc &> /dev/null; then
    echo "Error: pandoc is not installed. Please install it first."
    echo "sudo apt install pandoc"
    exit 1
fi

# Check if markdown file exists
if [ ! -f "$MD_FILE" ]; then
    echo "Error: ${MD_FILE} not found!"
    exit 1
fi

# Convert markdown to manpage
echo "Converting ${MD_FILE} to ${MAN_FILE}..."
pandoc -s -t man "$MD_FILE" -o "$MAN_FILE"

if [ $? -eq 0 ]; then
    echo "Successfully created ${MAN_FILE}"
else
    echo "Error converting file"
    exit 1
fi

# Install manpage
echo "Installing manpage to ${INSTALL_DIR}..."
sudo mkdir -p "$INSTALL_DIR"
sudo cp "$MAN_FILE" "$INSTALL_DIR/"

# Update man database
echo "Updating man database..."
sudo mandb

echo "Manpage installed successfully!"
echo "You can now view it with: man ${APP_NAME}"
```

Делаем скрипт исполняемым и запускаем:
```bash
chmod +x build-manpage.sh
./build-manpage.sh
```

## 7. Интеграция с systemd сервисом

Обновляем systemd unit файл:

```ini
[Unit]
Description=My Custom Application
Documentation=man:myapp(8)
After=network.target

[Service]
Type=simple
ExecStart=/usr/local/bin/myapp --daemon --config /etc/myapp/config.yaml
ExecReload=/bin/kill -HUP $MAINPID
Restart=on-failure

[Install]
WantedBy=multi-user.target
```

## 8. Проверка всей системы

```bash
# Проверяем man-страницу
man myapp

# Проверяем ссылку в systemd
systemctl cat myapp.service | grep Documentation

# Проверяем, что man-страница находится
man -w myapp

# Ищем все связанные man-страницы
apropos myapp
```

## Преимущества этого подхода:

1. **Простота** - Markdown легче читать и писать
2. **Совместимость** - можно конвертировать в HTML, PDF и другие форматы
3. **Версионный контроль** - Markdown отлично работает с Git
4. **Подсветка синтаксиса** - в любом редакторе
5. **Автоматизация** - легко интегрировать в процесс сборки

Теперь у вас есть полная система для создания и поддержки man-страниц!

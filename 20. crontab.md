## § Crontab

**Crontab** — это утилита для планирования выполнения команд или скриптов в заданное время.  

---

### **1. Основные команды crontab**  

| Команда | Описание |
|---------|----------|
| `crontab -e` | Редактировать файл crontab (откроется в текстовом редакторе) |
| `crontab -l` | Просмотреть текущие задачи crontab |
| `crontab -r` | Удалить все задачи crontab (осторожно!) |
| `crontab -u USERNAME -e` | Редактировать crontab другого пользователя (требуются права root) |

---

### **2. Формат записи в crontab**  

Каждая строка в crontab имеет следующий формат:  

```sh
* * * * * команда_или_скрипт
│ │ │ │ │
│ │ │ │ └─── День недели (0-7, 0 и 7 = воскресенье)
│ │ │ └───── Месяц (1-12)
│ │ └─────── День месяца (1-31)
│ └───────── Час (0-23)
└─────────── Минута (0-59)
```

#### **Примеры:**  

| Пример | Описание |
|--------|----------|
| `0 * * * * /path/to/script.sh` | Запускать каждый час (в **:00) |
| `*/15 * * * * /path/to/script.sh` | Запускать каждые 15 минут |
| `0 3 * * * /path/to/backup.sh` | Запускать каждый день в 3:00 ночи |
| `0 0 * * 0 /path/to/cleanup.sh` | Запускать каждое воскресенье в 00:00 |
| `30 4 1 * * /path/to/report.sh` | Запускать 1-го числа каждого месяца в 4:30 |
| `@reboot /path/to/startup.sh` | Запускать при перезагрузке системы |

---

### **3. Специальные символы**  

| Символ | Описание |
|--------|----------|
| `*` | Любое значение (все минуты, все часы и т. д.) |
| `,` | Перечисление (например, `1,3,5` для 1-й, 3-й и 5-й минуты) |
| `-` | Диапазон (например, `1-5` для минут с 1 по 5) |
| `*/n` | Каждые `n` единиц времени (например, `*/10` — каждые 10 минут) |

---

### **4. Логирование вывода**  

По умолчанию вывод команд не сохраняется. Чтобы записать его в файл:  

```sh
* * * * * /path/to/script.sh >> /var/log/cron.log 2>&1
```
- `>>` — добавляет вывод в конец файла  
- `2>&1` — перенаправляет stderr в stdout  

---

### **5. Переменные окружения**  

Cron использует минимальное окружение, поэтому лучше указывать полные пути.  
Можно задать переменные в начале crontab:  

```sh
SHELL=/bin/bash
PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin
MAILTO=user@example.com  # Отправлять уведомления на почту

* * * * * /path/to/script.sh
```

---

### **6. Проверка и отладка**  

- Проверить логи cron:  
  ```sh
  sudo tail -f /var/log/syslog | grep cron
  ```
  
- Проверить, работает ли cron:  
  ```sh
  sudo systemctl status cron
  ```

---



```bash
[student@workstation ~]$ cat /etc/crontab
SHELL=/bin/bash
PATH=/sbin:/bin:/usr/sbin:/usr/bin
MAILTO=root

# For details see man 4 crontabs

# Example of job definition:
# .---------------- minute (0 - 59)
# |  .------------- hour (0 - 23)
# |  |  .---------- day of month (1 - 31)
# |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...
# |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat
# |  |  |  |  |
# *  *  *  *  * user-name  command to be executed
```
[crontab.online](https://crontab.online/ru/?c=between-certain-hours&t=hours)

- Следующее задание выполняет команду **/usr/local/bin/yearly_backup** ежегодно 2 февраля ровно в 9:00.
 <br/> `0 9 2 2 * /usr/local/bin/yearly_backup`
- Следующее задание отправляет сообщение электронной почты, содержащее слово *Chime*, владельцу этого задания каждые пять минут с 9:00 до 17:00 каждую пятницу в июле.
 <br/> `*/5 9-16 * Jul 5 echo "Chime"`
- Следующее задание выполняет команду **/usr/local/bin/daily_report** каждый будний день за две минуты до полуночи.
 <br/> `58 23 * * 1-5 /usr/local/bin/daily_report`
- Следующее задание выполняет команду **mutt** для отправки электронного письма *Checking in* получателю *boss@example.com* каждый рабочий день (c понедельника по пятницу) в 9:00.
 <br/> `0 9 * * 1-5 mutt -s "Checking in" boss@example.com % Hi there boss, just checking in.`
- Crontab Каждые 7 минут
 <br/> `*/7 * * * *`
- Cron триггер каждый день.
 <br/> `0 0 * * *`
- Cron триггер еженедельно.
 <br/> `0 0 * * 0`
- Каждые полчаса.
 <br/> `0,30 * * * *`
- Каждый час на 30 минутах.
 <br/> `30 * * * *`
- Crontab Каждое воскресенье.
 <br/> `0 0 * * 0`
- Crontab Каждую субботу.
 <br/> `0 0 * * 6`
- Crontab Ежедневно с 8 до 17 часов
 <br/> `0 8-17 * * *`
------------------------------------------------------------
[упражнение-ch02s04](https://rh.schelcol.ru/curse%202/ch02s04.html)


# Создание deb пакета

предварительно см. 
- [сборка pyinstaller в uv](https://github.com/sherbettt/BASH-cheats/blob/main/32.%20uv%20для%20python.md)
- [Описание процесса сборки пакета deb](https://www.dmosk.ru/instruktions.php?object=build-deb)
- [Обязательные файлы в каталоге debian](https://www.debian.org/doc/manuals/maint-guide/dreq.ru.html#rules)


## Подготовка системы
```bash
apt update; apt install -y debhelper dpkg-dev devscripts equivs;
```
<br/>


## Общий вид

Предположим, у нас есть какой-то python проект:
```bash
root@For-DEB12-builds ~/git
12:06:00 # ll runtel_opensips_sbc/
итого 639k
drwxr-xr-x 8 root root 4,1k янв 19 11:26  ./
drwxr-xr-x 7 root root 4,1k янв 19 11:38  ../
drwxr-xr-x 7 root root 4,1k янв 13 11:37  .git/
drwxr-xr-x 5 root root 4,1k янв 19 09:09  .venv/
drwxr-xr-x 3 root root 4,1k янв 19 09:37  build/
drwxr-xr-x 6 root root 4,1k янв 19 11:32  debian/
drwxr-xr-x 2 root root 4,1k янв 19 09:37  dist/
drwxr-xr-x 6 root root 4,1k янв 15 06:51  web-ui/
-rw-r--r-- 1 root root  82k янв 19 08:58  app.db
-rw-r--r-- 1 root root 123k янв 13 11:27  app.py
*****
-rwxr-xr-x 1 root root 1,7k янв 13 11:27  block_ip_fail2ban.py*
*****
-rwxr-xr-x 1 root root 1,8k янв 13 11:27  init_rate_limits.py*
*****
# и т.д.
```

Собранный, исполняемый файл
```bash
root@For-DEB12-builds ~/git
12:07:02 # ll runtel_opensips_sbc/dist/
итого 25M
drwxr-xr-x 2 root root 4,1k янв 19 09:37 ./
drwxr-xr-x 8 root root 4,1k янв 19 11:26 ../
-rwxr-xr-x 1 root root  25M янв 19 09:37 sbc-app*
```

Переходим в директорию `runtel_opensips_sbc` и создаём типовую директорию для сборки `debian` с содержимым:
```bash
root@For-DEB12-builds ~/git/runtel_opensips_sbc/debian
12:14:47 # ll
-rw-r--r-- 1 root root  644 янв 19 11:28 changelog
-rw-r--r-- 1 root root    2 янв 13 11:46 compat
-rw-r--r-- 1 root root  970 янв 19 11:18 control
-rw-r--r-- 1 root root  301 янв 19 11:27 copyright
-rw-r--r-- 1 root root  382 янв 15 07:24 install_old
-rwxr-xr-x 1 root root  173 янв 16 11:59 rules*
-rw-r--r-- 1 root root   99 янв 19 10:46 runtel-sbc-app.install
-rw-r--r-- 1 root root  383 янв 16 12:18 runtel-sbc-cfg.install
-rw-r--r-- 1 root root  530 янв 15 07:42 runtel-sbc-web.install
```

1. Файл `install` переименован в `install_old`, если мы брали содержимое данной папки за основу из другого проекта.
2. Файлы `runtel-sbc-*` созданы руками для проекта.
<br/>


## Примеры файлов:

### **changelog**
```bash
root@For-DEB12-builds ~/git/runtel_opensips_sbc/debian
12:19:22 # ccat changelog
runtel-sbc (1.0.0-8) unstable; urgency=medium

  * Добавлен файл copyright
  * Исправлен день недели в changelog

 -- Runtel <support@runtel.ru>  Mon, 19 Jan 2026 11:30:00 +0300

runtel-sbc (1.0.0-7) unstable; urgency=medium

  * Добавлен пакет runtel-sbc-app с собранным бинарником
  * Исправлена архитектура на amd64

 -- Runtel <support@runtel.ru>  Mon, 19 Jan 2025 11:21:00 +0300

runtel-sbc (1.0.0-6) unstable; urgency=medium

  * Initial release with runtel-sbc-cfg and runtel-sbc-web

 -- Runtel <support@runtel.ru>  Thu, 16 Jan 2025 12:19:00 +0300
```

**Зачем нужен changelog?**
1. **История изменений** - что, когда и кем было изменено
2. **Версионирование** - контроль версий пакета
3. **Информация для пользователей** - что нового в обновлении
4. **Требование Debian Policy** - обязательный файл для пакетов
5. **Автоматическая генерация** - используется инструментами сборки


### **rules**
Это `Makefile`, который управляет процессом сборки пакета. Он использует систему `debhelper` — набор утилит для автоматизации сборки Debian пакетов.
```bash
root@For-DEB12-builds ~/git/runtel_opensips_sbc/debian
12:19:28 # ccat rules 
#!/usr/bin/make -f
# See debhelper(7) (uncomment to enable)
# output every command that modifies files on the build system.
DH_VERBOSE = 1
export DH_OPTIONS=-v

%:  
        dh $@
```















Вот отформатированный текст с сохранением структуры и выделением важных элементов:


# § Пользователи

## Общее
Список пользователей посмотреть в файле */etc/passwd*  
или командой: `getent passwd`  
Пароли хранятся в виде хешей в */etc/shadow*  
Проверить существование пользователя: `id <username>`  

-----------------------------------------------------

Пример записи пользователя:  
`user01:x:1000:1000:User One:/home/user01:/bin/bash`, где:
- **user01** - имя пользователя
- **x** - Пароль пользователя (теперь хранится в /etc/shadow)
- **1000** - UID пользователя
- **1000** - GID основной группы
- **User One** - полное имя пользователя
- **/home/user01** - домашний каталог
- **/bin/bash** - оболочка по умолчанию

## Добавление:
1) `useradd <имя пользователя> [опции]`
   - `-p` - Задает пароль [useradd kiko0217 -p pass]
   - `-c` - Комментарий [useradd kiko0217 -c "Описание"]
   - `-m` - Создать домашний каталог
   - `-b` - Базовый каталог для домашнего [useradd kiko0217 -b /var/home]
   - `-d` - Полный путь к домашнему каталогу [useradd kiko0217 -d /home/dmosk]
   - `-s` - Оболочка [useradd kiko0217 -s /bin/csh]
   - `-U` - Группа с именем как у пользователя
   - `-G` - Дополнительные группы
   - `-g` - Основная группа [useradd kiko0217 -g altgroup]

2) `usermod -a -G <группы через запятую> <пользователь>`

Пример:
```bash
sudo useradd -m -d /home/napo0721 -c "NC QA engineer" -G astra-admin napo0721
sudo passwd napo0721
```

## Редактирование:
1) Изменить имя: `sudo usermod --login new_username username`
2) Изменить UID: `sudo usermod --uid id username`
3) Изменить оболочку: `sudo usermod --shell path/to/shell username`
4) Изменить домашнюю папку: `sudo usermod --move-home --home path/to/new_home username`
5) Добавить группы: `sudo usermod --append --groups group1,group2,... username`
6) Смена пароля: 
   - `passwd` - для текущего пользователя
   - `passwd <username>` - для конкретного пользователя
7) Генерация хэша: `mkpasswd -m sha-512`

Пример изменения домашнего каталога:
```bash
# Создать каталог
sudo mkdir /home/napo0721
sudo chown napo0721:napo0721 /home/napo0721

# Изменить домашний каталог
grep napo0721 /etc/passwd
sudo usermod --home /home/napo0721 napo0721
```

## Удаление:
**Конфиги в /etc/deluser.conf**
1) `userdel [опции] <имя_пользователя>`
   - `-f, --force` - Принудительное удаление
   - `-r, --remove` - Удалить домашнюю директорию
   - `-Z, --selinux-user` - Удалить только SELinux-объекты

2) `deluser [опции] <имя_пользователя>`
   - `--remove-all-files` - Удалить все файлы пользователя
   - `--remove-all-groups` - Удалить из всех групп

3) Удаление из группы:  
   `gpasswd --delete <пользователь> <группы через запятую>`

-----------------------------------------------------

# § Группы
1) `groupadd <группа> [опции]` - добавление
2) `groupmod <группа> [опции]` - редактирование
3) `groupdel <группа> [опции]` - удаление

-----------------------------------------------------
Пример записи группы (`getent passwd`):  
`group01:x:978:root,user1,user2`, где:
- **group01** - имя группы
- **x** - Пароль (теперь в /etc/shadow)
- **978** - GID группы
- **root,user1,user2** - Участники группы

#### Примеры
- `sudo useradd napo0721 -G wheel -m` - Для CentOS (права sudo)
- `sudo useradd napo0721 -G sudo -m` - Для DEB-систем
- `useradd dmosk -u 900 -g 950` - Создать с определенными UID/GID
- `useradd kiko0217 -d /home/new_kiko0217` - Указать домашний каталог
- `useradd kiko0217 -s /sbin/nologin` - Без возможности входа
- `chage -d 0 kiko0217` - Требовать смену пароля при входе
- `chage -l kiko0217` - Просмотр срока учетной записи
- `chage -E -1 kiko0217` - Сделать учетку бессрочной
- `usermod kiko0217 -g the_new_group` - Сменить основную группу
- `usermod kiko0217 -G sudo` - Дать права root
- `usermod -a -G group kiko0217` - Добавить в доп. группу
- `usermod -d /var/www/kiko0217 kiko0217` - Сменить домашний каталог

# § Привилегии

Для удаления ЛЮБОГО файла из директории достаточно иметь права записи на родительскую директорию (и право исполнения).

- `chmod -Rv g+rX .` - Дать права: папки 5, файлы 4 (с большой X)
- `chmod -Rv g+rX .` - Сделает чтение для файлов, но cd для каталогов

## Специальные разрешения:
| Значение | Обозначение | Описание |
|----------|-------------|----------|
| **4**    | u+s (suid)  | Для бинарных файлов (не работает со скриптами) |
| **2**    | g+s (sgid)  | Файл выполняется от имени группы-владельца |
| **1**    | o+t (sticky)| Пользователи могут удалять только свои файлы |

Примеры:
```bash
$ lz /usr/bin/ssh-agent
2755  .rwxr-sr-x  310k root _ssh   8 апр 11:37  /usr/bin/ssh-agent*

$ lz /usr/bin/su
4755  .rwsr-xr-x   56k root root   3 мар 20:10  /usr/bin/su*
```

Начальные права файлов определяются:
1. Типом создаваемого объекта (файл/каталог)
2. Текущей umask (обычно настраивается в /etc/profile.d/local-umask.sh)

Пример umask:
```bash
if [ $UID -gt 199 ] && [ "`id -gn`" = "`id -un`" ]; then
    umask 007
else
    umask 022
fi
```





# § Пароли
<br/> см. `getent shadow`
- `user03:$6$CSsX...output omitted...:17933:0:999:7:2:18113:` , где
    - **user03** - имя пользователя учетной записи, которой принадлежит этот пароль;
    - **$6$CSsX...output omitted...** - Зашифрованный пароль пользователя;
    - **17933** - День последнего изменения пароля. Он задается в днях с 01.01.1970 и рассчитывается в часовом поясе UTC;
    - **0** - Минимальное количество дней, которое должно пройти с момента последнего изменения пароля, прежде чем пользователь сможет изменить его снова.
    - **999** - Максимальное количество дней, которое может пройти без смены пароля до окончания срока его действия. Пустое поле означает, что срок действия не заканчивается и не зависит от времени последнего изменения.
    - **7** - Период предупреждения. Пользователь будет предупрежден об окончании срока действия пароля при входе в систему за это количество дней до окончания срока.
    - **2** - Период бездействия. После окончания срока действия пароля он все еще будет приниматься для входа в систему в течение этого количества дней. По окончании этого периода учетная запись будет заблокирована.
    - **18113** - День, когда заканчивается срок действия учетной записи. Он задается в днях с 01.01.1970 и рассчитывается в часовом поясе UTC. Пустое поле означает, что срок действия не заканчивается в определенную дату.

<br/>  **/etc/login.defs** - конфигурационный файл в системах Linux, который содержит настройки shadow password suite.
<br/> Некоторые параметры, которые можно настроить в этом файле:
- **PASS_MAX_DAYS** — максимальное число дней, в течение которых действует пароль учётной записи пользователя. Если пароль старее этого числа, то запускается процедура смены пароля. 
- **PASS_MIN_DAYS** — минимальное число дней, которое должен подождать пользователь перед сменой пароля. 
- **PASS_WARN_AGE** — число дней, за которое выдаётся предупреждение об устаревании пароля. Нулевое значение означает, что предупреждение выдаётся в день устаревания, при отрицательном значении предупреждение выдаваться не будет. 
- **UID_MIN** и **UID_MAX** — минимальные и максимальные значения идентификаторов пользователей (UID), которые назначаются обычным пользователям командой useradd. 
- **GID_MIN** и **GID_MAX** — минимальные и максимальные значения идентификаторов групп (GID), которые назначаются обычным группам командой groupadd. 
- **CREATE_HOME** — определяет, должен ли создаваться по умолчанию домашний каталог для новых пользователей. 
- **UMASK** — umask по умолчанию для новых файлов и каталогов, которые создают пользователи. 

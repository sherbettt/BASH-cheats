
### Управление пользователями в Linux (на примере пользователя `napo0721`)

#### 1. **Создание пользователя**
```bash
sudo useradd napo0721  # Создает пользователя без домашней директории
sudo useradd -m napo0721  # Создает пользователя с домашней директорией (/home/napo0721)
sudo passwd napo0721  # Устанавливает пароль для пользователя
```
или начать с создания группы сразу
```bash
sudo groupadd napo0721
```
Дополнительные опции:
```bash
sudo useradd -m -s /bin/bash -c "QA engineer" -g napo0721 napo0721
sudo useradd -m -s /bin/bash -c "QA engineer" -G sudo,docker napo0721
```
- `-m` – создать домашнюю директорию.  
- `-s /bin/bash` – указать оболочку (по умолчанию может быть `/bin/sh`).  
- `-c "Комментарий"` – добавить описание.
- `-g` – добавить основную группу
- `-G sudo,docker` – добавить пользователя в дополнительные группы.  

#### 2. **Удаление пользователя**
```bash
sudo userdel napo0721  # Удаляет пользователя, но оставляет его домашнюю директорию
sudo userdel -r napo0721  # Удаляет пользователя вместе с домашней директорией
```

#### 3. **Редактирование пользователя**
```bash
sudo usermod -s /bin/zsh napo0721  # Изменить оболочку пользователя
sudo usermod -aG sudo napo0721  # Добавить пользователя в группу sudo (без -aG перезапишет группы)
sudo usermod -L napo0721  # Заблокировать пользователя
sudo usermod -U napo0721  # Разблокировать пользователя
```
<br/>


### Привилегии
Для удаления ЛЮБОГО файла из директории достаточно иметь права записи на родительскую директорию (и право исполнения).
- `chmod -Rv g+rX .` - Дать права: папки 5, файлы 4 (с большой X)
- `chmod -Rv g+rX .` - Сделает чтение для файлов, но cd для каталогов


### **Специальные разрешения в Linux**
В Linux есть три специальных разрешения:
1. **SUID (Set User ID)** – файл выполняется с правами владельца.  
   ```bash
   chmod u+s /path/to/file  # Установить SUID
   chmod 4755 /path/to/file  # Числовая форма (4 - SUID)
   ```
   Пример: `passwd` (`/usr/bin/passwd`) имеет SUID, чтобы обычные пользователи могли менять свой пароль.

2. **SGID (Set Group ID)** – файл выполняется с правами группы, а для директорий новые файлы наследуют группу.  
   ```bash
   chmod g+s /path/to/dir_or_file  # Установить SGID
   chmod 2755 /path/to/dir  # Числовая форма (2 - SGID)
   ```

3. **Sticky Bit** – только владелец или root может удалять файлы в директории (используется в `/tmp`).  
   ```bash
   chmod +t /path/to/dir  # Установить Sticky Bit
   chmod 1777 /tmp  # Числовая форма (1 - Sticky Bit)
   ```

Проверить:
```bash
ls -l /tmp  # Видно 't' в правах: drwxrwxrwt
```


| Значение | Обозначение | Описание |
|----------|-------------|----------|
| **4**    | u+s (suid)  | Для бинарных файлов (не работает со скриптами) |
| **2**    | g+s (sgid)  | Файл выполняется от имени группы-владельца |
| **1**    | o+t (sticky)| Пользователи могут удалять только свои файлы |

Примеры:
```bash
$ lz /usr/bin/ssh-agent
2755  .rwxr-sr-x  310k root _ssh   8 апр 11:37  /usr/bin/ssh-agent*

$ lz /usr/bin/su
4755  .rwsr-xr-x   56k root root   3 мар 20:10  /usr/bin/su*
```

Начальные права файлов определяются:
1. Типом создаваемого объекта (файл/каталог)
2. Текущей umask (обычно настраивается в /etc/profile.d/local-umask.sh)

Пример umask:
```bash
if [ $UID -gt 199 ] && [ "`id -gn`" = "`id -un`" ]; then
    umask 007
else
    umask 022
fi
```
<br/>



### **Управление группами в Linux**

#### 1. **Создание группы**
```bash
sudo groupadd developers  # Создает группу developers
```

#### 2. **Удаление группы**
```bash
sudo groupdel developers  # Удаляет группу (если она не является основной для пользователей)
```

#### 3. **Редактирование группы**
```bash
sudo groupmod -n devs developers  # Переименовать группу developers в devs
sudo gpasswd -a napo0721 devs  # Добавить пользователя napo0721 в группу devs
sudo gpasswd -d napo0721 devs  # Удалить пользователя из группы
```

#### 4. **Просмотр групп пользователя**
```bash
groups napo0721  # Показать группы пользователя napo0721
id napo0721  # Показать UID, GID и группы
```

#### 5. **Изменение основной группы пользователя**
```bash
sudo usermod -g devs napo0721  # Изменить основную группу пользователя
```
<br/>



### **Итоговые примеры**

#### Пример 1: Создать пользователя, добавить в группы, задать пароль
```bash
sudo useradd -m -s /bin/bash -G sudo,developers napo0721
sudo passwd napo0721
```

#### Пример 2: Установить SUID на скрипт
```bash
chmod u+x /usr/local/bin/myscript.sh
chmod u+s /usr/local/bin/myscript.sh
```

#### Пример 3: Создать общую папку с SGID
```bash
sudo mkdir /shared
sudo chown :developers /shared
sudo chmod 2775 /shared  # Теперь файлы в /shared будут наследовать группу developers
```
-------------------------------------------------

# § Пароли
<br/> см. `getent shadow`
- `user03:$6$CSsX...output omitted...:17933:0:999:7:2:18113:` , где
    - **user03** - имя пользователя учетной записи, которой принадлежит этот пароль;
    - **$6$CSsX...output omitted...** - Зашифрованный пароль пользователя;
    - **17933** - День последнего изменения пароля. Он задается в днях с 01.01.1970 и рассчитывается в часовом поясе UTC;
    - **0** - Минимальное количество дней, которое должно пройти с момента последнего изменения пароля, прежде чем пользователь сможет изменить его снова.
    - **999** - Максимальное количество дней, которое может пройти без смены пароля до окончания срока его действия. Пустое поле означает, что срок действия не заканчивается и не зависит от времени последнего изменения.
    - **7** - Период предупреждения. Пользователь будет предупрежден об окончании срока действия пароля при входе в систему за это количество дней до окончания срока.
    - **2** - Период бездействия. После окончания срока действия пароля он все еще будет приниматься для входа в систему в течение этого количества дней. По окончании этого периода учетная запись будет заблокирована.
    - **18113** - День, когда заканчивается срок действия учетной записи. Он задается в днях с 01.01.1970 и рассчитывается в часовом поясе UTC. Пустое поле означает, что срок действия не заканчивается в определенную дату.

<br/>  **/etc/login.defs** - конфигурационный файл в системах Linux, который содержит настройки shadow password suite.
<br/> Некоторые параметры, которые можно настроить в этом файле:
- **PASS_MAX_DAYS** — максимальное число дней, в течение которых действует пароль учётной записи пользователя. Если пароль старее этого числа, то запускается процедура смены пароля. 
- **PASS_MIN_DAYS** — минимальное число дней, которое должен подождать пользователь перед сменой пароля. 
- **PASS_WARN_AGE** — число дней, за которое выдаётся предупреждение об устаревании пароля. Нулевое значение означает, что предупреждение выдаётся в день устаревания, при отрицательном значении предупреждение выдаваться не будет. 
- **UID_MIN** и **UID_MAX** — минимальные и максимальные значения идентификаторов пользователей (UID), которые назначаются обычным пользователям командой useradd. 
- **GID_MIN** и **GID_MAX** — минимальные и максимальные значения идентификаторов групп (GID), которые назначаются обычным группам командой groupadd. 
- **CREATE_HOME** — определяет, должен ли создаваться по умолчанию домашний каталог для новых пользователей. 
- **UMASK** — umask по умолчанию для новых файлов и каталогов, которые создают пользователи. 
----------------------


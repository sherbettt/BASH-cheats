NFS-Ganesha –º–æ–∂–µ—Ç –±—ã—Ç—å —Ö–æ—Ä–æ—à–µ–π –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–æ–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–º—É `nfs-kernel-server` –¥–ª—è –Ω–∞—à–µ–≥–æ –∫–ª–∞—Å—Ç–µ—Ä–∞ Jira, –æ—Å–æ–±–µ–Ω–Ω–æ –µ—Å–ª–∏ —É –Ω–∞—Å –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ —è–¥—Ä–æ (6.8.12-9-pve).  
<br/> [–í–µ—Ä—Å–∏–∏ nfs-ganesha](https://download.nfs-ganesha.org/)
<br/> [Homa page on GitHub](https://github.com/nfs-ganesha/nfs-ganesha/wiki)
<br/> [github.com/nfs-ganesha/nfs-ganesha](https://github.com/nfs-ganesha/nfs-ganesha)
<br/> [How To Install nfs-ganesha on Ubuntu](https://ubuntututorial.org/install-nfs-ganesha-ubuntu/)
<br/> [Configuring NFS-Ganesha over GlusterFS](https://docs.gluster.org/en/main/Administrator-Guide/NFS-Ganesha-GlusterFS-Integration/)
<br/> []()

----------------------------------------------------------------------------------
###  –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å NFS-Ganesha —Å Jira
 **NFS-Ganesha** –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å Jira, —Ç–∞–∫ –∫–∞–∫:  
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø—Ä–æ—Ç–æ–∫–æ–ª—ã **NFSv3, NFSv4, NFSv4.1**, –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Jira.  
- –†–∞–±–æ—Ç–∞–µ—Ç –≤ **–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–º –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ (userspace)**, —á—Ç–æ –¥–µ–ª–∞–µ—Ç –µ–≥–æ –±–æ–ª–µ–µ –≥–∏–±–∫–∏–º –∏ –º–µ–Ω–µ–µ –∑–∞–≤–∏—Å–∏–º—ã–º –æ—Ç –≤–µ—Ä—Å–∏–∏ —è–¥—Ä–∞.  
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤ Debian/Proxmox –∏ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∫–∞–∫ —Å–µ—Ä–≤–µ—Ä –∏–ª–∏ –∫–ª–∏–µ–Ω—Ç.  

###  –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π Jira –∫ NFS
Jira –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ NFS, –Ω–æ —Å –æ–≥–æ–≤–æ—Ä–∫–∞–º–∏:  
- **NFSv3 –∏–ª–∏ NFSv4** (–ª—É—á—à–µ NFSv4 –∏–∑-–∑–∞ —É–ª—É—á—à–µ–Ω–Ω–æ–π –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —Ñ–∞–π–ª–æ–≤).  
- **–¢—Ä–µ–±—É–µ—Ç—Å—è `nolock` –∏–ª–∏ `lockd` –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã.**  
- –ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ **–æ—Ç–∫–ª—é—á–∏—Ç—å `atime`** –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏.

----------------------------------------------------------------------------------
<font color="green">**–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π PPA –¥–ª—è **NFS-Ganesha** (–æ—Ç –∫–æ–º–∞–Ω–¥—ã —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤) –≤ **Proxmox (Debian-based)**.**</font>


## **üîπ 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π**
```bash
apt update
apt install -y software-properties-common curl gnupg
```

## **üîπ 2. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ PPA-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è NFS-Ganesha**
–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –Ω–∞ **Launchpad** ([—Å—Å—ã–ª–∫–∞](https://launchpad.net/~nfs-ganesha)).

### **‚ë† –î–æ–±–∞–≤–ª—è–µ–º –∫–ª—é—á GPG**
```bash
curl -fsSL https://launchpad.net/~nfs-ganesha/+archive/ubuntu/nfs-ganesha-3/+gpg.key | gpg --dearmor -o /usr/share/keyrings/nfs-ganesha.gpg
```

### **‚ë° –î–æ–±–∞–≤–ª—è–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –≤ `sources.list.d`**
```bash
echo "deb [signed-by=/usr/share/keyrings/nfs-ganesha.gpg] https://ppa.launchpadcontent.net/nfs-ganesha/nfs-ganesha-3/ubuntu $(lsb_release -cs) main" | tee /etc/apt/sources.list.d/nfs-ganesha.list
```

> **‚ö† –í–Ω–∏–º–∞–Ω–∏–µ:**  
> –ï—Å–ª–∏ `lsb_release -cs` –≤—ã–¥–∞—ë—Ç –æ—à–∏–±–∫—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, Proxmox –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `bullseye`, –Ω–æ PPA –Ω–µ—Ç –¥–ª—è –Ω–µ–≥–æ), –º–æ–∂–Ω–æ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ –±–ª–∏–∂–∞–π—à—É—é –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—É—é –≤–µ—Ä—Å–∏—é Ubuntu (–Ω–∞–ø—Ä–∏–º–µ—Ä, `focal` –¥–ª—è Debian 11).

### **‚ë¢ –û–±–Ω–æ–≤–ª—è–µ–º –ø–∞–∫–µ—Ç—ã –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º NFS-Ganesha**
```bash
apt update
apt install -y nfs-ganesha nfs-ganesha-vfs
```


## **üîπ 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏**
```bash
systemctl status nfs-ganesha
```
–ï—Å–ª–∏ —Å–µ—Ä–≤–∏—Å –∞–∫—Ç–∏–≤–µ–Ω ‚Äî –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç.  


## **üîπ 5. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞**
```bash
systemctl restart nfs-ganesha
systemctl enable nfs-ganesha
```


## **üîπ 6. –ü—Ä–æ–≤–µ—Ä–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞**
```bash
showmount -e localhost
```
–í—ã–≤–æ–¥ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—Ä–∏–º–µ—Ä–Ω–æ —Ç–∞–∫–∏–º:
```bash
Export list for localhost:
/jira_data *
```

----------------------------------------------------------------------------------
## **üîß –ü–æ—à–∞–≥–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ NFS-Ganesha –¥–ª—è Jira**  
### **üìå –¶–µ–ª—å:**  
- –°–æ–∑–¥–∞—Ç—å –æ–±—â–∏–π NFS-—Ä–µ—Å—É—Ä—Å –¥–ª—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π Jira (`shared`, `data`, `plugins` –∏ –¥—Ä.), —á—Ç–æ–±—ã –æ–Ω–∏ –±—ã–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –Ω–∞ –≤—Å–µ—Ö –Ω–æ–¥–∞—Ö –∫–ª–∞—Å—Ç–µ—Ä–∞.  
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å `lockd` –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫.  
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (`noatime`, `hard`, `intr`).  



## **üîπ 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ (`jira-cluster`)**  
### **‚ë† –£—Å—Ç–∞–Ω–æ–≤–∫–∞ NFS-Ganesha**  
```bash
apt update
apt install -y nfs-ganesha nfs-ganesha-vfs
  # –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏ —á–µ—Ä–µ–∑ apt
    apt list --installed | grep nfs-ganesha
  # –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏ —á–µ—Ä–µ–∑ changelog:
    zcat /usr/share/doc/nfs-ganesha/changelog.Debian.gz | head -n 5
  # –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏
    ganesha.nfsd -v
    /usr/bin/ganesha.nfsd -v
```

### **‚ë° –°–æ–∑–¥–∞—ë–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è –æ–±—â–µ–≥–æ –¥–æ—Å—Ç—É–ø–∞**  
Jira –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –ø—É—Ç–µ–π:  
- `/opt/atlassian/jira/shared` (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–ª–∞—Å—Ç–µ—Ä)  
- `/var/atlassian/application-data/jira` (–æ–±—ã—á–Ω–æ –∑–¥–µ—Å—å –ª–µ–∂–∞—Ç –¥–∞–Ω–Ω—ã–µ)  

–ü—Ä–æ–≤–µ—Ä–∏–º, –∫–∞–∫–∏–µ –ø–∞–ø–∫–∏ Jira —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç:  
```bash
ls -alhF /opt/atlassian/jira/
mkdir -p /opt/atlassian/jira/shared
chown jira:jira -R /opt/atlassian/jira/shared
chmod 755 -R /opt/atlassian/jira/shared
```
–ï—Å–ª–∏ `/var/atlassian/application-data/jira` –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, —Å–æ–∑–¥–∞–¥–∏–º –µ—ë:  
```bash
mkdir -p /var/atlassian/application-data/jira
chmod -R 755 /var/atlassian/application-data/jira
chown -R jira:jira /var/atlassian/application-data/jira
```

### **‚ë¢ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è NFS-Ganesha (`/etc/ganesha/ganesha.conf`)**  

<details>
<summary>‚ùó ganesha.conf.bkp ‚ùó</summary>
	
```ini
# –ë–ª–æ–∫ –æ–±—â–∏—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ —ç–∫—Å–ø–æ—Ä—Ç–∞ (–ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∫–æ –≤—Å–µ–º —ç–∫—Å–ø–æ—Ä—Ç–∞–º, –µ—Å–ª–∏ –Ω–µ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã)
EXPORT_DEFAULTS {
    # –¢–∏–ø –¥–æ—Å—Ç—É–ø–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: Read-Write (—á—Ç–µ–Ω–∏–µ –∏ –∑–∞–ø–∏—Å—å)
    Access_Type = RW;
}

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —ç–∫—Å–ø–æ—Ä—Ç–∞ (—à–∞—Ä—ã)
# –û—Å–Ω–æ–≤–Ω–æ–π –±–ª–æ–∫ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
LOG {
    # –£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: DEBUG (–º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø–æ–¥—Ä–æ–±–Ω—ã–π)
    Default_Log_Level = DEBUG;
	
	# –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É –ª–æ–≥–æ–≤ —Å–µ—Ä–≤–µ—Ä–∞ NFS
    Log_File = /var/log/ganesha/ganesha.log;
}

# –ë–ª–æ–∫ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –≤—Å–µ—Ö —ç–∫—Å–ø–æ—Ä—Ç–æ–≤
EXPORT_DEFAULTS {
    # –¢–∏–ø –¥–æ—Å—Ç—É–ø–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: Read-Write (—á—Ç–µ–Ω–∏–µ –∏ –∑–∞–ø–∏—Å—å)
    Access_Type = RW;
}

# –ù–∞—á–∞–ª–æ –±–ª–æ–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —ç–∫—Å–ø–æ—Ä—Ç–∞ (–æ–±—â–µ–π NFS)
EXPORT {
    # –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ - —Ç–æ–ª—å–∫–æ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏–∑ –ø–æ–¥—Å–µ—Ç–∏ 192.168.87.0/24
    # –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞—è –∑–∞–ø–∏—Å—å: 192.168.87.*
    Clients = 192.168.87.0/24;  # –ª–∏–±–æ 192.168.87.*

    # –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —ç–∫—Å–ø–æ—Ä—Ç–∞ (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —ç–∫—Å–ø–æ—Ä—Ç–∞)
    Export_ID = 1;
    
    # –§–∏–∑–∏—á–µ—Å–∫–∏–π –ø—É—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –∫ —Ä–∞—Å—à–∞—Ä–∏–≤–∞–µ–º–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
    # (–í –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ - –¥–∞–Ω–Ω—ã–µ Jira)
    Path = /var/atlassian/application-data/jira;
    
    # –í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –ø—É—Ç—å, –∫–æ—Ç–æ—Ä—ã–π —É–≤–∏–¥—è—Ç –∫–ª–∏–µ–Ω—Ç—ã –ø—Ä–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏
    Pseudo = /jira_data;
    
    # –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –¥–ª—è —ç—Ç–æ–≥–æ —ç–∫—Å–ø–æ—Ä—Ç–∞: RW (—á—Ç–µ–Ω–∏–µ –∏ –∑–∞–ø–∏—Å—å)
    Access_Type = RW;
    
    # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∞–≤ –¥–ª—è root-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
    # No_Root_Squash - root –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∞ root –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
    Squash = No_Root_Squash;
    
    # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ NFS –≤–µ—Ä—Å–∏–∏ 4 (–ª—É—á—à–µ –¥–ª—è –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫)
    Protocols = 4;   # –î–æ–ø—É—Å–∫–∞–µ—Ç—Å—è Protocols = 3, 4;
    
    # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª TCP
    Transports = TCP;

	# –ë–ª–æ–∫ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã (FSAL - File System Abstraction Layer)
    FSAL {
		# –ò—Å–ø–æ–ª—å–∑—É–µ–º VFS (Virtual File System) - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –¥—Ä–∞–π–≤–µ—Ä –¥–ª—è –ª–æ–∫–∞–ª—å–Ω—ã—Ö –§–°
        Name = VFS;
    }

    # –ë–ª–æ–∫ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ –¥–ª—è NFSv4
    NFSv4 {
        # –í–∫–ª—é—á–∞–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É Network Lock Manager (–¥–ª—è —Ñ–∞–π–ª–æ–≤—ã—Ö –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫)
        Enable_NLM = true;
        
        # –ü–æ—Ä—Ç –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –¥–ª—è —Ä–∞–±–æ—Ç—ã –º–µ—Ö–∞–Ω–∏–∑–º–∞ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫
        NLM_Port = 32803;
    }
}

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ callback-–º–µ—Ö–∞–Ω–∏–∑–º–∞ NFS (–¥–ª—è –æ–±—Ä–∞—Ç–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤ –ø—Ä–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞—Ö)
NFS_CB {
    # –û—Ç–∫–ª—é—á–∞–µ–º –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é —á–µ—Ä–µ–∑ Kerberos (–∏—Å–ø–æ–ª—å–∑—É–µ–º –æ–±—ã—á–Ω—ã–π –¥–æ—Å—Ç—É–ø)
    Enable_Krb5 = false;
}
```
</details>


<details>
<summary>‚ùó ganesha.conf - main ‚ùó</summary>
	
```ini
LOG {
    Default_Log_Level = DEBUG;
    Log_File = /var/log/ganesha/ganesha.log;
}

EXPORT {
    Clients = 192.168.87.0/24;
    Export_ID = 1;
    Path = /var/atlassian/application-data/jira;
    Pseudo = /jira_data;
    Access_Type = RW;
    Squash = No_Root_Squash;
    Protocols = 3,4;
    Transports = TCP;

    FSAL {
        Name = VFS;
    }

    NFS_Protocols {
        NFSv3 = true;
        NFSv4 = true;
        NFSv41 = true;
        NFSv42 = false;
    }
}

NFS_CB {
    Enable_Krb5 = false;
}

KRB5 {
    Active_krb5 = false;
}
```
</details>


> **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:**  
> - –ï—Å–ª–∏ Jira –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `/opt/atlassian/jira/shared`, –¥–æ–±–∞–≤—å—Ç–µ –µ—â—ë –æ–¥–∏–Ω `EXPORT` –¥–ª—è –Ω–µ–≥–æ.  
> - `No_Root_Squash` ‚Äî —á—Ç–æ–±—ã `root` –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ –∏–º–µ–ª –¥–æ—Å—Ç—É–ø; –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è —Ä–∞–±–æ—Ç—ã Jira, —Ç–∞–∫ –∫–∞–∫ –ø—Ä–æ—Ü–µ—Å—Å—ã –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ —Ñ–∞–π–ª–∞–º
> - **NFSv4** - –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –±–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω—ã–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —Ñ–∞–π–ª–æ–≤ –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å v3
> - **NLM** - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è –∫–ª–∞—Å—Ç–µ—Ä–Ω—ã—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π Jira, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –∫–æ—Ä—Ä—É–ø—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö

### **‚ë£ –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞**  
```bash
systemctl restart nfs-ganesha
systemctl enable nfs-ganesha
tail -n 50 /var/log/ganesha/ganesha.log | grep -i error  # –ª–æ–≥–∏

# –≤–æ–∑–º–æ–∂–Ω–æ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è —É–±–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å
systemctl stop nfs-ganesha
pkill -9 ganesha.nfsd
systemctl start nfs-ganesha
```
–ü—Ä–æ–≤–µ—Ä–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞:  
```c
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ showmount -e
root@jira-cluster /etc/ganesha # showmount -e localhost
Export list for localhost:
/var/atlassian/application-data/jira (everyone)

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ rpcinfo
root@jira-cluster /etc/ganesha # rpcinfo -p localhost | grep -E "nfs|mountd"
    100003    3   udp   2049  nfs
    100003    3   tcp   2049  nfs
    100005    1   udp  45028  mountd
    100005    1   tcp  37113  mountd
    100005    3   udp  45028  mountd
    100005    3   tcp  37113  mountd
    100003    4   udp   2049  nfs
    100003    4   tcp   2049  nfs

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ dbus-send
  dbus-send --type=method_call --print-reply --system \
     --dest=org.ganesha.nfsd /org/ganesha/nfsd/ExportMgr org.ganesha.nfsd.exportmgr.ShowExports
```

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `Path` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –¥–æ—Å—Ç—É–ø–µ–Ω:
```bash
ls -ld /var/atlassian/application-data/jira
chown -R jira:jira /var/atlassian/application-data/jira
chmod -R 755 /var/atlassian/application-data/jira
```

–ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ. —Ñ–∞–π–ª–∞:
```bash
# –í Debian/Proxmox NFS-Ganesha –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥—Ä—É–≥–æ–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
ganesha.nfsd -L /tmp/ganesha-check.log -f /etc/ganesha/ganesha.conf -N NIV_EVENT -F
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ –æ—à–∏–±–∫–∏
cat /tmp/ganesha-check.log | grep -i error

# —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å
ganesha.nfsd -f /etc/ganesha/ganesha.conf --check-config
```
–†–µ–∂–∏–º –æ—Ç–ª–∞–∫–¥–∏:
```bash
ganesha.nfsd -f /etc/ganesha/ganesha.conf -L /tmp/ganesha.debug -N NIV_DEBUG -F
```



## **üîπ 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–ª–∏–µ–Ω—Ç–∞ (`jira-new`)**  
### ‚ë† –£—Å—Ç–∞–Ω–æ–≤–∫–∞ NFS-–∫–ª–∏–µ–Ω—Ç–∞  
```bash
apt update
apt install -y nfs-common
```
```c
root@jira-new ~ # systemctl status nfs-common.service 
‚óã nfs-common.service
     Loaded: masked (Reason: Unit nfs-common.service is masked.)
     Active: inactive (dead)
```

### –ü—Ä–æ–±–ª–µ–º–∞ –º–∞—Å–∫–∏—Ä–æ–≤–∫–∏.
–ú–æ–∂–µ—Ç —Ç–∞–∫ –ø–æ–ª—É—á–∏—Ç—å—Å—è, —á—Ç–æ —Å–µ—Ä–≤–∏—Å –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ masked. –ü—Ä–æ—Å—Ç–æ —Ç–∞–∫ –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ –≤ unmasked –º–æ–∂–µ—Ç –Ω–µ –ø—Ä–æ–ª—É—á–∏—Ç—å—Å—è, —Ç.–∫. –ø—Ä–æ–±–ª–µ–º–∞ –∑–∞–∫–ª—é—á–∞–µ—Ç—Å—è –∏–º–µ–Ω–Ω–æ –≤ —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–æ–π —Å—Å—ã–ª–∫–µ `/lib/systemd/system/nfs-common.service -> /dev/null`. –≠—Ç–æ –∫—Ä–∞–π–Ω–µ –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è —Å–∏—Ç—É–∞—Ü–∏—è, —Ç–∞–∫ –∫–∞–∫ —Ñ–∞–π–ª—ã —Å–µ—Ä–≤–∏—Å–æ–≤ –≤ `/lib/systemd/system/` –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ–±—ã—á–Ω—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏, –∞ –º–∞—Å–∫–∏—Ä–æ–≤–∫–∞ –æ–±—ã—á–Ω–æ –¥–µ–ª–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `/etc/systemd/system/`.

#### ‚óä –£–¥–∞–ª–∏—Ç—å –ø—Ä–æ–±–ª–µ–º–Ω—É—é —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫—É—é —Å—Å—ã–ª–∫—É
```bash
rm -fv /lib/systemd/system/nfs-common.service
```
#### ‚óä –°–æ–∑–¥–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π systemd —é–Ω–∏—Ç —Ä—É–∫–∞–º–∏ /lib/systemd/system/nfs-common.service
```ini
#/lib/systemd/system/nfs-common.service

Description=NFS Common daemons
After=network.target rpc_pipefs.target
Wants=rpc_pipefs.target

[Service]
Type=oneshot
RemainAfterExit=yes
ExecStart=/usr/sbin/rpc.statd --no-notify
ExecStop=/usr/sbin/rpc.statd --no-notify --clean

[Install]
WantedBy=multi-user.target
```

#### ‚óä –£—Å—Ç–∞–Ω–æ–≤–∏—Ç –ø—Ä–∞–≤–∞ –∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–ª—É–∂–±—É
```bash
chmod 644 /lib/systemd/system/nfs-common.service
systemctl daemon-reload
```

#### ‚óä –†–∞–∑–º–∞—Å–∫–∏—Ä–æ–≤–∞—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–ª—É–∂–±—É
```bash
systemctl unmask nfs-common.service
systemctl enable --now nfs-common.service
systemctl status nfs-common.service
systemctl is-enabled nfs-common.service
```



### **‚ë° –°–æ–∑–¥–∞—ë–º —Ç–æ—á–∫–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è**  
```bash
mkdir -p /var/atlassian/application-data/jira
chown -R jira:jira /var/atlassian/application-data/jira
```

### **‚ë¢ –ú–æ–Ω—Ç–∏—Ä—É–µ–º NFS**  
–í—Ä–µ–º–µ–Ω–Ω–æ–µ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (–¥–ª—è —Ç–µ—Å—Ç–∞):  
```bash
mount -t nfs4 192.168.87.140:/jira_data /var/atlassian/application-data/jira -o rw,noatime,hard,intr
```
–ü–æ—Å—Ç–æ—è–Ω–Ω–æ–µ (–¥–æ–±–∞–≤–ª—è–µ–º –≤ `/etc/fstab`):  
```bash
echo "192.168.87.140:/jira_data  /var/atlassian/application-data/jira  nfs4  rw,noatime,hard,intr  0  0" >> /etc/fstab
mount -a
```

### **‚ë£ –ü—Ä–æ–≤–µ—Ä–∫–∞**  
```bash
df -h | grep jira  # –î–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å —Å–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π NFS
touch /var/atlassian/application-data/jira/test && ls -la /var/atlassian/application-data/jira/  # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø–∏—Å–∏
```



## **üîπ 3. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏**  
### **‚ë† –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è NFS**  
–î–æ–±–∞–≤—å—Ç–µ –≤ `/etc/fstab` –∫–ª–∏–µ–Ω—Ç–∞:  
```bash
192.168.87.140:/jira_data  /var/atlassian/application-data/jira  nfs4  rw,noatime,hard,intr,rsize=65536,wsize=65536  0  0
```
- `rsize=65536,wsize=65536` ‚Äî —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Ä–∞–∑–º–µ—Ä –±–ª–æ–∫–æ–≤ —á—Ç–µ–Ω–∏—è/–∑–∞–ø–∏—Å–∏ (—É—Å–∫–æ—Ä—è–µ—Ç —Ä–∞–±–æ—Ç—É).  
- `hard,intr` ‚Äî –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —Å–æ—Ö—Ä–∞–Ω–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–µ—Ä—ã–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã.  

### **‚ë° –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∞–≤**  
–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å `jira` –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø:  
```bash
chown -R jira:jira /var/atlassian/application-data/jira
```

### **‚ë¢ –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫**  
–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ (`jira-cluster`):  
```bash
rpcinfo -p | grep lockd
```
–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:  
```bash
100021    1   udp  32803  nlockmgr
100021    3   tcp  32803  nlockmgr
```



## **üîπ 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Jira**  
### **‚ë† –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Jira –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `/var/atlassian/application-data/jira`**  
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ `jira-config.properties` (–æ–±—ã—á–Ω–æ –≤ `/opt/atlassian/jira/conf/`):  
```bash
cat /opt/atlassian/jira/conf/jira-config.properties | grep "jira.home"
```
–ï—Å–ª–∏ `jira.home` –Ω–µ —É–∫–∞–∑–∞–Ω, Jira –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `/var/atlassian/application-data/jira`.  

### **‚ë° –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ Jira**  
```bash
systemctl restart jira
```



## **üîπ 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã**  
### **–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ (`jira-cluster`):**  
```bash
tail -f /var/log/ganesha.log  # –õ–æ–≥–∏ NFS-—Å–µ—Ä–≤–µ—Ä–∞
```

### **–ù–∞ –∫–ª–∏–µ–Ω—Ç–µ (`jira-new`):**  
```bash
dmesg | grep nfs  # –û—à–∏–±–∫–∏ NFS
lsof /var/atlassian/application-data/jira  # –ö–∞–∫–∏–µ —Ñ–∞–π–ª—ã –æ—Ç–∫—Ä—ã—Ç—ã
```

–ï—Å–ª–∏ Jira –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥—Ä—É–≥–∏–µ –ø—É—Ç–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `/opt/atlassian/jira/shared`), –¥–æ–±–∞–≤—å—Ç–µ –∏—Ö –≤ —ç–∫—Å–ø–æ—Ä—Ç Ganesha –∏ —Å–º–æ–Ω—Ç–∏—Ä—É–π—Ç–µ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ.  


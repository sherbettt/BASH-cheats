NFS-Ganesha –º–æ–∂–µ—Ç –±—ã—Ç—å —Ö–æ—Ä–æ—à–µ–π –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–æ–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–º—É `nfs-kernel-server` –¥–ª—è –Ω–∞—à–µ–≥–æ –∫–ª–∞—Å—Ç–µ—Ä–∞ Jira, –æ—Å–æ–±–µ–Ω–Ω–æ –µ—Å–ª–∏ —É –≤–∞—Å –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ —è–¥—Ä–æ (6.8.12-9-pve).  

###  –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å NFS-Ganesha —Å Jira**  
–î–∞, **NFS-Ganesha** –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å Jira, —Ç–∞–∫ –∫–∞–∫:  
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø—Ä–æ—Ç–æ–∫–æ–ª—ã **NFSv3, NFSv4, NFSv4.1**, –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Jira.  
- –†–∞–±–æ—Ç–∞–µ—Ç –≤ **–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–º –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ (userspace)**, —á—Ç–æ –¥–µ–ª–∞–µ—Ç –µ–≥–æ –±–æ–ª–µ–µ –≥–∏–±–∫–∏–º –∏ –º–µ–Ω–µ–µ –∑–∞–≤–∏—Å–∏–º—ã–º –æ—Ç –≤–µ—Ä—Å–∏–∏ —è–¥—Ä–∞.  
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤ Debian/Proxmox –∏ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∫–∞–∫ —Å–µ—Ä–≤–µ—Ä –∏–ª–∏ –∫–ª–∏–µ–Ω—Ç.  

###  –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π Jira –∫ NFS**  
Jira –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ NFS, –Ω–æ —Å –æ–≥–æ–≤–æ—Ä–∫–∞–º–∏:  
- **NFSv3 –∏–ª–∏ NFSv4** (–ª—É—á—à–µ NFSv4 –∏–∑-–∑–∞ —É–ª—É—á—à–µ–Ω–Ω–æ–π –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —Ñ–∞–π–ª–æ–≤).  
- **–¢—Ä–µ–±—É–µ—Ç—Å—è `nolock` –∏–ª–∏ `lockd` –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã.**  
- –ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ **–æ—Ç–∫–ª—é—á–∏—Ç—å `atime`** –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏.  
------------------------------------------------------------------

## **üîß –ü–æ—à–∞–≥–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ NFS-Ganesha –¥–ª—è Jira**  
### **üìå –¶–µ–ª—å:**  
- –°–æ–∑–¥–∞—Ç—å –æ–±—â–∏–π NFS-—Ä–µ—Å—É—Ä—Å –¥–ª—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π Jira (`shared`, `data`, `plugins` –∏ –¥—Ä.), —á—Ç–æ–±—ã –æ–Ω–∏ –±—ã–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –Ω–∞ –≤—Å–µ—Ö –Ω–æ–¥–∞—Ö –∫–ª–∞—Å—Ç–µ—Ä–∞.  
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å `lockd` –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫.  
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (`noatime`, `hard`, `intr`).  



## **üîπ 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ (`jira-cluster`)**  
### **‚ë† –£—Å—Ç–∞–Ω–æ–≤–∫–∞ NFS-Ganesha**  
```bash
apt update
apt install -y nfs-ganesha nfs-ganesha-vfs
```

### **‚ë° –°–æ–∑–¥–∞—ë–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è –æ–±—â–µ–≥–æ –¥–æ—Å—Ç—É–ø–∞**  
Jira –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –ø—É—Ç–µ–π:  
- `/opt/atlassian/jira/shared` (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–ª–∞—Å—Ç–µ—Ä)  
- `/var/atlassian/application-data/jira` (–æ–±—ã—á–Ω–æ –∑–¥–µ—Å—å –ª–µ–∂–∞—Ç –¥–∞–Ω–Ω—ã–µ)  

–ü—Ä–æ–≤–µ—Ä–∏–º, –∫–∞–∫–∏–µ –ø–∞–ø–∫–∏ Jira —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç:  
```bash
ls -la /opt/atlassian/jira/
```
–ï—Å–ª–∏ `/var/atlassian/application-data/jira` –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, —Å–æ–∑–¥–∞–¥–∏–º –µ—ë:  
```bash
mkdir -p /var/atlassian/application-data/jira
chown -R jira:jira /var/atlassian/application-data/jira
```

### **‚ë¢ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è NFS-Ganesha (`/etc/ganesha/ganesha.conf`)**  
```ini
EXPORT
{
    Export_ID = 1;
    Path = /var/atlassian/application-data/jira;  # –û—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ Jira
    Pseudo = /jira_data;
    Access_Type = RW;
    Squash = No_Root_Squash;
    Protocols = 4;  # –ò—Å–ø–æ–ª—å–∑—É–µ–º NFSv4 (–ª—É—á—à–µ –¥–ª—è –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫)
    Transports = TCP;
    FSAL {
        Name = VFS;
    }
    NFS_Core_Param {
        Enable_NLM = true;  # –í–∫–ª—é—á–∞–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É lockd
        NLM_Port = 32803;
    }
}
```
> **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:**  
> - –ï—Å–ª–∏ Jira –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `/opt/atlassian/jira/shared`, –¥–æ–±–∞–≤—å—Ç–µ –µ—â—ë –æ–¥–∏–Ω `EXPORT` –¥–ª—è –Ω–µ–≥–æ.  
> - `No_Root_Squash` ‚Äî —á—Ç–æ–±—ã `root` –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ –∏–º–µ–ª –¥–æ—Å—Ç—É–ø.  

### **‚ë£ –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞**  
```bash
systemctl restart nfs-ganesha
systemctl enable nfs-ganesha
```
–ü—Ä–æ–≤–µ—Ä–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞:  
```bash
showmount -e localhost
```
–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:  
```bash
Export list for localhost:
/jira_data *
```



## **üîπ 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–ª–∏–µ–Ω—Ç–∞ (`jira-new`)**  
### **‚ë† –£—Å—Ç–∞–Ω–æ–≤–∫–∞ NFS-–∫–ª–∏–µ–Ω—Ç–∞**  
```bash
apt update
apt install -y nfs-common
```

### **‚ë° –°–æ–∑–¥–∞—ë–º —Ç–æ—á–∫–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è**  
```bash
mkdir -p /var/atlassian/application-data/jira
chown -R jira:jira /var/atlassian/application-data/jira
```

### **‚ë¢ –ú–æ–Ω—Ç–∏—Ä—É–µ–º NFS**  
–í—Ä–µ–º–µ–Ω–Ω–æ–µ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (–¥–ª—è —Ç–µ—Å—Ç–∞):  
```bash
mount -t nfs4 192.168.87.140:/jira_data /var/atlassian/application-data/jira -o rw,noatime,hard,intr
```
–ü–æ—Å—Ç–æ—è–Ω–Ω–æ–µ (–¥–æ–±–∞–≤–ª—è–µ–º –≤ `/etc/fstab`):  
```bash
echo "192.168.87.140:/jira_data  /var/atlassian/application-data/jira  nfs4  rw,noatime,hard,intr  0  0" >> /etc/fstab
mount -a
```

### **‚ë£ –ü—Ä–æ–≤–µ—Ä–∫–∞**  
```bash
df -h | grep jira  # –î–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å —Å–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π NFS
touch /var/atlassian/application-data/jira/test && ls -la /var/atlassian/application-data/jira/  # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø–∏—Å–∏
```



## **üîπ 3. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏**  
### **‚ë† –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è NFS**  
–î–æ–±–∞–≤—å—Ç–µ –≤ `/etc/fstab` –∫–ª–∏–µ–Ω—Ç–∞:  
```bash
192.168.87.140:/jira_data  /var/atlassian/application-data/jira  nfs4  rw,noatime,hard,intr,rsize=65536,wsize=65536  0  0
```
- `rsize=65536,wsize=65536` ‚Äî —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Ä–∞–∑–º–µ—Ä –±–ª–æ–∫–æ–≤ —á—Ç–µ–Ω–∏—è/–∑–∞–ø–∏—Å–∏ (—É—Å–∫–æ—Ä—è–µ—Ç —Ä–∞–±–æ—Ç—É).  
- `hard,intr` ‚Äî –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —Å–æ—Ö—Ä–∞–Ω–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–µ—Ä—ã–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã.  

### **‚ë° –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∞–≤**  
–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å `jira` –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø:  
```bash
chown -R jira:jira /var/atlassian/application-data/jira
```

### **‚ë¢ –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫**  
–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ (`jira-cluster`):  
```bash
rpcinfo -p | grep lockd
```
–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:  
```bash
100021    1   udp  32803  nlockmgr
100021    3   tcp  32803  nlockmgr
```



## **üîπ 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Jira**  
### **‚ë† –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Jira –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `/var/atlassian/application-data/jira`**  
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ `jira-config.properties` (–æ–±—ã—á–Ω–æ –≤ `/opt/atlassian/jira/conf/`):  
```bash
cat /opt/atlassian/jira/conf/jira-config.properties | grep "jira.home"
```
–ï—Å–ª–∏ `jira.home` –Ω–µ —É–∫–∞–∑–∞–Ω, Jira –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `/var/atlassian/application-data/jira`.  

### **‚ë° –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ Jira**  
```bash
systemctl restart jira
```



## **üîπ 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã**  
### **–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ (`jira-cluster`):**  
```bash
tail -f /var/log/ganesha.log  # –õ–æ–≥–∏ NFS-—Å–µ—Ä–≤–µ—Ä–∞
```

### **–ù–∞ –∫–ª–∏–µ–Ω—Ç–µ (`jira-new`):**  
```bash
dmesg | grep nfs  # –û—à–∏–±–∫–∏ NFS
lsof /var/atlassian/application-data/jira  # –ö–∞–∫–∏–µ —Ñ–∞–π–ª—ã –æ—Ç–∫—Ä—ã—Ç—ã
```

–ï—Å–ª–∏ Jira –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥—Ä—É–≥–∏–µ –ø—É—Ç–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `/opt/atlassian/jira/shared`), –¥–æ–±–∞–≤—å—Ç–µ –∏—Ö –≤ —ç–∫—Å–ø–æ—Ä—Ç Ganesha –∏ —Å–º–æ–Ω—Ç–∏—Ä—É–π—Ç–µ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ.  


**MASTER GATEWAY** : **[102 (dmzgateway)](https://192.168.87.6:8006/#v1:0:=lxc%2F102:4::::::11:2)**

Чтобы удалить все текущие маршруты и заново настроить маршрутизацию на вашем ноутбуке (Ubuntu/Linux), выполните следующие шаги:

---

### **1. Удаление всех текущих маршрутов**
```bash
sudo ip route flush all  # Очистка всей таблицы маршрутизации
```

Проверьте, что таблица пуста:
```bash
ip route show
```
(Должна быть пустая таблица или только `link-local` маршруты)

---

### **2. Восстановление маршрута по умолчанию (основной шлюз)**
```bash
sudo ip route add default via 192.168.87.1 dev wlp1s0
```
(Если `192.168.87.1` — ваш основной шлюз в сети `192.168.87.0/24`)

---

### **3. Добавление маршрута в сеть 192.168.45.0/24 (pgnet)**
```bash
sudo ip route add 192.168.45.0/24 via 192.168.87.2 dev wlp1s0
```
(Здесь `192.168.87.2` — это `dmzgateway`, который знает путь до `192.168.45.0/24`)

---

### **4. Добавление маршрута в сеть 192.168.46.0/24 (dmznet)**
```bash
sudo ip route add 192.168.46.0/24 via 192.168.87.2 dev wlp1s0
```
(Аналогично, через `dmzgateway`)

---

### **5. Проверка маршрутов**
```bash
ip route show
```
Вывод должен выглядеть примерно так:
```
default via 192.168.87.1 dev wlp1s0  
192.168.45.0/24 via 192.168.87.2 dev wlp1s0  
192.168.46.0/24 via 192.168.87.2 dev wlp1s0  
192.168.87.0/24 dev wlp1s0 proto kernel scope link src 192.168.87.74  
```

---

### **6. Проверка доступности сетей**
```bash
ping 192.168.45.1   # Проверка связи с pgnet (через dmzgateway)
ping 192.168.46.1   # Проверка связи с dmznet (через dmzgateway)
ping 8.8.8.8        # Проверка интернета (через 192.168.87.1)
```

---

### **7. (Опционально) Сделать маршруты постоянными**
Чтобы маршруты не сбрасывались после перезагрузки, добавьте их в конфигурацию сети:
- **Для `netplan` (Ubuntu 18.04+)**  
  Отредактируйте `/etc/netplan/01-network-manager-all.yaml`:
  ```yaml
  network:
    version: 2
    renderer: NetworkManager
    ethernets:
      wlp1s0:
        dhcp4: yes
        routes:
          - to: 192.168.45.0/24
            via: 192.168.87.2
          - to: 192.168.46.0/24
            via: 192.168.87.2
  ```
  Примените изменения:
  ```bash
  sudo netplan apply
  ```

- **Для `networkd` (systemd-networkd)**  
  Создайте файл `/etc/systemd/network/10-static-routes.network`:
  ```
  [Route]
  Destination=192.168.45.0/24
  Gateway=192.168.87.2

  [Route]
  Destination=192.168.46.0/24
  Gateway=192.168.87.2
  ```
  Перезапустите сеть:
  ```bash
  sudo systemctl restart systemd-networkd
  sudo systemctl restart network.service
  ```

---

### **Итоговая схема маршрутизации**
- **Основной шлюз (интернет)**: `192.168.87.1`  
- **Маршрут в `pgnet` (192.168.45.0/24)**: через `192.168.87.2` (`dmzgateway`)  
- **Маршрут в `dmznet` (192.168.46.0/24)**: через `192.168.87.2` (`dmzgateway`)  

Если после этого `ping 192.168.45.1` не работает, проверьте:
1. Доступность `192.168.87.2` (`ping 192.168.87.2`).
2. Настройки маршрутизации на самом `dmzgateway` (`ip route show` на нём).

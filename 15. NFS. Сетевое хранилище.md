### § Доступ к сетевому хранилищу
([Доступ к сетевому хранилищу](https://rh.schelcol.ru/curse%202/ch09.html))

NFS (сетевая файловая система) — это стандартный протокол Интернета, это открытый стандарт, который активно разрабатывается и поддерживает систему разрешений Linux и функции файловой системы. 
<br/> NFS-серверы экспортируют общие каталоги. Клиенты NFS монтируют экспортированный общий каталог в локальную точку монтирования (каталог), которая должна существовать. Общие каталоги NFS можно смонтировать несколькими способами:
- вручную с помощью команды mount;
- автоматически во время загрузки системы с помощью записей /etc/fstab;
- по запросу, используя службу autofs или утилиту systemd.automount.

```
файл конфигурации /etc/auto.master

https://rh.schelcol.ru/curse%202/ch09s04.html
/etc/automaster
	/info /etc/auto.server
	/-		/etc/auto.direct
/etc/auto.server
	data	-ro serverb.lab.example.com:/shares/inderect/central
/etc/auto.direct
	/info5/storage	-ro serverb.lab.example.com:/shares/direct/external
```
Компания, занимающаяся ИТ-поддержкой, использует центральный сервер **serverb** для размещения некоторых общих каталогов в **/remote/shares** для своих групп и пользователей. Пользователи должны иметь возможность входить в систему, а их общие каталоги должны быть подключены по требованию и готовы к использованию в каталоге **/shares** на **servera**. 
1. Установить пакет NFS
	<br/>  `yum install autofs`
2. Протестируйте сервер NFS, прежде чем приступать к настройке автомонтера
   	<br/>  `mount -t nfs serverb.lab.example.com:/shares /mnt`
	```bash
	[root@servera ~]# ll /mnt/
	total 0
	dr-xr-xr-x. 17 root root       224 Sep 18  2020 ../
	drwxrwxr-x.  5 root root        59 Apr 26 20:06 ./
	drwxrws---.  2 root managers    25 Apr 26 20:06 management/
	drwxrws---.  2 root operators   25 Apr 26 20:06 operation/
	drwxrws---.  2 root production  25 Apr 26 20:06 production/
	```
3. Создать главный файл **/etc/auto.master.d/shares.autofs** и  прописать внутри следующее:
	<br/>  `vim /etc/auto.master.d/shares.autofs`
	<br/>  `/remote /etc/auto.shares`
4. Создать косвенный файл **/etc/auto.shares** , где указываем ссылку на другой сервер: 
	<br/> `vim /etc/auto.shares`
	<br/> `* -rw,sync,fstype=nfs4 serverb.lab.example.com:/shares/&`
5. Вуключить службу autofs
	<br/> `systemctl enable --now autofs`
6. Перезагрузить
	<br/> `systemctl reboot`
7. Зайти под другими пользователями и проверить общие директории
	```bash
	[root@serverb ~]# ls -alF /shares/
	total 0
	drwxrwxr-x.  5 root root        59 Apr 26 20:06 ./
	dr-xr-xr-x. 18 root root       238 Apr 26 20:06 ../
	drwxrws---.  2 root managers    25 Apr 26 20:06 management/
	drwxrws---.  2 root operators   25 Apr 26 20:06 operation/
	drwxrws---.  2 root production  25 Apr 26 20:06 production/
 	```
 8. Проверить параметры подключения для общего ресурса, автоматически подключаемого к NFS.
	```c
	[student@servera ~]$ mount | grep nfs
	rpc_pipefs on /var/lib/nfs/rpc_pipefs type rpc_pipefs (rw,relatime)
	serverb.lab.example.com:/shares/management on /remote/management type nfs4
	(rw,relatime,vers=4.2,rsize=262144,wsize=262144,namlen=255,
	sync,proto=tcp,timeo=600,retrans=2,sec=sys,clientaddr=172.25.250.10,
	local_lock=none,addr=172.25.250.11)
	serverb.lab.example.com:/shares/operation on /remote/operation type nfs4
	(rw,relatime,vers=4.2,rsize=262144,wsize=262144,namlen=255,
	sync,proto=tcp,timeo=600,retrans=2,sec=sys,clientaddr=172.25.250.10,
	local_lock=none,addr=172.25.250.11)
	serverb.lab.example.com:/shares/production on /remote/production type nfs4
	(rw,relatime,vers=4.2,rsize=262144,wsize=262144,namlen=255,
	sync,proto=tcp,timeo=600,retrans=2,sec=sys,clientaddr=172.25.250.10,
	local_lock=none,addr=172.25.250.11)
 	```








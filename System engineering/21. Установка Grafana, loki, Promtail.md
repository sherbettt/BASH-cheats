Руководствовался статьей [Установка и использование Grafana Loki на Linux](https://www.dmosk.ru/instruktions.php?object=grafana-loki)
<br/>


# Установка

## Установка необходимых компонент
```bash
apt install -y iptables-persistent
apt install -y wget curl git
```

## Правила iptables для портов
Забегая вперёд, есть смысл заранее разрешить правила для портов.
```bash
iptables -I INPUT 1 -p tcp --dport 3100 -j ACCEPT
iptables -I INPUT 1 -p tcp --dport 9080 -j ACCEPT
netfilter-persistent save
iptables -L -nv
```


## Установка Go
Смотрим [доступные версии GO](https://go.dev/dl/) и качаем.
```bash
cd /usr/local/
wget https://go.dev/dl/go1.25.1.linux-amd64.tar.gz
tar -xvf go1.25.1.linux-amd64.tar.gz
```
Редактируем **`/etc/profile`**, добавляя вниз:
```ini
export PATH=$PATH:/usr/local/go/bin
```
И один раз выполняем данную команду: ***`export PATH=$PATH:/usr/local/go/bin`***
```sh
root@app /usr/local/go
14:04:20 # go version
go version go1.25.1 linux/amd64
```


## Установка Grafana
Увы, но для РФ бинарники отсюда https://dl.grafana.com/grafana/release/12.1.1/grafana_12.1.1_16903967602_linux_amd64.deb недоступны.
<br/> Будем использовать ссылку https://dl.grafana.com/oss/release/grafana_12.1.1_amd64.deb

После установки отредактируем кофиг. файлик **`/etc/grafana/grafana.ini`**:
```ini
### общие настройки пользователей

[users]
# Разрешить самостоятельную регистрацию
allow_sign_up = false

# Разрешить создание организаций
allow_org_create = false

# Автоматически назначать организацию для новых пользователей
auto_assign_org = true

# ID организации по умолчанию
auto_assign_org_id = 1

# Роль по умолчанию для новых пользователей (Viewer, Editor, Admin)
auto_assign_org_role = Viewer
```
```ini
### секции аутентификации - от них зависит, как создаются пользователи

[auth.anonymous]
# Анонимный доступ
enabled = false

[auth.basic]
# Базовая аутентификация
enabled = true
```
```ini
### Внешние провайдеры (LDAP, OAuth, SAML и др.)

[auth.ldap]
enabled = true
config_file = /etc/grafana/ldap.toml

[auth.github]
enabled = false
```


После чего можно в CLI создавать пользователей:
```bash
curl -X POST -H "Content-Type: application/json" \
-d '{"name":"User","email":"user@example.com","login":"user","password":"password"}' \
http://admin:admin@localhost:3000/api/admin/users
```
```bash
curl -X POST http://192.168.87.209:3000/api/admin/users \
  -H "Content-Type: application/json" \
  -d '{
    "name":"Kirill Korablin",
    "email":"k@runtel.ru",
    "login":"kkorablin",
    "password":"securepassword"
  }' \
  -u admin:admin_password
```


## Установка Loki


## Установка Promtail



По итогу мы должны получить следующие версии:
```c
root@loki-grafana /etc/promtail
10:08:58 # promtail --version
promtail, version 2.9.5 (branch: release-2.9.x, revision: eee3598)
  build user:       root@3280478bab6f
  build date:       2024-02-28T23:23:33Z
  go version:       go1.21.3
  platform:         linux/amd64
  tags:             promtail_journal_enabled
root@loki-grafana /etc/promtail
10:15:00 # loki --version
loki, version 3.4.5 (branch: release-3.4.x, revision: b2c87ba6)
  build user:       root@e9a82bfdaaad
  build date:       2025-07-11T09:53:38Z
  go version:       go1.23.6
  platform:         linux/amd64
  tags:             netgo
```


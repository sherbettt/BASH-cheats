## üî∑ 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –º–∞—à–∏–Ω—ã –≤ ProxMox.

 –ó–∞—Ö–æ–¥–∏–º –≤ –∫–ª–∞—Å—Ç–µ—Ä –ø–æ –æ–¥–Ω–æ–π –∏–∑ —Å—Å—ã–ª–æ–∫:
- https://192.168.87.17:8006/#v1:0:18:4::::::: - prox4;
- https://192.168.87.20:8006/#v1:0:18:4::::::: - pmx5;
- https://192.168.87.6:8006/#v1:0:18:4::::::: - pmx6.


–ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:
-  –º–∞—à–∏–Ω–∞ ***Container 102 (dmzgateway) on node 'pmx6'***, —É –∫–æ—Ç–æ—Ä–æ–π —Ç—Ä–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ —Å —Ç–∏–ø–æ–º Bridge:
    - **vmbr0**: `192.168.87.2/24` (—à–ª—é–∑ `192.168.87.1`) - –≤–Ω–µ—à–∫–∞ –∏-–Ω–µ—Ç;
    - **dmznet**: `192.168.46.1/24` - —è–≤–ª—è–µ—Ç—Å—è —à–ª—é–∑–æ–º –¥–ª—è –¥—Ä—É–≥–∏—Ö –º–∞—à–∏–Ω –≤ —ç—Ç–æ–π —Å–µ—Ç–∏;
    - **pgnet**: `192.168.45.1/24` - —è–≤–ª—è–µ—Ç—Å—è —à–ª—é–∑–æ–º –¥–ª—è –¥—Ä—É–≥–∏—Ö –º–∞—à–∏–Ω –≤ —ç—Ç–æ–π —Å–µ—Ç–∏;
- –º–∞—à–∏–Ω–∞ ***Container 172 (keycloak) on node 'prox4'***, –≤ —Å–µ—Ç–∏ `vmbr0` –∫–æ—Ç–æ—Ä—É—é —Ç—Ä–µ–±—É–µ—Ç—Å—è —Å–∫–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å;
- –º–∞—à–∏–Ω–∞ ***Container 272 (keycloack) on node 'prox4'***, –≤ —Å–µ—Ç–∏ `dmznet`, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–∞ –ø–æ—Å–ª–µ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è;
- –ø—Ä–æ—Å–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏ –ø–æ–º–æ—â–∏ —É—Ç–∏–ª–∏—Ç—ã *nmap* —Å–µ—Ç—å 192.168.45.0/24 –∏ –≤—ã—è—Å–Ω–∏—Ç—å —Å–≤–æ–±–æ–¥–Ω—ã–µ IP –∞–¥—Ä–µ—Å–∞;
- –¥–æ–±–∞–≤–∏—Ç—å –≤ ***Container 272*** –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å **eth1**, —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π `192.168.45.50/24` (—à–ª—é–∑: `192.168.45.1`); ‚úÖ

<details>
<summary>‚ùó –ø—Å–µ–≤–¥–æ–≥—Ä–∞—Ñ–∏–∫–∞ ‚ùó</summary>

```text
+---------------------------------------------------------------+
|                         –ö–ª–∞—Å—Ç–µ—Ä Proxmox                        |
|                                                               |
|  +---------------------+     +---------------------+          |
|  |       –£–∑–µ–ª pmx6     |     |      –£–∑–µ–ª prox4     |          |
|  | 192.168.87.6:8006   |     | 192.168.87.17:8006  |          |
|  |                     |     |                     |          |
|  |  +---------------+  |     |  +---------------+  |          |
|  |  | Container 102 |  |     |  | Container 172 |  |          |
|  |  | (dmzgateway)  |  |     |  | (keycloak)    |  |          |
|  |  |               |  |     |  | vmbr0         |  |          |
|  |  | vmbr0:        |  |     |  +---------------+  |          |
|  |  | 192.168.87.2  |  |     |                     |          |
|  |  | dmznet:       |  |     |  +---------------+  |          |
|  |  | 192.168.46.1  |  |     |  | Container 272 |  |          |
|  |  | pgnet:        |  |     |  | (keycloak)    |  |          |
|  |  | 192.168.45.1  |  |     |  | dmznet +      |  |          |
|  |  +---------------+  |     |  | pgnet(eth1):  |  |          |
|  |                     |     |  | 192.168.45.50 |  |          |
|  +---------------------+     +---------------------+          |
|                                                               |
+---------------------------------------------------------------+

–°–µ—Ç–∏:
- vmbr0: 192.168.87.0/24 (–≤–Ω–µ—à–Ω—è—è)
- dmznet: 192.168.46.0/24
- pgnet: 192.168.45.0/24

–°–≤—è–∑–∏:
1. –í—Å–µ —É–∑–ª—ã –∫–ª–∞—Å—Ç–µ—Ä–∞ —Å–≤—è–∑–∞–Ω—ã —á–µ—Ä–µ–∑ vmbr0
2. Container 102 (dmzgateway) —è–≤–ª—è–µ—Ç—Å—è —à–ª—é–∑–æ–º –¥–ª—è dmznet –∏ pgnet
3. Container 272 (keycloak) –∏–º–µ–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã:
   - –æ—Å–Ω–æ–≤–Ω–æ–π etho –≤ dmznet —Å IP 192.168.46.16
   - –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–π eth1 –≤ pgnet —Å IP 192.168.45.50
```
</details>

<br/>


## üî∑ 2. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ —Å–æ–∑–¥–∞–Ω–∏—é –¥–∞–º–ø–∞ –ë–î PostgreSQL.

### 1.–î–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º—ã —Å –ª–æ–∫–∞–ª—è–º–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
```bash
vim /etc/locale.gen;
  # —Ä–∞—Å–∫–æ–º–µ–Ω—Ç–∏—Ç—å —Å—Ç—Ä–æ–∫—É ru_RU.UTF-8 UTF-8
locale-gen;
locale -a;
```
–î–ª—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ª–æ–∫–∞–ª–∏ (–¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π):
```bash
update-locale LANG=ru_RU.UTF-8
```
–î–ª—è –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ª–æ–∫–∞–ª–∏:
```bash
export LANG=ru_RU.UTF-8
```
–î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è - –¥–æ–±–∞–≤–∏—Ç—å –≤ .bashrc:
```conf
LANG=ru_RU.UTF-8
LC_ALL=ru_RU.UTF-8
```

### 2.–î–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PostgreSQL —Ç—Ä–µ–±—É–µ—Ç—Å—è.
—Å–º.: [–®–ø–∞—Ä–≥–∞–ª–∫–∞ –ø–æ –æ—Å–Ω–æ–≤–Ω—ã–º –∫–æ–º–∞–Ω–¥–∞–º PostgreSQL](https://www.oslogic.ru/knowledge/598/shpargalka-po-osnovnym-komandam-postgresql/)

  - –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –ø–æ–¥ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º:
     ```bash
     cd /tmp
       sudo -u postgres psql
     ```

  - –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è —á–µ—Ä–µ–∑ —Å–æ–∫–µ—Ç:
     ```bash
     root@app2 ~ > find / -name ".s.PGSQL.5433" 2>/dev/null
		/var/lib/postgresql/patroni/.s.PGSQL.5433

	psql -h /var/lib/postgresql/patroni -p 5433 -U postgres
		psql (15.14 (Debian 15.14-0+deb12u1))
     ```

  - Ad-Hoc –∫–æ–º–∞–Ω–¥—ã:
     ```bash 
     sudo -u postgres psql -c "\l"   # —Å–º. —Å–ø–∏—Å–æ–∫ –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö
     psql -U postgres -c "\l" -h 192.168.45.202
     sudo -u postgres psql -c "\du"   # —Å–º. —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
     sudo -u postgres psql -c "\dp"   # —Å–º. (–∏–ª–∏ \z) ‚Äì —Å–ø–∏—Å–æ–∫ —Ç–∞–±–ª–∏—Ü, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π, –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–µ–π, –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –∫ –Ω–∏–º
     sudo -u postgres psql -c "\di"   # —Å–º. –∏–Ω–¥–µ–∫—Å—ã
     sudo -u postgres psql -c "\dt+"   # —Å–º. —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º
     sudo -u postgres psql -c "\d ‚Äútable_name‚Äù"   # —Å–º. –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã
     ```
     ```bash
                                               –°–ø–∏—Å–æ–∫ —Ä–æ–ª–µ–π
      –ò–º—è —Ä–æ–ª–∏ |                                –ê—Ç—Ä–∏–±—É—Ç—ã                                 | –ß–ª–µ–Ω —Ä–æ–ª–µ–π 
     ----------+-------------------------------------------------------------------------+------------
      keycloak |                                                                         | {}
      postgres | –°—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –°–æ–∑–¥–∞—ë—Ç —Ä–æ–ª–∏, –°–æ–∑–¥–∞—ë—Ç –ë–î, –†–µ–ø–ª–∏–∫–∞—Ü–∏—è, –ü—Ä–æ–ø—É—Å–∫–∞—Ç—å RLS | {}
     ```
<br/>



## üî∑ 3. –ê–Ω–∞–ª–∏–∑ –≤—ã–≤–æ–¥–∞ "\du".

1. **postgres** ‚Äî —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å –ø–æ–ª–Ω—ã–º–∏ –ø—Ä–∞–≤–∞–º–∏ (–º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –ë–î, —Ä–æ–ª–∏ –∏ —É–ø—Ä–∞–≤–ª—è—Ç—å —Å–µ—Ä–≤–µ—Ä–æ–º).  
2. **keycloak** ‚Äî –æ–±—ã—á–Ω–∞—è —Ä–æ–ª—å –±–µ–∑ –æ—Å–æ–±—ã—Ö –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –Ω–µ –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –ë–î –∏–ª–∏ –¥—Ä—É–≥–∏–µ —Ä–æ–ª–∏).

### –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –¥–∞—Ç—å –ø—Ä–∞–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é `keycloak`
–°–µ–π—á–∞—Å `keycloak` –∏–º–µ–µ—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞. –ï—Å–ª–∏ Keycloak —Ç—Ä–µ–±—É–µ—Ç –¥–æ—Å—Ç—É–ø –∫ —Å–≤–æ–µ–π –ë–î, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

#### 1. –°–æ–∑–¥–∞–π—Ç–µ –ë–î –¥–ª—è Keycloak (–µ—Å–ª–∏ –µ—â—ë –Ω–µ —Å–æ–∑–¥–∞–Ω–∞):
```bash
sudo -u postgres psql -c "CREATE DATABASE keycloak_db;"
```

#### 2. –î–∞–π—Ç–µ –ø—Ä–∞–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é `keycloak` –Ω–∞ —ç—Ç—É –ë–î:
```bash
sudo -u postgres psql -c "GRANT ALL PRIVILEGES ON DATABASE keycloak_db TO keycloak;"
```

#### 3. (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –ï—Å–ª–∏ Keycloak —Ç—Ä–µ–±—É–µ—Ç –ø—Ä–∞–≤–∞ –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ —Å—Ö–µ–º –∏ —Ç–∞–±–ª–∏—Ü:
```bash
sudo -u postgres psql -c "ALTER ROLE keycloak WITH CREATEDB CREATEROLE;"
```
*(–ë—É–¥—å—Ç–µ –æ—Å—Ç–æ—Ä–æ–∂–Ω—ã —Å `CREATEROLE` ‚Äî —ç—Ç–æ –¥–∞—ë—Ç –ø—Ä–∞–≤–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π!)*

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤:
```bash
sudo -u postgres psql -c "\l"  # –°–ø–∏—Å–æ–∫ –ë–î –∏ –∏—Ö –≤–ª–∞–¥–µ–ª—å—Ü–µ–≤
sudo -u postgres psql -c "\du keycloak"  # –î–µ—Ç–∞–ª–∏ —Ä–æ–ª–∏ keycloak
```
<br/>



## üî∑ 4. –°–æ–∑–¥–∞–Ω–∏–µ –¥–∞–º–ø–∞ –ë–î PostgreSQL.

**–æ—Ç–∫–ª—é—á–∞—Ç—å —Å–µ—Ä–≤–∏—Å PostgreSQL –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –¥–∞–º–ø–∞ –Ω–µ –Ω—É–∂–Ω–æ**.
<details>
<summary>‚ùó –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ ‚ùó</summary>

### **1. `pg_dump` —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ "—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ-—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ–º" —Å–Ω–∏–º–∫–µ**
PostgreSQL –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **MVCC (Multiversion Concurrency Control)**, –∏ `pg_dump` —Å–æ–∑–¥–∞—ë—Ç –¥–∞–º–ø –Ω–∞ –æ—Å–Ω–æ–≤–µ **—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ-—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è** –Ω–∞ –º–æ–º–µ–Ω—Ç –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã —É—Ç–∏–ª–∏—Ç—ã.  
–≠—Ç–æ –∑–Ω–∞—á–∏—Ç:
- –î–∞–º–ø –±—É–¥–µ—Ç —Ü–µ–ª–æ—Å—Ç–Ω—ã–º, –¥–∞–∂–µ –µ—Å–ª–∏ –≤–æ –≤—Ä–µ–º—è –µ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è –≤ –ë–î –∏–¥—É—Ç –∑–∞–ø—Ä–æ—Å—ã.
- PostgreSQL –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–æ –Ω–∞—á–∞–ª–∞ –¥–∞–º–ø–∞ –∏ –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –≤—Å—é –ë–î.

---

### **2. –ò—Å–∫–ª—é—á–µ–Ω–∏—è: –∫–æ–≥–¥–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ—Ä–≤–∏—Å–∞ –º–æ–∂–µ—Ç –ø–æ–Ω–∞–¥–æ–±–∏—Ç—å—Å—è**
–†–µ–¥–∫–∏–µ —Å–ª—É—á–∞–∏, –∫–æ–≥–¥–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ PostgreSQL –æ–ø—Ä–∞–≤–¥–∞–Ω–∞:
1. **–ï—Å–ª–∏ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –¥–∞–º–ø —Ñ–∞–π–ª–æ–≤ –¥–∞–Ω–Ω—ã—Ö (`/var/lib/postgresql`) –Ω–∞–ø—Ä—è–º—É—é** (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è LVM-—Å–Ω–∞–ø—à–æ—Ç–æ–≤).  
   –ù–æ —ç—Ç–æ **–Ω–µ –∑–∞–º–µ–Ω—è–µ—Ç `pg_dump`** –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –æ—Å–æ–±—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö (PITR, —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —É—Ä–æ–≤–Ω–µ –¥–∏—Å–∫–∞).

2. **–ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ `pg_dump --serializable-deferrable`** (—Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º –¥–ª—è —Å—Ç—Ä–æ–≥–æ–π –∏–∑–æ–ª—è—Ü–∏–∏).  
   –ù–æ —ç—Ç–æ –Ω–∏—à–µ–≤—ã–π –≤–∞—Ä–∏–∞–Ω—Ç, –∏ –æ–Ω –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –ø–æ–ª–Ω–æ–π –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å–µ—Ä–≤–∏—Å–∞.

---

### **3. –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –¥–ª—è –¥–∞–º–ø–∞ Jira**
1. **–î–µ–ª–∞–π—Ç–µ –¥–∞–º–ø –±–µ–∑ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ PostgreSQL**:
   ```bash
   sudo -u postgres pg_dump -Fc -d jira -f /path/to/backup/jira_db.dump
   ```
   - `-Fc` ‚Äî –±–∏–Ω–∞—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç (–ª—É—á—à–µ –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è).

2. **–ï—Å–ª–∏ Jira –∞–∫—Ç–∏–≤–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è**:
   - **–î–µ–ª–∞–π—Ç–µ –¥–∞–º–ø –≤ –ø–µ—Ä–∏–æ–¥ –Ω–∏–∑–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏** (—á—Ç–æ–±—ã –º–∏–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤–ª–∏—è–Ω–∏–µ –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å).
   - **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `pg_dump --jobs=N`** (–¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–≥–æ –¥–∞–º–ø–∞ –±–æ–ª—å—à–∏—Ö –ë–î, PostgreSQL 9.3+).

3. **–î–ª—è –Ω—É–ª–µ–≤–æ–≥–æ –¥–∞—É–Ω—Ç–∞–π–º–∞** —Ä–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ:
   - **–†–µ–ø–ª–∏–∫–∞—Ü–∏—é** (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–µ–ª–∞—Ç—å –¥–∞–º–ø —Å —Ä–µ–ø–ª–∏–∫–∏).
   - **–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —Ç–∏–ø–∞ Barman** (–¥–ª—è –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –±—ç–∫–∞–ø–∞ PostgreSQL).

---

### **4. –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Å–ª–µ –¥–∞–º–ø–∞**
1. **–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞** (–Ω–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å 0):
   ```bash
   ls -lh /path/to/backup/jira_db.dump
   ```
2. **–¶–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å** (–ø—Ä–æ—Å–º–æ—Ç—Ä —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ):
   ```bash
   pg_restore --list /path/to/backup/jira_db.dump
   ```

---
</details>



### 1. –°–æ–∑–¥–∞–Ω–∏–µ –¥–∞–º–ø–∞ –¥–ª—è –ë–î `keycloak`.
```bash
sudo -u keycloak psql -c "\du" ;
sudo -u postgres psql -c "\l" ;
sudo -u postgres pg_dump -Fc -d keycloak -f /tmp/keycloak_db.dump
```
*–ì–¥–µ*:
- `-Fc` ‚Äì —Ñ–æ—Ä–º–∞—Ç "custom" (—Å–∂–∞—Ç—ã–π, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤).
- `-d keycloak` ‚Äì –∏–º—è –ë–î –¥–ª—è —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏—è.
- `-f /tmp/keycloak_db.dump` ‚Äì –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É –¥–∞–º–ø–∞.

#### –°–∂–∞—Ç–∏–µ –¥–∞–º–ø–∞ (gzip):
```bash
# –£–ø–∞–∫–æ–≤–∫–∞
sudo -u postgres pg_dump -Fc -d keycloak | gzip > /tmp/keycloak_db.dump.gz

# –†–∞—Å–ø–∞–∫–æ–≤–∫–∞
gunzip /tmp/keycloak_db.dump.gz
```

#### –î–∞–º–ø –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã:
```bash
sudo -u postgres pg_dump -t public.users -d keycloak -f /tmp/users_table.sql
```

#### –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–º–ø–æ–≤.
- /tmp/ ‚Äì –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ (—Ñ–∞–π–ª—ã —É–¥–∞–ª—è—é—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ).
- /var/backups/postgresql/ ‚Äì —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è –±—ç–∫–∞–ø–æ–≤ (—Å–æ–∑–¥–∞–π—Ç–µ –µ—ë, –µ—Å–ª–∏ –Ω–µ—Ç):
```bash
mkdir -p /var/backups/postgresql/
chown postgres:postgres /var/backups/postgresql/
```

#### –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –¥–∞–º–ø–æ–≤.
–î–æ–±–∞–≤–∏—Ç—å –≤ `/etc/crontab`:
```bash
0 3 * * * postgres pg_dump -Fc -d keycloak_db -f /var/backups/postgresql/keycloak_$(date +\%Y-\%m-\%d).dump
```
```bash
echo "0 3 * * * postgres pg_dumpall --clean --if-exists -f /var/backups/postgresql/full_$(date +\%Y-\%m-\%d).sql" | sudo tee -a /etc/crontab
```

—Ç.–µ. –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å—Å—è –¥–∞–º–ø –∫–∞–∂–¥—É—é –Ω–æ—á—å –≤ 3:00.




### 2. –°–æ–∑–¥–∞–Ω–∏–µ –¥–∞–º–ø–∞ –≤—Å–µ—Ö –ë–î –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ.
  ```bash
  sudo -u postgres pg_dumpall -f /tmp/full_postgres_backup.sql
  sudo -u postgres pg_dumpall --clean --if-exists -f /tmp/full_postgres_backup.sql
  ```
  ```bash
  root@keycloack /tmp # ll /tmp/keycloak_db.dump ; ll /tmp/full_postgres_backup.sql 
  -rw-r--r-- 1 postgres postgres 0 –∏—é–ª 24 12:07 /tmp/keycloak_db.dump
  -rw-r--r-- 1 postgres postgres 3039 –∏—é–ª 24 12:12 /tmp/full_postgres_backup.sql
  # –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –¥–∞–º–ø–∞
  head -n 20 /tmp/full_postgres_backup.sql
  ```


### 3.1 –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –¥–º–∞–ø–∞ (–Ω–∞ –Ω–æ–¥–µ).

***–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –î–∞–º–ø–∞***:
```bash
scp /tmp/full_postgres_backup.sql user@backup-server:/path/to/backups/
scp full_postgres_backup.sql keycloak_db.dump root@192.168.45.{201,202,204}:/var/backups/postgresql/
```

***–î–ª—è –¥–∞–º–ø–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ -Fc***:
```bash
sudo -u postgres pg_restore -d <new_db_name> /tmp/keycloak_db.dump
## ------------------

# –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ –º–∞—Å—Ç–µ—Ä-–Ω–æ–¥–µ –∏ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º
ssh root@192.168.45.202

# –°–æ–∑–¥–∞–µ–º –ë–î (–µ—Å–ª–∏ –µ—â–µ –Ω–µ —Å–æ–∑–¥–∞–Ω–∞)
sudo -u postgres psql -c "CREATE DATABASE keycloak;"

# –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–º–ø
sudo -u postgres psql -d keycloak -f /tmp/keycloak_db.dump
```

***–î–ª—è –æ–±—ã—á–Ω–æ–≥–æ SQL-–¥–∞–º–ø–∞***:
```bash
sudo -u postgres psql -d new_db_name -f /tmp/backup.sql
```

***–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª–Ω–æ–≥–æ –¥–∞–º–ø–∞***:
```bash
sudo -u postgres psql -f /tmp/full_postgres_backup.sql
```

***–î–∞–º–ø —Ç–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –ë–î (–∏—Å–∫–ª—é—á–∞—è —Å–∏—Å—Ç–µ–º–Ω—ã–µ)***:
```bash
sudo -u postgres psql -c "SELECT datname FROM pg_database WHERE datname NOT LIKE 'template%' AND datname != 'postgres';" | tail -n +3 | head -n -2 | while read db; do
    sudo -u postgres pg_dump -Fc "$db" -f "/tmp/${db}.dump"
done
```



### 3.1 –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –¥–º–∞–ø–∞ (—Å –Ω–æ—É—Ç–∞).
–ù–∞ –º–∞—à–∏–Ω–µ `192.168.45.50/24` —Å–¥–µ–ª–∞–Ω –¥–∞–º–ø keycloak_db.dump c postgres –ë–î –ø–æ–¥ –Ω–∞–∑–≤–∞–Ω–∏–µ–º keycloak –∏ –ø–µ—Ä–∫–∏–Ω—É—Ç –Ω–∞ –Ω–æ—É—Ç `192.168.87.74`; —Ç–µ–ø–µ—Ä—å —Å –Ω–æ—É—Ç–∞ –Ω—É–∂–Ω–æ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å –ø–æ–ª—É—á–µ–Ω–Ω—ã–π –¥–∞–º–ø **keycloak_db.dump** –Ω–∞ pg* –º–∞—à–∏–Ω–∞—Ö.

–ü–æ–≤–µ—Ä–∏–º –∫–∞–∫–∏–µ pg –º–∞—à–∏–Ω—ã *replica* –∏ *master*:
```bash
patronictl -c /etc/patroni.yml list --format=pretty
etcdctl --endpoints=http://192.168.45.201:2379,http://192.168.45.202:2379,http://192.168.45.204:2379 \
    endpoint status --write-out=simple | column -t -s ','
```

–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞ **pg** –º–∞—à–∏–Ω–∞—Ö –ø–æ—Ä—Ç—ã:
```bash
netstat -tulpan | grep -E '5432|8008|8000|7000'
ss -tulpan | grep -E '5432|8008|8000|7000'
ss -tulpan '( dport = :5432 or dport = :8008 or dport = :8000 or dport = :7000 )'
ss -tulpan | grep -E '5432|8008|8000|7000' | column -t
```

–ï—Å–ª–∏ HAProxy –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å PostgreSQL, –º–æ–∂–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–∞–ø—Ä—è–º—É—é:
```bash
# –° –Ω–æ—É—Ç–±—É–∫–∞ (192.168.87.74)
psql -h 192.168.45.{201,202,204} -p 5000 -U postgres -c "CREATE DATABASE keycloak;"
psql -h 192.168.45.{201,202,204} -p 5000 -U postgres -d keycloak -f keycloak_db.dump
#------------------------------
psql -h 192.168.45.{201,202,204} -p 7000 -U postgres -c "CREATE DATABASE keycloak;"
psql -h 192.168.45.{201,202,204} -p 7000 -U postgres -d keycloak -f keycloak_db.dump
#------------------------------
# –Ω–∞ –Ω–æ—É—Ç–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—å
 psql -h 192.168.45.201 -p 5432 -U postgres -c "CREATE DATABASE keycloak;"  # –ø–∞—Ä–æ–ª—å —Å–º–æ—Ç—Ä–∏ –≤ /etc/patroni.yml
–ü–∞—Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è postgres: <securepassword>
CREATE DATABASE
#-----
# –Ω–∞ pg1 –ø—Ä–æ–≤–µ—Ä–∏—Ç—å
root@pg1 ~ # sudo -u postgres psql -c "\l"
could not change directory to "/root": Permission denied
                                             List of databases
   Name    |  Owner   | Encoding | Collate |  Ctype  | ICU Locale | Locale Provider |   Access privileges   
-----------+----------+----------+---------+---------+------------+-----------------+-----------------------
 keycloak  | postgres | UTF8     | C       | C.UTF-8 |            | libc            | 
 postgres  | postgres | UTF8     | C       | C.UTF-8 |            | libc            | 
 template0 | postgres | UTF8     | C       | C.UTF-8 |            | libc            | =c/postgres          +
           |          |          |         |         |            |                 | postgres=CTc/postgres
 template1 | postgres | UTF8     | C       | C.UTF-8 |            | libc            | =c/postgres          +
           |          |          |         |         |            |                 | postgres=CTc/postgres
(4 rows)
```
–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—É—é –ë–î –Ω–∞ replica –Ω–æ–¥–∞—Ö –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º.

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ. —Ñ–∞–π–ª —Å–∞–º–æ–π –ë–î –Ω–∞ **`pg master`**: `/var/lib/postgresql/patroni/pg_hba.conf`
```bash
root@pg2 ~ # cat /var/lib/postgresql/patroni/pg_hba.conf | grep "192.168.87.74"
host all all 192.168.87.74/32 trust
```
–ï—Å–ª–∏ –Ω–µ—Ç —Å—Ç—Ä–æ–∫–∏ —Å –≤–∞—à–∏–º IP (192.168.87.74), –¥–æ–±–∞–≤—å—Ç–µ –µ—ë:
```bash
echo "host all all 192.168.87.74/32 trust" >> /var/lib/postgresql/patroni/pg_hba.conf
systemctl restart patroni
```
–ß—Ç–æ–±—ã –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–∏–ª–∏—Å—å –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏, —Ç—Ä–µ–±—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **patronictl**.
```bash
#(–û–ü–¶–ò–û–ù–ê–õ–¨–ù–û)
export EDITOR="/usr/bin/mcedit" ; export VISUAL="$EDITOR"

patronictl -c /etc/patroni.yml edit-config
```
–¥–æ–±–∞–≤–∏—Ç—å —Å–ª–µ–¥—É—é—â–µ–µ:
```yaml
postgresql:
# ***
  pg_hba:
  - host replication replicator 192.168.45.0/24 md5
  - host all all 192.168.45.0/24 md5
  - host all all 192.168.87.74/32 trust
  - host all all 192.168.87.2/32 trust
#  - local all all trust
#  - host all all 127.0.0.1/32 trust
```
–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ.:
```bash
patronictl -c /etc/patroni.yml show-config | grep -A10 'pg_hba:'
```
–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª **`pg_hba.conf`**:
```bash
root@pg3 ~ # cat /var/lib/postgresql/patroni/pg_hba.conf | grep 192.168.87.74
host all all 192.168.87.74/32 trust
```
–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ IP (—Å –¥—Ä—É–≥–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞):
```bash
~ # psql -h 192.168.45.201 -U postgres -c "SELECT inet_server_addr();"
 inet_server_addr 
------------------
 192.168.45.201
(1 —Å—Ç—Ä–æ–∫–∞)
```


–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è:
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ HAProxy
psql -h 192.168.45.201 -p 5432 -U postgres -c "\l"
psql -h 192.168.45.201 -p 5432 -U postgres -d keycloak -c "\dt"

# –ò–ª–∏ –Ω–∞–ø—Ä—è–º—É—é –∫ –ª–∏–¥–µ—Ä—É
ssh root@192.168.45.201
sudo -u postgres psql -d keycloak -c "SELECT count(*) FROM pg_tables"
```

–ü–æ—Å–ª–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å –∫–ª–∞—Å—Ç–µ—Ä–∞:
```
patronictl -c /etc/patroni.yml list
```

<br/>




## üî∑ 5. –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –°–æ–∑–¥–∞–Ω–∏—è –¥–∞–º–ø–∞ –ë–î.
–í–æ–∑–Ω–∏–∫–ª–∞ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –±–µ–∫–∞–ø–æ–≤ –ë–î, —á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ –∏—Ö –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å. –ü—Ä–æ—Å—Ç–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –±—É–¥–µ—Ç –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∞ –Ω–∞ –ª–∏–¥–µ—Ä–µ (192.168.45.204 –Ω–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –ª–∏–¥–µ—Ä).
  
–ë—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ-–ø—Ä–µ–∂–Ω–µ–º—É –¥–∏—Ä–µ—Ç–∫–æ—Ä–∏—é `/var/backups/postgresql`, —ç—Ç–æ —É–¥–æ–±–Ω–æ –¥–ª—è –ø–µ—Ä–º–∞–Ω–µ–Ω—Ç–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è.
  
  
<details>
<summary>‚ùó pg_backup.sh ‚ùó</summary>  
  
–°–æ–∑–¥–∞—ë–º —Å–∫—Ä–∏–ø—Ç `/usr/local/bin/pg_backup.sh`
```bash
#!/bin/bash
# /usr/local/bin/pg_backup.sh
export PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
export HOME=/var/lib/postgresql


# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
export PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin

# –û–ø—Ä–µ–¥–µ–ª–∏–º –∫–∞–∫–∏–µ Leader –Ω–æ–¥—ã
/usr/bin/patronictl -c /etc/patroni.yml topology
echo "------"
LEADER_URL=$(/usr/bin/patronictl -c /etc/patroni.yml list --format=tsv | awk '/Leader/ {print $2}')
echo "–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ª–∏–¥–µ—Ä–∞:"
echo "$LEADER_URL"

# –û–ø—Ä–µ–¥–µ–ª–∏–º –∫–∞–∫–∏–µ Replica –Ω–æ–¥—ã
REPLICA_URL=$(/usr/bin/patronictl -c /etc/patroni.yml list --format=tsv | awk '/Replica/ {print $2}')
REPLICA_ID=$(/usr/bin/patronictl -c /etc/patroni.yml list --format=tsv | grep Replica | grep running | head -1 | awk '{print $2}')
echo "–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–µ–ø–ª–∏–∫:"
echo "$REPLICA_URL"
echo "–°–æ–∑–¥–∞–Ω–∏–µ Backup –ë–î –¥–ª—è —Ç–µ–∫—É—â–µ–π(–µ–≥–æ) —Ä–µ–ø–ª–∏–∫–∏(–ª–∏–¥–µ—Ä–∞) –Ω–∞ $(hostname)"

# –°–æ–∑–¥–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é —Å –¥–∞—Ç–æ–π
BACKUP_DATE=$(date +'%d.%m.%Y')
echo "–î–∞—Ç–∞ –±—ç–∫–∞–ø–∞: $BACKUP_DATE"

# –ë—ç–∫–∞–ø —Ç–æ–ª—å–∫–æ Jira –∏ Keycloak
cd /tmp
/usr/bin/pg_dump jira > /var/backups/postgresql/jira_backup_${BACKUP_DATE}.sql
/usr/bin/pg_dump jira_old > /var/backups/postgresql/jira_old_backup_${BACKUP_DATE}.sql
/usr/bin/pg_dump keycloak > /var/backups/postgresql/keycloak_backup_${BACKUP_DATE}.sql

# –°–∂–∏–º–∞–µ–º –±—ç–∫–∞–ø—ã
/usr/bin/gzip -f /var/backups/postgresql/jira_backup_${BACKUP_DATE}.sql
/usr/bin/gzip -f /var/backups/postgresql/jira_old_backup_${BACKUP_DATE}.sql
/usr/bin/gzip -f /var/backups/postgresql/keycloak_backup_${BACKUP_DATE}.sql

# –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –±—ç–∫–∞–ø—ã (—Å—Ç–∞—Ä—à–µ 4 –¥–Ω–µ–π)
/usr/bin/find /var/backups/postgresql/ -name "*_backup_*.sql.gz" -mtime +4 -delete

echo "–ë—ç–∫–∞–ø—ã —Å–æ–∑–¥–∞–Ω—ã:"
ls -alhF /var/backups/postgresql/
```
</details>
  
–ü—Ä–∞–≤–∏–º –¥–æ—Å—Ç—É–ø –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```
chmod +x /usr/local/bin/pg_backup.sh
chown postgres:postgres /usr/local/bin/pg_backup.sh
chown postgres:postgres /var/backups/postgresql/
```
  
–¢.–∫. –ë–∞–∑–æ–π –î–∞–Ω–Ω—ã—Ö —É–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å postgres, —Ç–æ –∏ –æ—Ç –µ–≥–æ –∏–º–µ–Ω–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è —Å–æ–∑–¥–∞–≤–∞—Ç—å cron —Ç—Ä–∏–≥–≥–µ—Ä. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Å–æ–∑–¥–∞—Ç—å –Ω–∞ –æ–¥–Ω–æ–π –º–∞—à–∏–Ω–µ, –Ω–æ –º–æ–∂–Ω–æ –∏ –Ω–∞ –≤—Å–µ—Ö, –Ω–æ –≤ —Ç–∞–∫–æ–º —Å–ª—É—á–∞–µ –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç —Å–º–µ—Å—Ç–∏—Ç—å –Ω–∞ 10 –º–∏–Ω—É—Ç –¥—Ä—É–≥ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –¥—Ä—É–≥–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –±–µ–∫–∞–ø–æ–≤.
```bash
# –û—Ç–∫—Ä—ã–≤–∞–µ–º –∫—Ä–æ–Ω –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è postgres
sudo -u postgres crontab -e
# –ø—Ä–æ–≤–µ—Ä–∫–∞
sudo -u postgres crontab -l
```
–í–Ω—É—Ç—Ä–∏ –∑–∞–ø–∏—à–µ–º:
  ```bash
  #https://crontab.tinyops.ru/
	# –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 2:00 –ø–æ –ú–°–ö (ProxMox 23:00)
	#0 2 * * * /usr/local/bin/simple_backup.sh
	# –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 22:01 –ø–æ –ú–°–ö (ProxMox 19:01)
	01 19 * * * /usr/local/bin/pg_backup.sh
  ```
  
–†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:
  ```bash
  sudo -u postgres /usr/local/bin/pg_backup.sh
  ```
  –∏–ª–∏
  ```bash
  su - postgres -c "/usr/local/bin/pg_backup.sh"
  ```
  
–î–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ):
```bash
# –†–∞—Å–ø–∞–∫–æ–≤–∞—Ç—å
gunzip /var/backups/postgresql/jira_backup.sql.gz
```
```bash
# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
sudo -u postgres psql jira < /var/backups/postgresql/jira_backup.sql
```
<br/>                                                                 
                                                                    
                                                                    
## üî∑ 6. –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–º–ø–∞ –ë–î –Ω–∞ –º–∞—à–∏–Ω—É bcakup.

–ù–µ –∑–∞–±—ã–≤–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –º–µ–∂–¥—É 45 –∏ 87 —Å–µ—Ç—è–º–∏ (—Å–º  [–ú–∞—Ä—à—Ä—É—Ç—ã –Ω–∞ dmzgateway](https://github.com/sherbettt/BASH-cheats/blob/main/–ú–∞—Ä—à—Ä—É—Ç—ã%20–Ω–∞%20dmzgateway.md) )

–ü—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –æ–±–º–µ–Ω SSH –∫–ª—é—á–∞–º–∏.

–°–æ–∑–¥–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –Ω–∞ backup —Å–µ—Ä–≤–µ—Ä–µ:
```
# –ù–∞ 192.168.87.99
sudo mkdir -p /var/backups/postgresql/{pg1,pg2,pg3}
sudo chown -R postgres:postgres /var/backups/postgresql/
```

–ú–æ–∂–Ω–æ —Ä—É–∫–∞–º–∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:
```bash
sudo -u postgres /usr/bin/rsync -avz --progress /var/backups/postgresql/*_backup_*.sql.gz postgres@192.168.87.99:/var/backups/postgresql/pg1
```

–ü–µ—Ä–µ–ø–∏—Å—ã–≤–∞–µ–º —Å–∫—Ä–∏–ø—Ç –¥—Ä—É–≥–∏–º –æ–±—Ä–∞–∑–æ–º:

<details>
<summary>‚ùó pg_backup.sh - jump host/direct copy ‚ùó</summary>

```bash
#!/bin/bash
# /usr/local/bin/pg_backup.sh

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
export PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin

/usr/bin/patronictl -c /etc/patroni.yml topology
echo "–°–æ–∑–¥–∞–Ω–∏–µ Backup –ë–î –¥–ª—è —Ç–µ–∫—É—â–µ–π(–µ–≥–æ) —Ä–µ–ø–ª–∏–∫–∏(–ª–∏–¥–µ—Ä–∞) –Ω–∞ $(hostname)"

# –û–ø—Ä–µ–¥–µ–ª–∏–º Leader –Ω–æ–¥—É
LEADER_ID=$(/usr/bin/patronictl -c /etc/patroni.yml list --format=tsv | awk '/Leader/ {print $2}')

# –û–ø—Ä–µ–¥–µ–ª–∏–º –∫–∞–∫–∏–µ Replica –Ω–æ–¥—ã
#REPLICA_ID=$(/usr/bin/patronictl -c /etc/patroni.yml list --format=tsv | awk '/Replica/ {print $2}')
REPLICA_ID=$(/usr/bin/patronictl -c /etc/patroni.yml list --format=tsv | grep Replica | grep running | head -1 | awk '{print $2}')

# –í–∞–∂–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
BACKUP_DATE=$(date +"%F"_%H:%M:%S)     # –∏–ª–∏ $(date +"%F"/"%X")
BACKUP_SERVER="192.168.87.99"
BACKUP_PATH="/var/backups/postgresql/$(hostname)/"
echo "–î–∞—Ç–∞ –±—ç–∫–∞–ø–∞: $BACKUP_DATE"
echo "Backup server: $BACKUP_SERVER:$BACKUP_PATH"

# –ë—ç–∫–∞–ø —Ç–æ–ª—å–∫–æ Jira –∏ Keycloak
cd /tmp
/usr/bin/pg_dump jira > /var/backups/postgresql/jira_backup_${BACKUP_DATE}.sql
/usr/bin/pg_dump keycloak > /var/backups/postgresql/keycloak_backup_${BACKUP_DATE}.sql

# –°–∂–∏–º–∞–µ–º –±—ç–∫–∞–ø—ã
/usr/bin/gzip -f /var/backups/postgresql/jira_backup_${BACKUP_DATE}.sql
/usr/bin/gzip -f /var/backups/postgresql/keycloak_backup_${BACKUP_DATE}.sql
echo "============================"

# –°–Ω–∞—á–∞–ª–∞ –ø–∏–Ω–≥, –ø–æ—Ç–æ–º –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–∞
if ping -c 2 -W 2 ${BACKUP_SERVER} >/dev/null 2>&1; then
    echo "–ü–∏–Ω–≥ –Ω–∞ ${BACKUP_SERVER} —É—Å–ø–µ—à–µ–Ω"
    # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ SSH
    if ! nc -z -w 3 ${BACKUP_SERVER} 22 >/dev/null 2>&1; then
        echo "–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ: SSH –Ω–∞ ${BACKUP_SERVER} –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω" >&2
    fi
else
    echo "–û—à–∏–±–∫–∞: backup server ${BACKUP_SERVER} –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω" >&2
    exit 1
fi
echo "============================"


## –ö–æ–ø–∏—Ä—É–µ–º —á–µ—Ä–µ–∑ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–π —Ö–æ—Å—Ç (jump host)
# sudo -u postgres /usr/bin/rsync -avz --progress -e "ssh -J root@192.168.87.2" /var/backups/postgresql/*_backup_*.sql.gz postgres@192.168.87.99:/var/backups/postgresql/$(hostname)/
echo "RSYNC: –∫–æ–ø–∏—Ä—É–µ–º –±—ç–∫–∞–ø—ã —á–µ—Ä–µ–∑ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–π —Ö–æ—Å—Ç 192.168.87.2 (jump host): "
if /usr/bin/rsync -avz --progress -e "ssh -J root@192.168.87.2" /var/backups/postgresql/*_backup_${BACKUP_DATE}.sql.gz postgres@192.168.87.99:${BACKUP_PATH}; then
	echo "–¢–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: $(whoami)"
	echo "–í–ª–∞–¥–µ–ª–µ—Ü –ø—Ä–æ—Ü–µ—Å—Å–∞: $(ps -o user= -p $$)"
    echo "–ë—ç–∫–∞–ø—ã —É—Å–ø–µ—à–Ω–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã"
fi
echo "============================"

## –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å–ø–µ—à–Ω–æ—Å—Ç—å –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
# $? - —ç—Ç–æ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –≤ bash, –∫–æ—Ç–æ—Ä–∞—è —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–æ–¥ –≤–æ–∑–≤—Ä–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–π –∫–æ–º–∞–Ω–¥—ã
# 0 –æ–∑–Ω–∞—á–∞–µ—Ç —É—Å–ø–µ—Ö (–≤ Linux/UNIX —É—Å–ø–µ—à–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç 0)
# –õ—é–±–æ–µ –¥—Ä—É–≥–æ–µ —á–∏—Å–ª–æ –æ–∑–Ω–∞—á–∞–µ—Ç –æ—à–∏–±–∫—É (—á–∞—Å—Ç–æ 1, –Ω–æ –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–∞–∑–Ω–æ–µ)
if [ $? -eq 0 ]; then
    echo "–ë—ç–∫–∞–ø—ã —É—Å–ø–µ—à–Ω–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã –Ω–∞ $BACKUP_SERVER:$BACKUP_PATH"
else
	# –ï—Å–ª–∏ –∫–æ–¥ –≤–æ–∑–≤—Ä–∞—Ç–∞ != 0 (–æ—à–∏–±–∫–∞)
    echo "–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ $BACKUP_SERVER!" >&2
fi
echo "============================"

## –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –±—ç–∫–∞–ø—ã –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ pg (—Å—Ç–∞—Ä—à–µ 2 –¥–Ω–µ–π)
#/usr/bin/find /var/backups/postgresql/ -name "*_backup_*.sql.gz" -mtime +2 -delete

cd /var/backups/postgresql/
#ls -t *_backup_*.sql.gz | tail -n +5 | xargs rm -f -- 2>/dev/null || true
# –°—á–∏—Ç–∞–µ–º —Ñ–∞–π–ª—ã
FILE_COUNT=$(ls -t *_backup_*.sql.gz 2>/dev/null | wc -l)
if [ $FILE_COUNT -gt 4 ]; then
    echo "–£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã –Ω–∞ $(hostname):"
    ls -t *_backup_*.sql.gz | tail -n +5
    ls -t *_backup_*.sql.gz | tail -n +5 | xargs rm -f --
    echo "–£–¥–∞–ª–µ–Ω–æ $(($FILE_COUNT - 4)) —Ñ–∞–π–ª–æ–≤"
else
    echo "–§–∞–π–ª–æ–≤ –º–µ–Ω—å—à–µ 5, –Ω–∏—á–µ–≥–æ –Ω–µ —É–¥–∞–ª—è–µ–º (–≤—Å–µ–≥–æ: $FILE_COUNT)"
fi

echo "-------------------------------"
echo "UTC –ø–æ –ú–°–ö: $(date +"%F"/"%X")"
echo "–ê–∫—Ç—É–∞–ª—å–Ω—ã–µ –ª–æ–∫–∞–ª—å–Ω—ã–µ –±—ç–∫–∞–ø—ã:"
ls -alhF /var/backups/postgresql/
echo "============================"


## –û—á–∏—â–∞–µ–º —Å—Ç–∞—Ä—ã–µ –±—ç–∫–∞–ø—ã –Ω–∞ backup —Å–µ—Ä–≤–µ—Ä–µ
echo "–û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –±—ç–∫–∞–ø–æ–≤ –Ω–∞ backup —Å–µ—Ä–≤–µ—Ä–µ $BACKUP_SERVER:$BACKUP_PATH |"
ssh -J root@192.168.87.2 postgres@${BACKUP_SERVER} "
cd ${BACKUP_PATH}
FILE_COUNT_REMOTE=\$(ls -t *_backup_*.sql.gz 2>/dev/null | wc -l)
if [ \$FILE_COUNT_REMOTE -gt 4 ]; then
    echo '–£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã –Ω–∞ ${BACKUP_SERVER}:'
    ls -t *_backup_*.sql.gz | tail -n +5
    ls -t *_backup_*.sql.gz | tail -n +5 | xargs rm -f --
    echo '–£–¥–∞–ª–µ–Ω–æ '\$((FILE_COUNT_REMOTE - 4))' —Ñ–∞–π–ª–æ–≤ –Ω–∞ backup —Å–µ—Ä–≤–µ—Ä–µ'
else
    echo '–§–∞–π–ª–æ–≤ –Ω–∞ backup —Å–µ—Ä–≤–µ—Ä–µ –º–µ–Ω—å—à–µ 5, –Ω–∏—á–µ–≥–æ –Ω–µ —É–¥–∞–ª—è–µ–º (–≤—Å–µ–≥–æ: '\$FILE_COUNT_REMOTE')'
fi
echo '–ê–∫—Ç—É–∞–ª—å–Ω—ã–µ –±—ç–∫–∞–ø—ã –Ω–∞ backup (${BACKUP_SERVER}) —Å–µ—Ä–≤–µ—Ä–µ:'
ls -alhF ${BACKUP_PATH}
"
echo "============================"




##==============–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è==============
# –ö–æ–ø–∏—Ä—É–µ–º —á–µ—Ä–µ–∑ SCP (–≤–∞—Ä–∏–∞–Ω—Ç 2 - –º–∞—Å—Å–æ–≤–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ)
#echo "–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤ —á–µ—Ä–µ–∑ SCP..."
#if scp /var/backups/postgresql/*_backup_${BACKUP_DATE}.sql.gz postgres@${BACKUP_SERVER}:${BACKUP_PATH}; then
#    echo "–í—Å–µ –±—ç–∫–∞–ø—ã —É—Å–ø–µ—à–Ω–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã –Ω–∞ $BACKUP_SERVER:$BACKUP_PATH"
#else
#    echo "–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤ –Ω–∞ $BACKUP_SERVER!" >&2
#    exit 1
#fi

# –ö–æ–ø–∏—Ä—É–µ–º –Ω–∞–ø—Ä—è–º—É—é (–±–µ–∑ jump host)
#if /usr/bin/rsync -avz --progress -e "ssh -o BatchMode=yes" /var/backups/postgresql/*_backup_${BACKUP_DATE}.sql.gz postgres@${BACKUP_SERVER}:${BACKUP_PATH}; then
#	echo "–¢–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: $(whoami)"
#	echo "–í–ª–∞–¥–µ–ª–µ—Ü –ø—Ä–æ—Ü–µ—Å—Å–∞: $(ps -o user= -p $$)"
#    echo "–ë—ç–∫–∞–ø—ã —É—Å–ø–µ—à–Ω–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã –Ω–∞ $BACKUP_SERVER:$BACKUP_PATH"
#else
#	echo "–¢–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: $(whoami)"
#	echo "–í–ª–∞–¥–µ–ª–µ—Ü –ø—Ä–æ—Ü–µ—Å—Å–∞: $(ps -o user= -p $$)"
#    echo "–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ $BACKUP_SERVER!" >&2
#    exit 1
#fi
##=================================================================
```
</details>



<details>
<summary>‚ùó pg_backup.sh + progress bar ‚ùó</summary>

```bash
#!/bin/bash
# /usr/local/bin/pg_backup.sh

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
export PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞
progress_bar() {
    local duration=${1}
    local columns=$(tput cols)
    local space_available=$(( columns - 8 ))
    local progress=$(( (${CURRENT_STEP} * space_available) / ${TOTAL_STEPS} ))
    local rest=$(( space_available - progress ))
    local percent=$(( (${CURRENT_STEP} * 100) / ${TOTAL_STEPS} ))
    
    printf "\r["
    printf "%${progress}s" | tr " " "="
    printf "%${rest}s" | tr " " " "
    printf "] %3d%%" ${percent}
    
    sleep ${duration}
    CURRENT_STEP=$((CURRENT_STEP + 1))
}

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –¥–ª—è –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞
TOTAL_STEPS=15
CURRENT_STEP=1

echo "–°–æ–∑–¥–∞–Ω–∏–µ Backup –ë–î –¥–ª—è —Ç–µ–∫—É—â–µ–π(–µ–≥–æ) —Ä–µ–ø–ª–∏–∫–∏(–ª–∏–¥–µ—Ä–∞) –Ω–∞ $(hostname)"
progress_bar 0.5

/usr/bin/patronictl -c /etc/patroni.yml topology
progress_bar 0.5

# –û–ø—Ä–µ–¥–µ–ª–∏–º Leader –Ω–æ–¥—É
LEADER_ID=$(/usr/bin/patronictl -c /etc/patroni.yml list --format=tsv | awk '/Leader/ {print $2}')
progress_bar 0.5

# –û–ø—Ä–µ–¥–µ–ª–∏–º –∫–∞–∫–∏–µ Replica –Ω–æ–¥—ã
REPLICA_ID=$(/usr/bin/patronictl -c /etc/patroni.yml list --format=tsv | grep Replica | grep running | head -1 | awk '{print $2}')
progress_bar 0.5

# –í–∞–∂–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
BACKUP_DATE=$(date +"%F"_%H:%M:%S)
BACKUP_SERVER="192.168.87.99"
BACKUP_PATH="/var/backups/postgresql/$(hostname)/"
echo "–î–∞—Ç–∞ –±—ç–∫–∞–ø–∞: $BACKUP_DATE"
echo "Backup server: $BACKUP_SERVER:$BACKUP_PATH"
progress_bar 0.5

# –ë—ç–∫–∞–ø —Ç–æ–ª—å–∫–æ Jira –∏ Keycloak
echo "–°–æ–∑–¥–∞–Ω–∏–µ –±—ç–∫–∞–ø–∞ Jira..."
cd /tmp
/usr/bin/pg_dump jira > /var/backups/postgresql/jira_backup_${BACKUP_DATE}.sql
progress_bar 1

echo "–°–æ–∑–¥–∞–Ω–∏–µ –±—ç–∫–∞–ø–∞ Keycloak..."
/usr/bin/pg_dump keycloak > /var/backups/postgresql/keycloak_backup_${BACKUP_DATE}.sql
progress_bar 1

# –°–∂–∏–º–∞–µ–º –±—ç–∫–∞–ø—ã
echo "–°–∂–∞—Ç–∏–µ –±—ç–∫–∞–ø–æ–≤..."
/usr/bin/gzip -f /var/backups/postgresql/jira_backup_${BACKUP_DATE}.sql
progress_bar 0.5

/usr/bin/gzip -f /var/backups/postgresql/keycloak_backup_${BACKUP_DATE}.sql
progress_bar 0.5

echo "============================"
progress_bar 0.5

# –°–Ω–∞—á–∞–ª–∞ –ø–∏–Ω–≥, –ø–æ—Ç–æ–º –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–∞
echo "–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ backup —Å–µ—Ä–≤–µ—Ä–∞..."
if ping -c 2 -W 2 ${BACKUP_SERVER} >/dev/null 2>&1; then
    echo "–ü–∏–Ω–≥ –Ω–∞ ${BACKUP_SERVER} —É—Å–ø–µ—à–µ–Ω"
    progress_bar 0.5
    
    # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ SSH
    if ! nc -z -w 3 ${BACKUP_SERVER} 22 >/dev/null 2>&1; then
        echo "–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ: SSH –Ω–∞ ${BACKUP_SERVER} –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω" >&2
    else
        echo "SSH –¥–æ—Å—Ç—É–ø–µ–Ω"
    fi
    progress_bar 0.5
    
else
    echo "–û—à–∏–±–∫–∞: backup server ${BACKUP_SERVER} –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω" >&2
    exit 1
fi

echo "============================"
progress_bar 0.5

## –ö–æ–ø–∏—Ä—É–µ–º —á–µ—Ä–µ–∑ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–π —Ö–æ—Å—Ç (jump host)
echo "–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –±—ç–∫–∞–ø–æ–≤ –Ω–∞ —É–¥–∞–ª–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä..."
if /usr/bin/rsync -avz --progress -e "ssh -J root@192.168.87.2" /var/backups/postgresql/*_backup_${BACKUP_DATE}.sql.gz postgres@192.168.87.99:${BACKUP_PATH}; then
    echo "–¢–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: $(whoami)"
    echo "–í–ª–∞–¥–µ–ª–µ—Ü –ø—Ä–æ—Ü–µ—Å—Å–∞: $(ps -o user= -p $$)"
    echo "–ë—ç–∫–∞–ø—ã —É—Å–ø–µ—à–Ω–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã"
    progress_bar 2
fi

echo "============================"
progress_bar 0.5

## –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å–ø–µ—à–Ω–æ—Å—Ç—å –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
if [ $? -eq 0 ]; then
    echo "–ë—ç–∫–∞–ø—ã —É—Å–ø–µ—à–Ω–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã –Ω–∞ $BACKUP_SERVER:$BACKUP_PATH"
else
    echo "–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ $BACKUP_SERVER!" >&2
fi

echo "============================"
progress_bar 0.5

## –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –±—ç–∫–∞–ø—ã –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ pg
echo "–û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –ª–æ–∫–∞–ª—å–Ω—ã—Ö –±—ç–∫–∞–ø–æ–≤..."
cd /var/backups/postgresql/
FILE_COUNT=$(ls -t *_backup_*.sql.gz 2>/dev/null | wc -l)
if [ $FILE_COUNT -gt 4 ]; then
    echo "–£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã –Ω–∞ $(hostname):"
    ls -t *_backup_*.sql.gz | tail -n +5
    ls -t *_backup_*.sql.gz | tail -n +5 | xargs rm -f --
    echo "–£–¥–∞–ª–µ–Ω–æ $(($FILE_COUNT - 4)) —Ñ–∞–π–ª–æ–≤"
else
    echo "–§–∞–π–ª–æ–≤ –º–µ–Ω—å—à–µ 5, –Ω–∏—á–µ–≥–æ –Ω–µ —É–¥–∞–ª—è–µ–º (–≤—Å–µ–≥–æ: $FILE_COUNT)"
fi
progress_bar 1

echo "-------------------------------"
echo "UTC –ø–æ –ú–°–ö: $(date +"%F"/"%X")"
echo "–ê–∫—Ç—É–∞–ª—å–Ω—ã–µ –ª–æ–∫–∞–ª—å–Ω—ã–µ –±—ç–∫–∞–ø—ã:"
ls -alhF /var/backups/postgresql/
echo "============================"
progress_bar 0.5

## –û—á–∏—â–∞–µ–º —Å—Ç–∞—Ä—ã–µ –±—ç–∫–∞–ø—ã –Ω–∞ backup —Å–µ—Ä–≤–µ—Ä–µ
echo "–û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –±—ç–∫–∞–ø–æ–≤ –Ω–∞ backup —Å–µ—Ä–≤–µ—Ä–µ..."
ssh -J root@192.168.87.2 postgres@${BACKUP_SERVER} "
cd ${BACKUP_PATH}
FILE_COUNT_REMOTE=\$(ls -t *_backup_*.sql.gz 2>/dev/null | wc -l)
if [ \$FILE_COUNT_REMOTE -gt 4 ]; then
    echo '–£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã –Ω–∞ ${BACKUP_SERVER}:'
    ls -t *_backup_*.sql.gz | tail -n +5
    ls -t *_backup_*.sql.gz | tail -n +5 | xargs rm -f --
    echo '–£–¥–∞–ª–µ–Ω–æ '\$((FILE_COUNT_REMOTE - 4))' —Ñ–∞–π–ª–æ–≤ –Ω–∞ backup —Å–µ—Ä–≤–µ—Ä–µ'
else
    echo '–§–∞–π–ª–æ–≤ –Ω–∞ backup —Å–µ—Ä–≤–µ—Ä–µ –º–µ–Ω—å—à–µ 5, –Ω–∏—á–µ–≥–æ –Ω–µ —É–¥–∞–ª—è–µ–º (–≤—Å–µ–≥–æ: '\$FILE_COUNT_REMOTE')'
fi
echo '–ê–∫—Ç—É–∞–ª—å–Ω—ã–µ –±—ç–∫–∞–ø—ã –Ω–∞ backup (${BACKUP_SERVER}) —Å–µ—Ä–≤–µ—Ä–µ:'
ls -alhF ${BACKUP_PATH}
"
progress_bar 2

echo "============================"
echo "–ë—ç–∫–∞–ø –∑–∞–≤–µ—Ä—à–µ–Ω —É—Å–ø–µ—à–Ω–æ!"
printf "\n"  # –ù–æ–≤–∞—è —Å—Ç—Ä–æ–∫–∞ –ø–æ—Å–ª–µ –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞
```
</details>


–£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:
```bash
# –ü—Ä–æ—Å—Ç–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –¥–ª—è –¥–ª–∏—Ç–µ–ª—å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
show_progress() {
    local pid=$1
    local message=$2
    local delay=0.5
    local spin=('‚£∑' '‚£Ø' '‚£ü' '‚°ø' '‚¢ø' '‚£ª' '‚£Ω' '‚£æ')
    local i=0
    
    echo -n "$message "
    while kill -0 $pid 2>/dev/null; do
        printf "\r$message ${spin[i++ % ${#spin[@]}]}"
        sleep $delay
    done
    printf "\r$message ‚úì\n"
}

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
/pg_dump jira > backup.sql &
show_progress $! "–°–æ–∑–¥–∞–Ω–∏–µ –¥–∞–º–ø–∞ jira"
```
<br/>

----------------------------------------------------------------------

## üî∑ 7. –°–æ–∑–¥–∞–Ω–∏–µ –¥–∞–º–ø–∞ –ë–î –Ω–∞ LK —Å–µ—Ä–≤–µ—Ä–∞—Ö

## –°–æ–∑–¥–∞–Ω–∏–µ –¥–∞–º–ø–æ–≤ PostgreSQL (—Ä—É–∫–∞–º–∏):

### 1. **–°–æ–∑–¥–∞–Ω–∏–µ –¥–∞–º–ø–æ–≤ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ lk-fianit.cprt.su:**
```bash
# –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É
ssh root@lk-fianit.cprt.su

# –°–æ–∑–¥–∞–µ–º –¥–∞–º–ø—ã –≤—Å–µ—Ö –Ω—É–∂–Ω—ã—Ö –±–∞–∑
sudo -u postgres pg_dump rt_pbx_v2 | gzip > /tmp/rt_pbx_v2-$(date +%Y-%m-%d_%H-%M-%S).sql.gz
sudo -u postgres pg_dump rt_pbx_v2_media | gzip > /tmp/rt_pbx_v2_media-$(date +%Y-%m-%d_%H-%M-%S).sql.gz
sudo -u postgres pg_dump rt_pbx_v2_stat | gzip > /tmp/rt_pbx_v2_stat-$(date +%Y-%m-%d_%H-%M-%S).sql.gz
sudo -u postgres pg_dump rt_pbx_v2_logging | gzip > /tmp/rt_pbx_v2_logging-$(date +%Y-%m-%d_%H-%M-%S).sql.gz

# –ü—Ä–æ–≤–µ—Ä—è–µ–º
ls -la /tmp/rt_pbx_v2*.sql.gz
```

### 2. **–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ backup-—Å–µ—Ä–≤–µ—Ä:**
```bash
# –°–æ–∑–¥–∞–µ–º –∫–∞—Ç–∞–ª–æ–≥ –Ω–∞ backup-—Å–µ—Ä–≤–µ—Ä–µ
ssh root@192.168.87.99 "mkdir -p /usr/local/runtel/storage_files/telecoms/lk-fianit.cprt.su/$(date +%Y-%m-%d_%H-%M-%S)"

# –ö–æ–ø–∏—Ä—É–µ–º —Ñ–∞–π–ª—ã —Å –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º
for file in /tmp/rt_pbx_v2*.sql.gz; do
    echo "–ö–æ–ø–∏—Ä—É–µ–º $file"
    rsync -av --progress "$file" root@192.168.87.99:/usr/local/runtel/storage_files/telecoms/lk-fianit.cprt.su/$(date +%Y-%m-%d_%H-%M-%S)/
done
```

### 3. **–û—á–∏—Å—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤:**
```bash
# –£–¥–∞–ª—è–µ–º –¥–∞–º–ø—ã –∏–∑ /tmp
rm -f /tmp/rt_pbx_v2*.sql.gz
```

## üî∑ 8. –°–æ–∑–¥–∞–Ω–∏–µ –¥–∞–º–ø–æ–≤ —á–µ—Ä–µ–∑ Ansible (—Ä—É–∫–∞–º–∏):

### 1. **–ó–∞–ø—É—Å–∫ Ansible playbook:**
```bash
# –í Semaphore UI –Ω–∞–∂–∏–º–∞–µ–º "Run" –¥–ª—è —à–∞–±–ª–æ–Ω–∞ "lk-fianit.cprt.su"
# –ò–ª–∏ —á–µ—Ä–µ–∑ CLI
cd /tmp/semaphore/project_3/repository_4_template_105/playbooks/
ansible-playbook -i inventory dump_play.yml --limit lk-fianit.cprt.su
```

### 2. **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç Ansible:**
- ‚úÖ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –Ω—É–∂–Ω—ã–µ –ø–∞–∫–µ—Ç—ã (rsync, python3-psycopg2)
- ‚úÖ –°–æ–∑–¥–∞–µ—Ç –¥–∞–º–ø—ã 4 –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö –≤ `/tmp/`
- ‚úÖ –ö–æ–ø–∏—Ä—É–µ—Ç –¥–∞–º–ø—ã –Ω–∞ backup-—Å–µ—Ä–≤–µ—Ä `192.168.87.99`
- ‚úÖ –û—á–∏—â–∞–µ—Ç `/tmp/` –æ—Ç –¥–∞–º–ø–æ–≤
- ‚úÖ –£–ø—Ä–∞–≤–ª—è–µ—Ç —Ä–æ—Ç–∞—Ü–∏–µ–π (–æ—Å—Ç–∞–≤–ª—è–µ—Ç 14 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –±—ç–∫–∞–ø–æ–≤)

### 3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:**
```bash
# –ù–∞ backup-—Å–µ—Ä–≤–µ—Ä–µ –ø—Ä–æ–≤–µ—Ä—è–µ–º
ssh root@192.168.87.99
cd /usr/local/runtel/storage_files/telecoms/lk-fianit.cprt.su/
ls -la
find . -name "*.sql.gz" -exec ls -la {} \;
```

## üî∑ 9. –ë—ã—Å—Ç—Ä–æ–µ —Ä—É—á–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è —Ç–µ–∫—É—â–µ–π —Å–∏—Ç—É–∞—Ü–∏–∏:

### –û—á–∏—Å—Ç–∫–∞ —Å–º–µ—à–∞–Ω–Ω–æ–≥–æ –∫–∞—Ç–∞–ª–æ–≥–∞ –∏ —Å–æ–∑–¥–∞–Ω–∏–µ —á–∏—Å—Ç–æ–≥–æ –±—ç–∫–∞–ø–∞:
```bash
# –ù–∞ backup-—Å–µ—Ä–≤–µ—Ä–µ –æ—á–∏—â–∞–µ–º –ø—Ä–æ–±–ª–µ–º–Ω—ã–π –∫–∞—Ç–∞–ª–æ–≥
ssh root@192.168.87.99 "rm -rf /usr/local/runtel/storage_files/telecoms/lk-fianit.cprt.su/2025-11-07"

# –ù–∞ lk-fianit.cprt.su –æ—á–∏—â–∞–µ–º /tmp
ssh root@lk-fianit.cprt.su "rm -f /tmp/rt_pbx_v2*.sql.gz"

# –ó–∞–ø—É—Å–∫–∞–µ–º Ansible playbook –¥–ª—è —á–∏—Å—Ç–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
```

## –ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã:

- **–†—É—á–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ**: `pg_dump` + `gzip` + `rsync`
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ**: Ansible playbook –≤ Semaphore
- **–ü—Ä–æ–±–ª–µ–º–∞ –±—ã–ª–∞**: –í –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ `current_timestamp` –≤ playbook
- **–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å timestamp —Å–æ–∑–¥–∞–Ω–Ω—ã–π –Ω–∞ backup-—Å–µ—Ä–≤–µ—Ä–µ

**–†–µ–∫–æ–º–µ–Ω–¥—É—é –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Ansible** - –æ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É–µ—Ç –≤–µ—Å—å –ø—Ä–æ—Ü–µ—Å—Å –∏ —É–ø—Ä–∞–≤–ª—è–µ—Ç —Ä–æ—Ç–∞—Ü–∏–µ–π –±—ç–∫–∞–ø–æ–≤.
<br/>

----------------------------------------------------------------------



<br/>

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–∞—Ä–æ–ª—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è **postgres** –≤ PostgreSQL

#### 1. **–í–æ–π–¥–∏—Ç–µ –≤ –∫–æ–Ω—Å–æ–ª—å PostgreSQL –æ—Ç –∏–º–µ–Ω–∏ —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**:
```bash
sudo -u postgres psql
```
*(–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –æ—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞, —Å–Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ `cd /tmp`)*

#### 2. **–í –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–π –∫–æ–Ω—Å–æ–ª–∏ PostgreSQL –≤—ã–ø–æ–ª–Ω–∏—Ç–µ**:
```sql
ALTER ROLE postgres WITH PASSWORD '–≤–∞—à_–ø–∞—Ä–æ–ª—å';
```
–ó–∞–º–µ–Ω–∏—Ç–µ `–≤–∞—à_–ø–∞—Ä–æ–ª—å` –Ω–∞ –Ω–∞–¥–µ–∂–Ω—ã–π –ø–∞—Ä–æ–ª—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, `Str0ngP@ssw0rd!`).

#### 3. **–í—ã–π–¥–∏—Ç–µ –∏–∑ –∫–æ–Ω—Å–æ–ª–∏**:
```sql
\q
```

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–µ—Å–ª–∏ PostgreSQL –Ω–µ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –ø–∞—Ä–æ–ª—å)

#### 1. **–ò–∑–º–µ–Ω–∏—Ç–µ –º–µ—Ç–æ–¥ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –≤ `pg_hba.conf`**:
–û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:
```bash
sudo nano /etc/postgresql/15/main/pg_hba.conf
```
*(–ü—É—Ç—å –º–æ–∂–µ—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤–µ—Ä—Å–∏–∏ PostgreSQL –∏ –û–°. –ê–∫—Ç—É–∞–ª—å–Ω—É—é –≤–µ—Ä—Å–∏—é –º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–º–∞–Ω–¥–æ–π `ls /etc/postgresql/`)*

–ù–∞–π–¥–∏—Ç–µ —Å—Ç—Ä–æ–∫—É:
```
local   all             postgres                                peer
```
–ò –∑–∞–º–µ–Ω–∏—Ç–µ `peer` –Ω–∞ `md5` –∏–ª–∏ `scram-sha-256`:
```
local   all             postgres                                md5
```

#### 2. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ PostgreSQL**:
```bash
sudo systemctl restart postgresql
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–æ–ª—è
–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è —Å –ø–∞—Ä–æ–ª–µ–º:
```bash
psql -U postgres -h localhost -W
```
*(–°–∏—Å—Ç–µ–º–∞ –∑–∞–ø—Ä–æ—Å–∏—Ç –ø–∞—Ä–æ–ª—å. –í–≤–µ–¥–∏—Ç–µ —Ç–æ—Ç, —á—Ç–æ –∑–∞–¥–∞–ª–∏ —á–µ—Ä–µ–∑ `ALTER ROLE`)*


### –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è:
1. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø–∞—Ä–æ–ª—è**:
   - –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–æ—Å—Ç—ã–µ –ø–∞—Ä–æ–ª–∏ –≤—Ä–æ–¥–µ `12345`.
   - –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è: –±—É–∫–≤—ã (–≤–µ—Ä—Ö–Ω–∏–π/–Ω–∏–∂–Ω–∏–π —Ä–µ–≥–∏—Å—Ç—Ä), —Ü–∏—Ñ—Ä—ã, —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª—ã (`!@#$%^&*`).

2. **–ï—Å–ª–∏ –∑–∞–±—ã–ª–∏ –ø–∞—Ä–æ–ª—å**:
   - –°–±—Ä–æ—Å–∏—Ç—å –µ–≥–æ –º–æ–∂–Ω–æ —á–µ—Ä–µ–∑ `ALTER ROLE` (–∫–∞–∫ –ø–æ–∫–∞–∑–∞–Ω–æ –≤—ã—à–µ), –Ω–æ –¥–ª—è —ç—Ç–æ–≥–æ –Ω—É–∂–µ–Ω –¥–æ—Å—Ç—É–ø –∫ `sudo`.

3. **–î–ª—è Keycloak**:
   –ï—Å–ª–∏ Keycloak –∏—Å–ø–æ–ª—å–∑—É–µ—Ç PostgreSQL, –∑–∞–¥–∞–π—Ç–µ –ø–∞—Ä–æ–ª—å –∏ –¥–ª—è –µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
   ```sql
   ALTER ROLE keycloak WITH PASSWORD '–ø–∞—Ä–æ–ª—å_–¥–ª—è_keycloak';
   ```

4. **–õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è**:
   –ï—Å–ª–∏ —Å–Ω–æ–≤–∞ –ø–æ—è–≤–ª—è—é—Ç—Å—è –æ—à–∏–±–∫–∏ –ª–æ–∫–∞–ª–∏ (`perl: warning`), –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
   ```bash
   sudo dpkg-reconfigure locales
   ```
   –ò –≤—ã–±–µ—Ä–∏—Ç–µ `ru_RU.UTF-8`.
<br/>


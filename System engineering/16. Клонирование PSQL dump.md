## üî∑ 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –º–∞—à–∏–Ω—ã –≤ ProxMox.

 –ó–∞—Ö–æ–¥–∏–º –≤ –∫–ª–∞—Å—Ç–µ—Ä –ø–æ –æ–¥–Ω–æ–π –∏–∑ —Å—Å—ã–ª–æ–∫:
- https://192.168.87.17:8006/#v1:0:18:4::::::: - prox4;
- https://192.168.87.20:8006/#v1:0:18:4::::::: - pmx5;
- https://192.168.87.6:8006/#v1:0:18:4::::::: - pmx6.


–ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:
-  –º–∞—à–∏–Ω–∞ ***Container 102 (dmzgateway) on node 'pmx6'***, —É –∫–æ—Ç–æ—Ä–æ–π —Ç—Ä–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ —Å —Ç–∏–ø–æ–º Bridge:
    - **vmbr0**: `192.168.87.2/24` (—à–ª—é–∑ `192.168.87.1`) - –≤–Ω–µ—à–∫–∞ –∏-–Ω–µ—Ç;
    - **dmznet**: `192.168.46.1/24` - —è–≤–ª—è–µ—Ç—Å—è —à–ª—é–∑–æ–º –¥–ª—è –¥—Ä—É–≥–∏—Ö –º–∞—à–∏–Ω –≤ —ç—Ç–æ–π —Å–µ—Ç–∏;
    - **pgnet**: `192.168.45.1/24` - —è–≤–ª—è–µ—Ç—Å—è —à–ª—é–∑–æ–º –¥–ª—è –¥—Ä—É–≥–∏—Ö –º–∞—à–∏–Ω –≤ —ç—Ç–æ–π —Å–µ—Ç–∏;
- –º–∞—à–∏–Ω–∞ ***Container 172 (keycloak) on node 'prox4'***, –≤ —Å–µ—Ç–∏ `vmbr0` –∫–æ—Ç–æ—Ä—É—é —Ç—Ä–µ–±—É–µ—Ç—Å—è —Å–∫–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å;
- –º–∞—à–∏–Ω–∞ ***Container 272 (keycloack) on node 'prox4'***, –≤ —Å–µ—Ç–∏ `dmznet`, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–∞ –ø–æ—Å–ª–µ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è;
- –ø—Ä–æ—Å–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏ –ø–æ–º–æ—â–∏ —É—Ç–∏–ª–∏—Ç—ã *nmap* —Å–µ—Ç—å 192.168.45.0/24 –∏ –≤—ã—è—Å–Ω–∏—Ç—å —Å–≤–æ–±–æ–¥–Ω—ã–µ IP –∞–¥—Ä–µ—Å–∞;
- –¥–æ–±–∞–≤–∏—Ç—å –≤ ***Container 272*** –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å **eth1**, —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π `192.168.45.50/24` (—à–ª—é–∑: `192.168.45.1`); ‚úÖ

<details>
<summary>‚ùó root@keycloack - –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å ‚ùó</summary>

```bash
root@keycloack ~ # ipc
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host noprefixroute 
       valid_lft forever preferred_lft forever
2: eth0@if161: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1450 qdisc noqueue state UP group default qlen 1000
    link/ether bc:24:11:38:6d:a4 brd ff:ff:ff:ff:ff:ff link-netnsid 0
    inet 192.168.46.16/24 brd 192.168.46.255 scope global eth0
       valid_lft forever preferred_lft forever
    inet6 fe80::be24:11ff:fe38:6da4/64 scope link 
       valid_lft forever preferred_lft forever
3: eth1@if165: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1450 qdisc noqueue state UP group default qlen 1000
    link/ether bc:24:11:de:5b:0c brd ff:ff:ff:ff:ff:ff link-netnsid 0
    inet 192.168.45.50/24 brd 192.168.45.255 scope global eth1
       valid_lft forever preferred_lft forever
    inet6 fe80::be24:11ff:fede:5b0c/64 scope link 
       valid_lft forever preferred_lft forever
```
</details> 
<br/>


## üî∑ 2. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ —Å–æ–∑–¥–∞–Ω–∏—é –¥–∞–º–ø–∞ –ë–î PostgreSQL.

### 1.–î–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º—ã —Å –ª–æ–∫–∞–ª—è–º–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
```bash
sudo localedef -i ru_RU -f UTF-8 ru_RU.UTF-8
export LANG=ru_RU.UTF-8
```
### 2.–î–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PostgreSQL —Ç—Ä–µ–±—É–µ—Ç—Å—è.
—Å–º.: [–®–ø–∞—Ä–≥–∞–ª–∫–∞ –ø–æ –æ—Å–Ω–æ–≤–Ω—ã–º –∫–æ–º–∞–Ω–¥–∞–º PostgreSQL](https://www.oslogic.ru/knowledge/598/shpargalka-po-osnovnym-komandam-postgresql/)

  - –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –ø–æ–¥ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º:
     ```bash
     cd /tmp
       sudo -u postgres psql
     ```

  - Ad-Hoc –∫–æ–º–∞–Ω–¥—ã:
     ```bash
     sudo -u postgres psql -c "\du"   # —Å–º. —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
     sudo -u postgres psql -c "\dp"   # —Å–º. (–∏–ª–∏ \z) ‚Äì —Å–ø–∏—Å–æ–∫ —Ç–∞–±–ª–∏—Ü, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π, –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–µ–π, –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –∫ –Ω–∏–º
     sudo -u postgres psql -c "\di"   # —Å–º. –∏–Ω–¥–µ–∫—Å—ã
     sudo -u postgres psql -c "\dt+"   # —Å–º. —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º
     sudo -u postgres psql -c "\d ‚Äútable_name‚Äù"   # —Å–º. –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã
     ```
     ```bash
                                               –°–ø–∏—Å–æ–∫ —Ä–æ–ª–µ–π
      –ò–º—è —Ä–æ–ª–∏ |                                –ê—Ç—Ä–∏–±—É—Ç—ã                                 | –ß–ª–µ–Ω —Ä–æ–ª–µ–π 
     ----------+-------------------------------------------------------------------------+------------
      keycloak |                                                                         | {}
      postgres | –°—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –°–æ–∑–¥–∞—ë—Ç —Ä–æ–ª–∏, –°–æ–∑–¥–∞—ë—Ç –ë–î, –†–µ–ø–ª–∏–∫–∞—Ü–∏—è, –ü—Ä–æ–ø—É—Å–∫–∞—Ç—å RLS | {}
     ```
<br/>



## üî∑ 3. –ê–Ω–∞–ª–∏–∑ –≤—ã–≤–æ–¥–∞ "\du".

1. **postgres** ‚Äî —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å –ø–æ–ª–Ω—ã–º–∏ –ø—Ä–∞–≤–∞–º–∏ (–º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –ë–î, —Ä–æ–ª–∏ –∏ —É–ø—Ä–∞–≤–ª—è—Ç—å —Å–µ—Ä–≤–µ—Ä–æ–º).  
2. **keycloak** ‚Äî –æ–±—ã—á–Ω–∞—è —Ä–æ–ª—å –±–µ–∑ –æ—Å–æ–±—ã—Ö –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –Ω–µ –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –ë–î –∏–ª–∏ –¥—Ä—É–≥–∏–µ —Ä–æ–ª–∏).

### –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –¥–∞—Ç—å –ø—Ä–∞–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é `keycloak`
–°–µ–π—á–∞—Å `keycloak` –∏–º–µ–µ—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞. –ï—Å–ª–∏ Keycloak —Ç—Ä–µ–±—É–µ—Ç –¥–æ—Å—Ç—É–ø –∫ —Å–≤–æ–µ–π –ë–î, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

#### 1. –°–æ–∑–¥–∞–π—Ç–µ –ë–î –¥–ª—è Keycloak (–µ—Å–ª–∏ –µ—â—ë –Ω–µ —Å–æ–∑–¥–∞–Ω–∞):
```bash
sudo -u postgres psql -c "CREATE DATABASE keycloak_db;"
```

#### 2. –î–∞–π—Ç–µ –ø—Ä–∞–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é `keycloak` –Ω–∞ —ç—Ç—É –ë–î:
```bash
sudo -u postgres psql -c "GRANT ALL PRIVILEGES ON DATABASE keycloak_db TO keycloak;"
```

#### 3. (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –ï—Å–ª–∏ Keycloak —Ç—Ä–µ–±—É–µ—Ç –ø—Ä–∞–≤–∞ –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ —Å—Ö–µ–º –∏ —Ç–∞–±–ª–∏—Ü:
```bash
sudo -u postgres psql -c "ALTER ROLE keycloak WITH CREATEDB CREATEROLE;"
```
*(–ë—É–¥—å—Ç–µ –æ—Å—Ç–æ—Ä–æ–∂–Ω—ã —Å `CREATEROLE` ‚Äî —ç—Ç–æ –¥–∞—ë—Ç –ø—Ä–∞–≤–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π!)*

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤:
```bash
sudo -u postgres psql -c "\l"  # –°–ø–∏—Å–æ–∫ –ë–î –∏ –∏—Ö –≤–ª–∞–¥–µ–ª—å—Ü–µ–≤
sudo -u postgres psql -c "\du keycloak"  # –î–µ—Ç–∞–ª–∏ —Ä–æ–ª–∏ keycloak
```
<br/>



## üî∑ 4. –°–æ–∑–¥–∞–Ω–∏–µ –¥–∞–º–ø–∞ –ë–î PostgreSQL.

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –¥–∞–º–ø–∞ –¥–ª—è –ë–î `keycloak`.
```bash
sudo -u keycloak psql -c "\du" ;
sudo -u postgres pg_dump -Fc -d keycloak -f /tmp/keycloak_db.dump
```
*–ì–¥–µ*:
- `-Fc` ‚Äì —Ñ–æ—Ä–º–∞—Ç "custom" (—Å–∂–∞—Ç—ã–π, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤).
- `-d keycloak` ‚Äì –∏–º—è –ë–î –¥–ª—è —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏—è.
- `-f /tmp/keycloak_db.dump` ‚Äì –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É –¥–∞–º–ø–∞.

#### –°–∂–∞—Ç–∏–µ –¥–∞–º–ø–∞ (gzip):
```bash
# –£–ø–∞–∫–æ–≤–∫–∞
sudo -u postgres pg_dump -Fc -d keycloak | gzip > /tmp/keycloak_db.dump.gz

# –†–∞—Å–ø–∞–∫–æ–≤–∫–∞
gunzip /tmp/keycloak_db.dump.gz
```

#### –î–∞–º–ø –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã:
```bash
sudo -u postgres pg_dump -t public.users -d keycloak -f /tmp/users_table.sql
```

#### –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–º–ø–æ–≤.
- /tmp/ ‚Äì –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ (—Ñ–∞–π–ª—ã —É–¥–∞–ª—è—é—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ).
- /var/backups/postgresql/ ‚Äì —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è –±—ç–∫–∞–ø–æ–≤ (—Å–æ–∑–¥–∞–π—Ç–µ –µ—ë, –µ—Å–ª–∏ –Ω–µ—Ç):
```bash
mkdir -p /var/backups/postgresql/
chown postgres:postgres /var/backups/postgresql/
```

#### –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –¥–∞–º–ø–æ–≤.
–î–æ–±–∞–≤–∏—Ç—å –≤ `/etc/crontab`:
```bash
0 3 * * * postgres pg_dump -Fc -d keycloak_db -f /var/backups/postgresql/keycloak_$(date +\%Y-\%m-\%d).dump
```
```bash
echo "0 3 * * * postgres pg_dumpall --clean --if-exists -f /var/backups/postgresql/full_$(date +\%Y-\%m-\%d).sql" | sudo tee -a /etc/crontab
```

—Ç.–µ. –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å—Å—è –¥–∞–º–ø –∫–∞–∂–¥—É—é –Ω–æ—á—å –≤ 3:00.




### 2. –°–æ–∑–¥–∞–Ω–∏–µ –¥–∞–º–ø–∞ –≤—Å–µ—Ö –ë–î –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ.
  ```bash
  sudo -u postgres pg_dumpall -f /tmp/full_postgres_backup.sql
  sudo -u postgres pg_dumpall --clean --if-exists -f /tmp/full_postgres_backup.sql
  ```
  ```bash
  root@keycloack /tmp # ll /tmp/keycloak_db.dump ; ll /tmp/full_postgres_backup.sql 
  -rw-r--r-- 1 postgres postgres 0 –∏—é–ª 24 12:07 /tmp/keycloak_db.dump
  -rw-r--r-- 1 postgres postgres 3039 –∏—é–ª 24 12:12 /tmp/full_postgres_backup.sql
  # –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –¥–∞–º–ø–∞
  head -n 20 /tmp/full_postgres_backup.sql
  ```


### 3.1 –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –¥–º–∞–ø–∞ (–Ω–∞ –Ω–æ–¥–µ).

***–î–ª—è –¥–∞–º–ø–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ -Fc***:
```bash
sudo -u postgres pg_restore -d <new_db_name> /tmp/keycloak_db.dump
## ------------------

# –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ –º–∞—Å—Ç–µ—Ä-–Ω–æ–¥–µ –∏ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º
ssh root@192.168.45.202

# –°–æ–∑–¥–∞–µ–º –ë–î (–µ—Å–ª–∏ –µ—â–µ –Ω–µ —Å–æ–∑–¥–∞–Ω–∞)
sudo -u postgres psql -c "CREATE DATABASE keycloak;"

# –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–º–ø
sudo -u postgres psql -d keycloak -f /tmp/keycloak_db.dump
```

***–î–ª—è –æ–±—ã—á–Ω–æ–≥–æ SQL-–¥–∞–º–ø–∞***:
```bash
sudo -u postgres psql -d new_db_name -f /tmp/backup.sql
```

***–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª–Ω–æ–≥–æ –¥–∞–º–ø–∞***:
```bash
sudo -u postgres psql -f /tmp/full_postgres_backup.sql
```

***–î–∞–º–ø —Ç–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –ë–î (–∏—Å–∫–ª—é—á–∞—è —Å–∏—Å—Ç–µ–º–Ω—ã–µ)***:
```bash
sudo -u postgres psql -c "SELECT datname FROM pg_database WHERE datname NOT LIKE 'template%' AND datname != 'postgres';" | tail -n +3 | head -n -2 | while read db; do
    sudo -u postgres pg_dump -Fc "$db" -f "/tmp/${db}.dump"
done
```

***–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –î–∞–º–ø–∞***:
```bash
scp /tmp/full_postgres_backup.sql user@backup-server:/path/to/backups/
scp full_postgres_backup.sql keycloak_db.dump root@192.168.45.{201,202,204}:/var/backups/postgresql/
```



### 3.1 –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –¥–º–∞–ø–∞ (—Å –Ω–æ—É—Ç–∞).
–ù–∞ –º–∞—à–∏–Ω–µ `192.168.45.50/24` —Å–¥–µ–ª–∞–Ω –¥–∞–º–ø keycloak_db.dump c postgres –ë–î –ø–æ–¥ –Ω–∞–∑–≤–∞–Ω–∏–µ–º keycloak –∏ –ø–µ—Ä–∫–∏–Ω—É—Ç –Ω–∞ –Ω–æ—É—Ç `192.168.87.74`; —Ç–µ–ø–µ—Ä—å —Å –Ω–æ—É—Ç–∞ –Ω—É–∂–Ω–æ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å –ø–æ–ª—É—á–µ–Ω–Ω—ã–π –¥–∞–º–ø **keycloak_db.dump** –Ω–∞ pg* –º–∞—à–∏–Ω–∞—Ö.

–ï—Å–ª–∏ HAProxy –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å PostgreSQL, –º–æ–∂–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–∞–ø—Ä—è–º—É—é:
```bash
# –° –Ω–æ—É—Ç–±—É–∫–∞ (192.168.87.74)
psql -h 192.168.45.1 -p 5000 -U postgres -c "CREATE DATABASE keycloak;"
psql -h 192.168.45.1 -p 5000 -U postgres -d keycloak -f keycloak_db.dump
#-----
psql -h 192.168.45.202 -p 7000 -U postgres -c "CREATE DATABASE keycloak;"
psql -h 192.168.45.202 -p 7000 -U postgres -d keycloak -f keycloak_db.dump
#-----
psql -h 192.168.45.201 -p 5432 -U postgres -c "CREATE DATABASE keycloak;"  # –ø–∞—Ä–æ–ª—å —Å–º–æ—Ç—Ä–∏ –≤ /etc/patroni.yml
```

–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è:
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ HAProxy
psql -h 192.168.45.1 -p 5000 -U postgres -c "\l"
psql -h 192.168.45.1 -p 5000 -U postgres -d keycloak -c "\dt"

# –ò–ª–∏ –Ω–∞–ø—Ä—è–º—É—é –∫ –ª–∏–¥–µ—Ä—É
ssh root@192.168.45.202
sudo -u postgres psql -d keycloak -c "SELECT count(*) FROM pg_tables"
```

–ü–æ—Å–ª–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å –∫–ª–∞—Å—Ç–µ—Ä–∞:
```
patronictl -c /etc/patroni.yml list
```

<br/>

----------------------------------------------------------------------
### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–∞—Ä–æ–ª—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è **postgres** –≤ PostgreSQL

#### 1. **–í–æ–π–¥–∏—Ç–µ –≤ –∫–æ–Ω—Å–æ–ª—å PostgreSQL –æ—Ç –∏–º–µ–Ω–∏ —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**:
```bash
sudo -u postgres psql
```
*(–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –æ—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞, —Å–Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ `cd /tmp`)*

#### 2. **–í –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–π –∫–æ–Ω—Å–æ–ª–∏ PostgreSQL –≤—ã–ø–æ–ª–Ω–∏—Ç–µ**:
```sql
ALTER ROLE postgres WITH PASSWORD '–≤–∞—à_–ø–∞—Ä–æ–ª—å';
```
–ó–∞–º–µ–Ω–∏—Ç–µ `–≤–∞—à_–ø–∞—Ä–æ–ª—å` –Ω–∞ –Ω–∞–¥–µ–∂–Ω—ã–π –ø–∞—Ä–æ–ª—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, `Str0ngP@ssw0rd!`).

#### 3. **–í—ã–π–¥–∏—Ç–µ –∏–∑ –∫–æ–Ω—Å–æ–ª–∏**:
```sql
\q
```

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–µ—Å–ª–∏ PostgreSQL –Ω–µ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –ø–∞—Ä–æ–ª—å)

#### 1. **–ò–∑–º–µ–Ω–∏—Ç–µ –º–µ—Ç–æ–¥ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –≤ `pg_hba.conf`**:
–û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:
```bash
sudo nano /etc/postgresql/15/main/pg_hba.conf
```
*(–ü—É—Ç—å –º–æ–∂–µ—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤–µ—Ä—Å–∏–∏ PostgreSQL –∏ –û–°. –ê–∫—Ç—É–∞–ª—å–Ω—É—é –≤–µ—Ä—Å–∏—é –º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–º–∞–Ω–¥–æ–π `ls /etc/postgresql/`)*

–ù–∞–π–¥–∏—Ç–µ —Å—Ç—Ä–æ–∫—É:
```
local   all             postgres                                peer
```
–ò –∑–∞–º–µ–Ω–∏—Ç–µ `peer` –Ω–∞ `md5` –∏–ª–∏ `scram-sha-256`:
```
local   all             postgres                                md5
```

#### 2. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ PostgreSQL**:
```bash
sudo systemctl restart postgresql
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–æ–ª—è
–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è —Å –ø–∞—Ä–æ–ª–µ–º:
```bash
psql -U postgres -h localhost -W
```
*(–°–∏—Å—Ç–µ–º–∞ –∑–∞–ø—Ä–æ—Å–∏—Ç –ø–∞—Ä–æ–ª—å. –í–≤–µ–¥–∏—Ç–µ —Ç–æ—Ç, —á—Ç–æ –∑–∞–¥–∞–ª–∏ —á–µ—Ä–µ–∑ `ALTER ROLE`)*


### –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è:
1. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø–∞—Ä–æ–ª—è**:
   - –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–æ—Å—Ç—ã–µ –ø–∞—Ä–æ–ª–∏ –≤—Ä–æ–¥–µ `12345`.
   - –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è: –±—É–∫–≤—ã (–≤–µ—Ä—Ö–Ω–∏–π/–Ω–∏–∂–Ω–∏–π —Ä–µ–≥–∏—Å—Ç—Ä), —Ü–∏—Ñ—Ä—ã, —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª—ã (`!@#$%^&*`).

2. **–ï—Å–ª–∏ –∑–∞–±—ã–ª–∏ –ø–∞—Ä–æ–ª—å**:
   - –°–±—Ä–æ—Å–∏—Ç—å –µ–≥–æ –º–æ–∂–Ω–æ —á–µ—Ä–µ–∑ `ALTER ROLE` (–∫–∞–∫ –ø–æ–∫–∞–∑–∞–Ω–æ –≤—ã—à–µ), –Ω–æ –¥–ª—è —ç—Ç–æ–≥–æ –Ω—É–∂–µ–Ω –¥–æ—Å—Ç—É–ø –∫ `sudo`.

3. **–î–ª—è Keycloak**:
   –ï—Å–ª–∏ Keycloak –∏—Å–ø–æ–ª—å–∑—É–µ—Ç PostgreSQL, –∑–∞–¥–∞–π—Ç–µ –ø–∞—Ä–æ–ª—å –∏ –¥–ª—è –µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
   ```sql
   ALTER ROLE keycloak WITH PASSWORD '–ø–∞—Ä–æ–ª—å_–¥–ª—è_keycloak';
   ```

4. **–õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è**:
   –ï—Å–ª–∏ —Å–Ω–æ–≤–∞ –ø–æ—è–≤–ª—è—é—Ç—Å—è –æ—à–∏–±–∫–∏ –ª–æ–∫–∞–ª–∏ (`perl: warning`), –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
   ```bash
   sudo dpkg-reconfigure locales
   ```
   –ò –≤—ã–±–µ—Ä–∏—Ç–µ `ru_RU.UTF-8`.

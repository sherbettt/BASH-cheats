–ü—Ä–∏–º–µ—Ä –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏:
<br/> [17.2. iptables.md](https://github.com/sherbettt/BASH-cheats/blob/main/17.2.%20iptables.md)
<br/> [System engineering/03. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ NAT –Ω–∞ —Ä–æ—É—Ç–µ—Ä–µ —Å Ubuntu.md](https://github.com/sherbettt/BASH-cheats/blob/main/System%20engineering/03.%20–ù–∞—Å—Ç—Ä–æ–π–∫–∞%20NAT%20–Ω–∞%20—Ä–æ—É—Ç–µ—Ä–µ%20—Å%20Ubuntu.md)

## –ú–∞—Ä—à—Ä—É—Ç—ã –æ—Ç pgnet –¥–æ –Ω–æ–¥ (–Ω–∞ PMX5).

–î–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ —Å–≤—è–∑–∏ –º–µ–∂–¥—É –º–∞—à–∏–Ω–∞–º–∏ –≤ —Ä–∞–∑–Ω—ã—Ö –ø–æ–¥—Å–µ—Ç—è—Ö (192.168.87.0/24 –∏ 192.168.45.0/24) –≤–∞–º –Ω—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é –∏ –ø—Ä–∞–≤–∏–ª–∞ iptables.

### 1. üü¢ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ –Ω–∞ Proxmox (192.168.87.20):

Proxmox –¥–æ–ª–∂–µ–Ω –≤—ã—Å—Ç—É–ø–∞—Ç—å –≤ –∫–∞—á–µ—Å—Ç–≤–µ —à–ª—é–∑–∞ –¥–ª—è –ø–æ–¥—Å–µ—Ç–∏ 192.168.45.0/24.

```bash
# –î–æ–±–∞–≤–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç (–≤—Ä–µ–º–µ–Ω–Ω–æ)
ip route add 192.168.45.0/24 dev pgnet

# –î–ª—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è (Debian-–ø–æ–¥–æ–±–Ω—ã—Ö —Å–∏—Å—Ç–µ–º—ã):
echo "192.168.45.0/24 dev pgnet" >> /etc/network/interfaces.d/pgnet
```
- **`ip route add`** ‚Äì –¥–æ–±–∞–≤–ª—è–µ—Ç –Ω–æ–≤—ã–π –º–∞—Ä—à—Ä—É—Ç –≤ —Ç–∞–±–ª–∏—Ü—É –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏.
- **`192.168.45.0/24`** ‚Äì —É–∫–∞–∑—ã–≤–∞–µ—Ç —Ü–µ–ª–µ–≤—É—é –ø–æ–¥—Å–µ—Ç—å, –¥–ª—è –∫–æ—Ç–æ—Ä–æ–π –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –º–∞—Ä—à—Ä—É—Ç (–≤—Å–µ IP-–∞–¥—Ä–µ—Å–∞ –æ—Ç `192.168.45.1` –¥–æ `192.168.45.254`).
- **`dev pgnet`** ‚Äì —É–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ —Ç—Ä–∞—Ñ–∏–∫ –¥–ª—è —ç—Ç–æ–π –ø–æ–¥—Å–µ—Ç–∏ –¥–æ–ª–∂–µ–Ω –Ω–∞–ø—Ä–∞–≤–ª—è—Ç—å—Å—è —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `pgnet` (—ç—Ç–æ –∏–º—è —Å–µ—Ç–µ–≤–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –≤ Proxmox).

- **–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å `pgnet`** ‚Äì —ç—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ –∏–º—è, –∫–æ—Ç–æ—Ä–æ–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∑–∞—Ä–∞–Ω–µ–µ —Å–æ–∑–¥–∞–Ω–æ –≤ Proxmox (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ `/etc/network/interfaces`). –û–Ω–æ –º–æ–∂–µ—Ç –±—ã—Ç—å bridge, VLAN –∏–ª–∏ –¥—Ä—É–≥–∏–º —Ç–∏–ø–æ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞.
- **–ü–æ—Å—Ç–æ—è–Ω–Ω–æ—Å—Ç—å** ‚Äì —Ç–∞–∫–∞—è –∫–æ–º–∞–Ω–¥–∞ –¥–æ–±–∞–≤–ª—è–µ—Ç –º–∞—Ä—à—Ä—É—Ç –≤—Ä–µ–º–µ–Ω–Ω–æ (–¥–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏). –î–ª—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω—É–∂–Ω–æ –ø—Ä–æ–ø–∏—Å–∞—Ç—å –º–∞—Ä—à—Ä—É—Ç –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å–µ—Ç–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ —Ñ–∞–π–ª–µ `/etc/network/interfaces` –∏–ª–∏ —á–µ—Ä–µ–∑ `/etc/rc.local`).


### 2. üü¢ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ iptables –Ω–∞ Proxmox –¥–ª—è NAT (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ):

–ï—Å–ª–∏ –≤–∞–º –Ω—É–∂–µ–Ω –¥–æ—Å—Ç—É–ø –∏–∑ 192.168.87.0/24 –≤ 192.168.45.0/24, –≤–∫–ª—é—á–∏—Ç–µ —Ñ–æ—Ä–≤–∞—Ä–¥–∏–Ω–≥ –∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ NAT. –≠—Ç–∞ —á–∞—Å—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç **NAT (–º–∞—Å–∫–∞—Ä–∞–¥–∏–Ω–≥)** –∏ **–ø—Ä–∞–≤–∏–ª–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —Ç—Ä–∞—Ñ–∏–∫–∞** –º–µ–∂–¥—É –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞–º–∏ `pgnet` –∏ `vmbr0` –≤ Proxmox —Å –ø–æ–º–æ—â—å—é `iptables`. 

```bash
# –í–∫–ª—é—á–∏—Ç—å IP forwarding
echo 1 > /proc/sys/net/ipv4/ip_forward

# –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∞–≤–∏–ª–∞ iptables
iptables -t nat -A POSTROUTING -s 192.168.45.0/24 -o vmbr0 -j MASQUERADE
iptables -A FORWARD -i pgnet -o vmbr0 -j ACCEPT
iptables -A FORWARD -i vmbr0 -o pgnet -m state --state RELATED,ESTABLISHED -j ACCEPT

# –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–∞–≤–∏–ª–∞ (–¥–ª—è based)
apt install iptables-persistent
netfilter-persistent save
```

#### 1. üî∑ **–í–∫–ª—é—á–µ–Ω–∏–µ NAT (–º–∞—Å–∫–∞—Ä–∞–¥–∏–Ω–≥–∞) –¥–ª—è –≤—ã—Ö–æ–¥–∞ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç**
```bash
iptables -t nat -A POSTROUTING -s 192.168.45.0/24 -o vmbr0 -j MASQUERADE
```
- **`-t nat`** ‚Äì —Ä–∞–±–æ—Ç–∞–µ–º —Å —Ç–∞–±–ª–∏—Ü–µ–π NAT (–ø–æ–¥–º–µ–Ω–∞ –∞–¥—Ä–µ—Å–æ–≤).  
- **`-A POSTROUTING`** ‚Äì –¥–æ–±–∞–≤–ª—è–µ–º –ø—Ä–∞–≤–∏–ª–æ –≤ —Ü–µ–ø–æ—á–∫—É `POSTROUTING` (–ø—Ä–∞–≤–∏–ª–∞ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è **–ø–æ—Å–ª–µ** –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ –ø–∞–∫–µ—Ç–∞).  
- **`-s 192.168.45.0/24`** ‚Äì –ø—Ä–∞–≤–∏–ª–æ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫ —Ç—Ä–∞—Ñ–∏–∫—É **–∏–∑ –ø–æ–¥—Å–µ—Ç–∏** `192.168.45.0/24` (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –º–∞—à–∏–Ω—ã –∏–ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã).  
- **`-o vmbr0`** ‚Äì —Ç—Ä–∞—Ñ–∏–∫, –≤—ã—Ö–æ–¥—è—â–∏–π —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `vmbr0` (–æ–±—ã—á–Ω–æ —ç—Ç–æ –æ—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å –≤—ã—Ö–æ–¥–æ–º –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç).  
- **`-j MASQUERADE`** ‚Äì –ø–æ–¥–º–µ–Ω–∞ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ IP-–∞–¥—Ä–µ—Å–∞ –Ω–∞ –∞–¥—Ä–µ—Å —Ö–æ—Å—Ç–∞ Proxmox (—á—Ç–æ–±—ã –æ—Ç–≤–µ—Ç—ã –ø—Ä–∏—Ö–æ–¥–∏–ª–∏ –æ–±—Ä–∞—Ç–Ω–æ).  

**‚Üí –ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ?**  
–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –í–ú/–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –≤ –ø–æ–¥—Å–µ—Ç–∏ `192.168.45.0/24`, —Ç–æ –±–µ–∑ NAT –æ–Ω–∏ –Ω–µ —Å–º–æ–≥—É—Ç –≤—ã—Ö–æ–¥–∏—Ç—å –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç. –≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ –¥–µ–ª–∞–µ—Ç —Ç–∞–∫, —á—Ç–æ –≤–µ—Å—å –∏—Ö —Ç—Ä–∞—Ñ–∏–∫ "–º–∞—Å–∫–∏—Ä—É–µ—Ç—Å—è" –ø–æ–¥ IP-–∞–¥—Ä–µ—Å Proxmox (`vmbr0`).  


#### 2. üî∑ **–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ —Ñ–æ—Ä–≤–∞—Ä–¥–∏–Ω–≥–∞ (–ø—Ä–æ–±—Ä–æ—Å–∞ —Ç—Ä–∞—Ñ–∏–∫–∞) –∏–∑ `pgnet` –≤ `vmbr0`**

**‚Üí –ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ?**  
–ë–µ–∑ —ç—Ç–æ–≥–æ –ø—Ä–∞–≤–∏–ª–∞ –ø–∞–∫–µ—Ç—ã –∏–∑ `pgnet` –Ω–µ —Å–º–æ–≥—É—Ç –ø–æ–ø–∞—Å—Ç—å –≤ `vmbr0` (–∏ –¥–∞–ª—å—à–µ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç), –¥–∞–∂–µ –µ—Å–ª–∏ NAT –Ω–∞—Å—Ç—Ä–æ–µ–Ω. 

```bash
iptables -A FORWARD -i pgnet -o vmbr0 -j ACCEPT
```
- **`-A FORWARD`** ‚Äì –¥–æ–±–∞–≤–ª—è–µ–º –ø—Ä–∞–≤–∏–ª–æ –≤ —Ü–µ–ø–æ—á–∫—É `FORWARD` (–æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –ø–µ—Ä–µ–¥–∞—á—É —Ç—Ä–∞—Ñ–∏–∫–∞ –º–µ–∂–¥—É –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞–º–∏).  
- **`-i pgnet`** ‚Äì –≤—Ö–æ–¥—è—â–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `pgnet` (–æ—Ç–∫—É–¥–∞ –∏–¥—ë—Ç —Ç—Ä–∞—Ñ–∏–∫).  
- **`-o vmbr0`** ‚Äì –∏—Å—Ö–æ–¥—è—â–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `vmbr0` (–∫—É–¥–∞ –Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Ç—Ä–∞—Ñ–∏–∫).  
- **`-j ACCEPT`** ‚Äì —Ä–∞–∑—Ä–µ—à–∏—Ç—å —Ç–∞–∫–æ–π —Ç—Ä–∞—Ñ–∏–∫.  

 

#### 3. üî∑ **–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç–Ω–æ–≥–æ —Ç—Ä–∞—Ñ–∏–∫–∞ –∏–∑ `vmbr0` –≤ `pgnet`**
```bash
iptables -A FORWARD -i vmbr0 -o pgnet -m state --state RELATED,ESTABLISHED -j ACCEPT
```
- **`-i vmbr0`** ‚Äì –≤—Ö–æ–¥—è—â–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `vmbr0` (–æ—Ç–≤–µ—Ç—ã –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞).  
- **`-o pgnet`** ‚Äì –∏—Å—Ö–æ–¥—è—â–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `pgnet` (–Ω–∞–∑–∞–¥ –∫ –í–ú/–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º).  
- **`-m state --state RELATED,ESTABLISHED`** ‚Äì —Ä–∞–∑—Ä–µ—à–∞—Ç—å **—Ç–æ–ª—å–∫–æ** —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –æ—Ç–≤–µ—Ç—ã –Ω–∞ –∑–∞–ø—Ä–æ—Å—ã –∏–∑ `pgnet`).  
- **`-j ACCEPT`** ‚Äì —Ä–∞–∑—Ä–µ—à–∏—Ç—å —Ç–∞–∫–æ–π —Ç—Ä–∞—Ñ–∏–∫.  

**‚Üí –ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ?**  
–ë–µ–∑ —ç—Ç–æ–≥–æ –ø—Ä–∞–≤–∏–ª–∞ –æ—Ç–≤–µ—Ç—ã –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–∞ –∑–∞–ø—Ä–æ—Å—ã –æ—Ç –í–ú) –Ω–µ —Å–º–æ–≥—É—Ç –≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ –ø–æ–¥—Å–µ—Ç—å `pgnet`.  



#### 4. üî∑ **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª iptables**
```bash
apt install iptables-persistent
netfilter-persistent save
```
- **`iptables-persistent`** ‚Äì –ø–∞–∫–µ—Ç –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª iptables –º–µ–∂–¥—É –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞–º–∏.  
- **`netfilter-persistent save`** ‚Äì —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ç–µ–∫—É—â–∏–µ –ø—Ä–∞–≤–∏–ª–∞ –≤ —Ñ–∞–π–ª—ã `/etc/iptables/rules.v4` (IPv4) –∏ `/etc/iptables/rules.v6` (IPv6).  

**‚Üí –í–∞–∂–Ω–æ!**  
–ë–µ–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª–∞ —Å–±—Ä–æ—Å—è—Ç—Å—è –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏.  



### 3. üü¢ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã (192.168.45.201):

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É VM –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —à–ª—é–∑:
```bash
ip route show
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å —á—Ç–æ-—Ç–æ –≤—Ä–æ–¥–µ:
# default via 192.168.45.1 dev eth0
# 192.168.45.0/24 dev eth0 proto kernel scope link src 192.168.45.201
```

### 4. üü¢ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤—è–∑–∏:

–° pmx5 –ø–æ–ø—Ä–æ–±—É–π—Ç–µ:
```bash
ping 192.168.45.201
```


#### –ò—Ç–æ–≥–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã:
1. –í–ú –≤ `192.168.45.0/24` –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç ‚Üí —Ç—Ä–∞—Ñ–∏–∫ –∏–¥—ë—Ç —á–µ—Ä–µ–∑ `pgnet`.  
2. –ü—Ä–∞–≤–∏–ª–æ `FORWARD` —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –ø–µ—Ä–µ–¥–∞—á—É –∏–∑ `pgnet` –≤ `vmbr0`.  
3. NAT (`MASQUERADE`) –ø–æ–¥–º–µ–Ω—è–µ—Ç –∏—Å—Ö–æ–¥–Ω—ã–π IP –Ω–∞ –∞–¥—Ä–µ—Å Proxmox.  
4. –û—Ç–≤–µ—Ç –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –Ω–∞ `vmbr0`.  
5. –ü—Ä–∞–≤–∏–ª–æ `FORWARD` –¥–ª—è `ESTABLISHED` –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç –µ–≥–æ –æ–±—Ä–∞—Ç–Ω–æ –≤ `pgnet`.  

---------------------

## –ú–∞—Ä—à—Ä—É—Ç—ã –æ—Ç pgnet –¥–æ –Ω–æ–¥ (–Ω–∞ –Ω–æ—É—Ç–µ Ximper Linux).

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–∏—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤ –Ω–∞ –Ω–æ—É—Ç–µ
```bash
ip route show
```
–í—ã–≤–æ–¥ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π:
```
default via 192.168.87.1 dev wlp1s0 proto dhcp src 192.168.87.135 metric 600 
192.168.87.0/24 dev wlp1s0 proto kernel scope link src 192.168.87.135 metric 600 
192.168.45.0/24 via 192.168.87.20 dev wlp1s0
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ –º–∞—Ä—à—Ä—É—Ç–∞ –Ω–æ—É—Ç–µ (Ximper Linux)

#### –í–∞—Ä–∏–∞–Ω—Ç A: –ß–µ—Ä–µ–∑ NetworkManager (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
```bash
# –£–∑–Ω–∞—ë–º –∏–º—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:
nmcli connection show

# –î–æ–±–∞–≤–ª—è–µ–º –º–∞—Ä—à—Ä—É—Ç (–ø—Ä–∏–º–µ—Ä –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è 'Wired connection 1'):
sudo nmcli connection modify "Wired connection 1" ipv4.routes "192.168.45.0/24 192.168.87.20"

# –ü—Ä–∏–º–µ–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è:
sudo nmcli connection down "Wired connection 1" && sudo nmcli connection up "Wired connection 1"
```

#### –í–∞—Ä–∏–∞–Ω—Ç B: –ß–µ—Ä–µ–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã (–µ—Å–ª–∏ NetworkManager –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
–°–æ–∑–¥–∞—ë–º —Ñ–∞–π–ª –º–∞—Ä—à—Ä—É—Ç–æ–≤:
```bash
sudo nano /etc/sysconfig/network-scripts/route-wlp1s0
```
–î–æ–±–∞–≤–ª—è–µ–º —Å—Ç—Ä–æ–∫—É:
```
192.168.45.0/24 via 192.168.87.20 dev wlp1s0
```

–ò–ª–∏ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ (–¥–ª—è systemd-networkd):
```bash
sudo mkdir -p /etc/systemd/network
sudo nano /etc/systemd/network/50-wireless.network
```
–î–æ–±–∞–≤—å—Ç–µ –≤ —Å–µ–∫—Ü–∏—é `[Route]`:
```
[Route]
Destination=192.168.45.0/24
Gateway=192.168.87.20
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤—è–∑–∏
```bash
ping 192.168.45.201 -c 4
traceroute 192.168.45.201
```

### 4. –ï—Å–ª–∏ ping –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç - –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:

–ù–∞ Proxmox –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–≤–∞—Ä–¥–∏–Ω–≥–∞:
sudo sysctl net.ipv4.ip_forward

# –í—Ä–µ–º–µ–Ω–Ω–æ–µ –≤–∫–ª—é—á–µ–Ω–∏–µ –µ—Å–ª–∏ –≤—ã–∫–ª—é—á–µ–Ω:
sudo sysctl -w net.ipv4.ip_forward=1

# –ü—Ä–æ–≤–µ—Ä–∫–∞ iptables:
sudo iptables -L -n -v
sudo iptables -t nat -L -n -v

# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª –µ—Å–ª–∏ –Ω—É–∂–Ω–æ:
sudo iptables -A FORWARD -i pgnet -o vmbr0 -j ACCEPT
sudo iptables -A FORWARD -i vmbr0 -o pgnet -m state --state RELATED,ESTABLISHED -j ACCEPT
sudo iptables -t nat -A POSTROUTING -o vmbr0 -j MASQUERADE
```

### 5. –î–ª—è –ø–æ–ª–Ω–æ–π –æ—á–∏—Å—Ç–∫–∏ –∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å–µ—Ç–∏:
```bash
sudo systemctl restart NetworkManager  # –∏–ª–∏ network.service
sudo ip route flush cache
```

–î–ª—è Ximper Linux —Ç–∞–∫–∂–µ –º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö —Å–µ—Ç–µ–≤—ã—Ö —É—Ç–∏–ª–∏—Ç:
```bash
cat /etc/ximper-release  # –∏–ª–∏ –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–π —Ñ–∞–π–ª –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç–æ—á–Ω–æ–π –≤–µ—Ä—Å–∏–∏
```
---------------------

## –ú–∞—Ä—à—Ä—É—Ç—ã –æ—Ç –Ω–æ–¥ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç —á–µ—Ä–µ–∑ pgnet.


1. **–®–ª—é–∑ `192.168.45.1` –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ NAT.**  
   - –í—ã –¥–æ–±–∞–≤–∏–ª–∏ IP `192.168.45.1/24` –Ω–∞ `pgnet`, –Ω–æ **–Ω–µ –ø—Ä–æ–≤–µ—Ä–∏–ª–∏, —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–∏ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è**.  
   - NAT (`MASQUERADE`) –Ω–∞—Å—Ç—Ä–æ–µ–Ω, –Ω–æ **—Ç—Ä–∞—Ñ–∏–∫ –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç** –º–µ–∂–¥—É `pgnet` –∏ `vmbr0`.  

2. **–ü—Ä–æ–±–ª–µ–º–∞ —Å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞–º–∏ Proxmox:**  
   - `pgnet` ‚Äî —ç—Ç–æ **L2-—Å–µ—Ç—å (VXLAN)**, –∞ –Ω–µ –æ–±—ã—á–Ω—ã–π L3-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å.  
   - NAT —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ç—Ä–∞—Ñ–∏–∫ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–æ—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ `vmbr0`.  

3. **–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**  
   - **–ù–µ—Ç –º–∞—Ä—à—Ä—É—Ç–∞** –æ—Ç `pgnet` –∫ `vmbr0`.  
   - **Firewall –±–ª–æ–∫–∏—Ä—É–µ—Ç** —Ç—Ä–∞—Ñ–∏–∫.  
   - **–ù–µ–≤–µ—Ä–Ω–∞—è –ø—Ä–∏–≤—è–∑–∫–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤** –≤ Proxmox.  



### üü¢ **–ß—Ç–æ–±—ã –∏—Å–ø—Ä–∞–≤–∏—Ç—å, –Ω–∞–¥–æ:**  

### üü¢ **1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é –Ω–∞ Proxmox**  
–í—ã–ø–æ–ª–Ω–∏—Ç–µ:  
```bash
ip route show
```  
–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –µ—Å—Ç—å –º–∞—Ä—à—Ä—É—Ç –¥–ª—è `192.168.45.0/24` —á–µ—Ä–µ–∑ `pgnet`.  

–ï—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç, –¥–æ–±–∞–≤—å—Ç–µ:  
```bash
ip route add 192.168.45.0/24 dev pgnet
```



### üü¢ **2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ `pgnet` —Å–≤—è–∑–∞–Ω —Å `vmbr0`**  
–í–∞—à `pgnet` ‚Äî —ç—Ç–æ **VXLAN-—Å–µ—Ç—å**, –∫–æ—Ç–æ—Ä–∞—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å–≤—è–∑–∞–Ω–∞ —Å `vmbr0`. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:  
```bash
bridge link show
```  
–ï—Å–ª–∏ `pgnet` –Ω–µ —Å–≤—è–∑–∞–Ω —Å `vmbr0`, –Ω—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ—Å—Ç.  



### üü¢ **3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å FORWARD –∏ NAT-–ø—Ä–∞–≤–∏–ª–∞**  
–í—ã –¥–æ–±–∞–≤–∏–ª–∏ –ø—Ä–∞–≤–∏–ª–∞, –Ω–æ –æ–Ω–∏ –º–æ–≥—É—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞—Ç—å —Å –¥—Ä—É–≥–∏–º–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:  
```bash
iptables -t nat -L -n -v
iptables -L FORWARD -n -v
```  
–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ:  
- –î–ª—è `pgnet ‚Üí vmbr0` –µ—Å—Ç—å `ACCEPT` –≤ `FORWARD`.  
- –í `nat` –µ—Å—Ç—å `MASQUERADE` –¥–ª—è `192.168.45.0/24`.  

–ï—Å–ª–∏ –ø—Ä–∞–≤–∏–ª –Ω–µ—Ç, –¥–æ–±–∞–≤—å—Ç–µ –∏—Ö —Å–Ω–æ–≤–∞:  
```bash
iptables -t nat -A POSTROUTING -s 192.168.45.0/24 -o vmbr0 -j MASQUERADE
iptables -A FORWARD -i pgnet -o vmbr0 -j ACCEPT
iptables -A FORWARD -i vmbr0 -o pgnet -m state --state RELATED,ESTABLISHED -j ACCEPT
```



### üü¢ **4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —à–ª—é–∑–∞ (`192.168.45.1`) —Å `pg3`**  
–ù–∞ `pg3` –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:  
```bash
ping 192.168.45.1
```  
–ï—Å–ª–∏ **–Ω–µ –ø–∏–Ω–≥—É–µ—Ç—Å—è**, –∑–Ω–∞—á–∏—Ç:  
- –õ–∏–±–æ `192.168.45.1` –Ω–µ –Ω–∞–∑–Ω–∞—á–µ–Ω –Ω–∞ `pgnet`.  
- –õ–∏–±–æ `pgnet` –Ω–µ —Å–≤—è–∑–∞–Ω —Å `pg3`.  

–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å IP –Ω–∞ `pgnet` —è–≤–Ω–æ:  
```bash
ip addr add 192.168.45.1/24 dev pgnet
```  
–ò –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–≤—è–∑—å —Å–Ω–æ–≤–∞.  



### üü¢ **5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å DNS (–µ—Å–ª–∏ ping 8.8.8.8 –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ ping 192.168.87.20 —Ä–∞–±–æ—Ç–∞–µ—Ç)**  
–ï—Å–ª–∏ `ping 8.8.8.8` –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ `ping 192.168.87.20` (Proxmox) —Ä–∞–±–æ—Ç–∞–µ—Ç, –∑–Ω–∞—á–∏—Ç:  
- **NAT –Ω–∞—Å—Ç—Ä–æ–µ–Ω, –Ω–æ DNS –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç.**  
- –ü–æ–ø—Ä–æ–±—É–π—Ç–µ:  
  ```bash
  curl -v http://google.com
  ```  
  –ï—Å–ª–∏ –≤—ã–¥–∞—ë—Ç –æ—à–∏–±–∫—É DNS, –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ `/etc/resolv.conf` –Ω–∞ `pg3`:  
  ```bash
  echo "nameserver 8.8.8.8" > /etc/resolv.conf
  ```  






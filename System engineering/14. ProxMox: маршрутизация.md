Пример маршрутизации.

Для организации связи между машинами в разных подсетях (192.168.87.0/24 и 192.168.45.0/24) вам нужно настроить маршрутизацию и, возможно, правила iptables. Вот пошаговое решение:

### 1. Настройка маршрутизации на Proxmox (192.168.87.20):

Proxmox должен выступать в качестве шлюза для подсети 192.168.45.0/24.

```bash
# Добавить маршрут (временно)
ip route add 192.168.45.0/24 dev pgnet

# Для постоянного сохранения (Debian-based системы):
echo "192.168.45.0/24 dev pgnet" >> /etc/network/interfaces.d/pgnet
```

### 2. Настройка iptables на Proxmox для NAT (если нужно):

Если вам нужен доступ из 192.168.87.0/24 в 192.168.45.0/24, включите форвардинг и настройте NAT:

```bash
# Включить IP forwarding
echo 1 > /proc/sys/net/ipv4/ip_forward

# Добавить правила iptables
iptables -t nat -A POSTROUTING -s 192.168.45.0/24 -o vmbr0 -j MASQUERADE
iptables -A FORWARD -i pgnet -o vmbr0 -j ACCEPT
iptables -A FORWARD -i vmbr0 -o pgnet -m state --state RELATED,ESTABLISHED -j ACCEPT

# Сохранить правила (для Debian-based)
apt install iptables-persistent
netfilter-persistent save
```


### 4. Настройка виртуальной машины (192.168.45.201):

Убедитесь, что у VM правильный шлюз:
```bash
ip route show
# Должно быть что-то вроде:
# default via 192.168.45.1 dev eth0
# 192.168.45.0/24 dev eth0 proto kernel scope link src 192.168.45.201
```

### 4. Проверка связи:

С ноутбука попробуйте:
```bash
ping 192.168.45.201
```
----

### 1. Проверка текущих маршрутов на ноуте (уже сделано)
```bash
ip route show
```
Вывод сейчас корректный:
```
default via 192.168.87.1 dev wlp1s0 proto dhcp src 192.168.87.135 metric 600 
192.168.87.0/24 dev wlp1s0 proto kernel scope link src 192.168.87.135 metric 600 
192.168.45.0/24 via 192.168.87.20 dev wlp1s0
```

### 2. Настройка постоянного маршрута ноуте (Ximper Linux)

#### Вариант A: Через NetworkManager (если используется)
```bash
# Узнаём имя подключения:
nmcli connection show

# Добавляем маршрут (пример для подключения 'Wired connection 1'):
sudo nmcli connection modify "Wired connection 1" ipv4.routes "192.168.45.0/24 192.168.87.20"

# Применяем изменения:
sudo nmcli connection down "Wired connection 1" && sudo nmcli connection up "Wired connection 1"
```

#### Вариант B: Через конфигурационные файлы (если NetworkManager не используется)
Создаём файл маршрутов:
```bash
sudo nano /etc/sysconfig/network-scripts/route-wlp1s0
```
Добавляем строку:
```
192.168.45.0/24 via 192.168.87.20 dev wlp1s0
```

Или альтернативно (для systemd-networkd):
```bash
sudo mkdir -p /etc/systemd/network
sudo nano /etc/systemd/network/50-wireless.network
```
Добавьте в секцию `[Route]`:
```
[Route]
Destination=192.168.45.0/24
Gateway=192.168.87.20
```

### 3. Проверка связи
```bash
ping 192.168.45.201 -c 4
traceroute 192.168.45.201
```

### 4. Если ping не работает - диагностика:

На Proxmox проверьте:
```bash
# Проверка форвардинга:
sudo sysctl net.ipv4.ip_forward

# Временное включение если выключен:
sudo sysctl -w net.ipv4.ip_forward=1

# Проверка iptables:
sudo iptables -L -n -v
sudo iptables -t nat -L -n -v

# Добавление правил если нужно:
sudo iptables -A FORWARD -i pgnet -o vmbr0 -j ACCEPT
sudo iptables -A FORWARD -i vmbr0 -o pgnet -m state --state RELATED,ESTABLISHED -j ACCEPT
sudo iptables -t nat -A POSTROUTING -o vmbr0 -j MASQUERADE
```

### 5. Для полной очистки и перезагрузки сети:
```bash
sudo systemctl restart NetworkManager  # или network.service
sudo ip route flush cache
```

Для Ximper Linux также можно проверить наличие специфичных сетевых утилит:
```bash
cat /etc/ximper-release  # или аналогичный файл для определения точной версии
```




### Важные замечания:

1. Ваш текущий маршрут на ноутбуке `192.168.45.0/24 via 192.168.87.1` неверный - он должен вести через Proxmox (192.168.87.20)

2. На Proxmox интерфейс pgnet не имеет IPv4 адреса, что может вызвать проблемы. Возможно, стоит назначить ему адрес:
```bash
ip addr add 192.168.45.1/24 dev pgnet
```

3. Если используется firewalld/ufw, нужно добавить соответствующие правила.

4. Для постоянного сохранения настроек на Proxmox, добавьте их в `/etc/network/interfaces` в конфигурацию pgnet.

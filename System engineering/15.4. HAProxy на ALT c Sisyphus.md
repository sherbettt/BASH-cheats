##  –ß—Ç–æ –º—ã —Å–¥–µ–ª–∞–ª–∏ –Ω–∞ ALT Linux —Å "–°–∏–∑–∏—Ñ–æ–º"

### **–¶–µ–ª—å:**
–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å HAProxy –∫–∞–∫ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫ –Ω–∞–≥—Ä—É–∑–∫–∏ –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –µ–≥–æ —Ä–∞–±–æ—Ç—ã –ø–µ—Ä–µ–¥ –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π —Å PostgreSQL

---

## **–í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –∏ –¥–µ–π—Å—Ç–≤–∏—è:**

### **1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ HAProxy**
```bash
apt install -y haproxy haproxy-cmd hatop
```
- –£—Å—Ç–∞–Ω–æ–≤–∏–ª–∏ –æ—Å–Ω–æ–≤–Ω–æ–π –ø–∞–∫–µ—Ç + —É—Ç–∏–ª–∏—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### **2. –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏**
```bash
cat /etc/haproxy/haproxy.cfg
```

<details>
<summary>‚ùó /etc/haproxy/haproxy.cfg ‚ùó</summary>
  
```cfg
#---------------------------------------------------------------------
# Example configuration for a possible web application.  See the
# full configuration options online.
#
#   http://haproxy.1wt.eu/download/1.4/doc/configuration.txt
#
#---------------------------------------------------------------------

#---------------------------------------------------------------------
# Global settings
#---------------------------------------------------------------------
global
    # log to /dev/log
    log /dev/log daemon

    # log to local syslogd from chroot over UDP
    #log         127.0.0.1:514 local2
    #log         tcp@127.0.0.1:514 local2 notice

    # send log to systemd-journald
    #log stdout format short daemon

    chroot      /var/lib/haproxy
    pidfile     /run/haproxy.pid
    maxconn     4000
    user        _haproxy
    group       _haproxy
    daemon

    # turn on stats unix socket
    stats socket /var/lib/haproxy/stats

#---------------------------------------------------------------------
# common defaults that all the 'listen' and 'backend' sections will
# use if not designated in their block
#---------------------------------------------------------------------
defaults
    mode                    http
    log                     global
    option                  httplog
    option                  dontlognull
    option http-server-close
    option forwardfor       except 127.0.0.0/8
    option                  redispatch
    retries                 3
    timeout http-request    10s
    timeout queue           1m
    timeout connect         10s
    timeout client          1m
    timeout server          1m
    timeout http-keep-alive 10s
    timeout check           10s
    maxconn                 3000

#---------------------------------------------------------------------
# main frontend which proxys to the backends
#---------------------------------------------------------------------
frontend main
    bind *:5000
    acl url_static       path_beg       -i /static /images /javascript /stylesheets
    acl url_static       path_end       -i .jpg .gif .png .css .js

    use_backend static          if url_static
    default_backend             app

#---------------------------------------------------------------------
# static backend for serving up images, stylesheets and such
#---------------------------------------------------------------------
backend static
    balance     roundrobin
    server      static 127.0.0.1:4331 check

#---------------------------------------------------------------------
# round robin balancing between the various backends
#---------------------------------------------------------------------
backend app
    balance     roundrobin
    server  app1 127.0.0.1:5001 check
    server  app2 127.0.0.1:5002 check
    server  app3 127.0.0.1:5003 check
    server  app4 127.0.0.1:5004 check

```
</details> 
<br/>



### **3. –ó–∞–ø—É—Å–∫ –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞**
```bash
systemctl status haproxy
```
- –û–±–Ω–∞—Ä—É–∂–∏–ª–∏ —á—Ç–æ –±—ç–∫–µ–Ω–¥—ã –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã ("Connection refused")

### **4. –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤—ã—Ö –±—ç–∫–µ–Ω–¥–æ–≤**
```bash
# –ó–∞–ø—É—Å—Ç–∏–ª–∏ Python HTTP —Å–µ—Ä–≤–µ—Ä—ã –∫–∞–∫ –±—ç–∫–µ–Ω–¥—ã
python3 -m http.server 4331 --directory /var/www/html &
python3 -m http.server 5001 --directory /var/www/html &

ps aux | grep python
ss -tlnp | grep python

# –∞ —á—Ç–æ–±—ã –ø–æ—Å–ª–µ —É–¥–∞–ª–∏—Ç—å –¥–∂–æ–±—ã
jobs
fg %1  # –∞ –∑–∞—Ç–µ–º  Ctrl + C
kill %1 %2
killall %%
```

### **5. –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞**
```bash
mkdir -p /var/www/html
echo '<h1>Hello from HAProxy on ALT Sisyphus!</h1><p>Server: '$(hostname)'</p>' > /var/www/html/index.html
```

### **6. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã**
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –±—ç–∫–µ–Ω–¥–æ–≤
curl http://localhost:5000/

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏
for i in {1..5}; do
  echo "Request $i:"
  curl -s http://localhost:5000/ | grep "Hello"
done
```

---

##  **–ß—Ç–æ –º—ã –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–ª–∏ –∏ –∑–∞—á–µ–º:**

### **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–∞:**
```
–ö–ª–∏–µ–Ω—Ç—ã ‚Üí HAProxy:5000 ‚Üí Python HTTP —Å–µ—Ä–≤–µ—Ä—ã (4331, 5001-5004)
                    ‚Üì
            –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –ø–æ roundrobin
```

### **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ:**
```bash
frontend main
    bind *:5000                    # –°–ª—É—à–∞–µ–º –ø–æ—Ä—Ç 5000
    acl url_static path_beg -i /static  # –ü—Ä–∞–≤–∏–ª–æ –¥–ª—è —Å—Ç–∞—Ç–∏–∫–∏
    use_backend static if url_static    # –°—Ç–∞—Ç–∏–∫–∞ ‚Üí –ø–æ—Ä—Ç 4331  
    default_backend app                 # –û—Å—Ç–∞–ª—å–Ω–æ–µ ‚Üí –ø–æ—Ä—Ç—ã 5001-5004

backend static
    server static 127.0.0.1:4331 check  # –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç

backend app  
    server app1 127.0.0.1:5001 check    # 4 –ø—Ä–∏–∫–ª–∞–¥–Ω—ã—Ö —Å–µ—Ä–≤–µ—Ä–∞
    server app2 127.0.0.1:5002 check
    server app3 127.0.0.1:5003 check  
    server app4 127.0.0.1:5004 check
```

---

## üîç **–ü—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ—Ç–æ—Ä—ã–µ –º—ã —Å–æ–≤–µ—Ä—à–∏–ª–∏:**

1. **‚úÖ Health Checks** - HAProxy –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –±—ç–∫–µ–Ω–¥–æ–≤
2. **‚úÖ –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞** - –∑–∞–ø—Ä–æ—Å—ã —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –º–µ–∂–¥—É —Å–µ—Ä–≤–µ—Ä–∞–º–∏
3. **‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** - –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã—Ö –±—ç–∫–µ–Ω–¥–∞—Ö –ª–æ–≥–∏—Ä—É–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
4. **‚úÖ –ü—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ** - –∑–∞–ø—Ä–æ—Å—ã —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ HAProxy –∫ –±—ç–∫–µ–Ω–¥–∞–º
5. **‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** - —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –∫–æ–Ω—Ñ–∏–≥–∞ –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω

---

## **–ü–æ—á–µ–º—É –∏–º–µ–Ω–Ω–æ —Ç–∞–∫–æ–π –∫–æ–Ω—Ñ–∏–≥?**

**–≠—Ç–æ —É—á–µ–±–Ω—ã–π –ø—Ä–∏–º–µ—Ä –æ—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ ALT Linux**, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:

- **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Ç—Ä–∞—Ñ–∏–∫–∞** - —Å—Ç–∞—Ç–∏–∫–∞ vs –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç
- **–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –±—ç–∫–µ–Ω–¥—ã** - –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–º—É –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—é  
- **–ì–æ—Ç–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏** - timeout, retries, –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞
- **–ü—Ä–æ—Å—Ç–æ—Ç–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è** - –ª–æ–∫–∞–ª—å–Ω—ã–µ –ø–æ—Ä—Ç—ã –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏

---

## **–†–µ–∑—É–ª—å—Ç–∞—Ç –æ–±—É—á–µ–Ω–∏—è:**

–¢–µ–ø–µ—Ä—å –º—ã –ø–æ–Ω–∏–º–∞–µ–º –∫–∞–∫ HAProxy:
- ‚úÖ **–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Å–µ—Ä–≤–µ—Ä—ã** —á–µ—Ä–µ–∑ health checks
- ‚úÖ **–ë–∞–ª–∞–Ω—Å–∏—Ä—É–µ—Ç –Ω–∞–≥—Ä—É–∑–∫—É** –º–µ–∂–¥—É –±—ç–∫–µ–Ω–¥–∞–º–∏
- ‚úÖ **–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø—Ä–∞–≤–∏–ª–∞ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏** (ACL)
- ‚úÖ **–†–∞–±–æ—Ç–∞–µ—Ç —Å —Ä–∞–∑–Ω—ã–º–∏ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞–º–∏** (HTTP –≤ –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ)


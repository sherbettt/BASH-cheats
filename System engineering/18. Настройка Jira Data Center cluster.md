**Читай статью с оф. сайта: [Set up a Jira Data Center cluster](https://confluence.atlassian.com/adminjiraserver/set-up-a-jira-data-center-cluster-993929600.html)**

## 1. Клонирование LXC с Jira

**1) Через GUI.**
Как всегда заходим в [ProxMox](https://192.168.87.6:8006/#v1:0:=lxc%2F169:4::=contentIso:::8:11:), 
ищем контейнер ***Container 169 (jira-new) on node 'prox4'***, в браузере по F12 определяем  IP адрес Jira (192.168.87.219:443), проверяем с помощью nmap. 
Создаём снепшот и после - клонируем машину, присваивая ей новое имя.


**2) Через pvesh.**
  <br/> Проверяем на всякий случай:
```bash
# зайти
ssh root@192.168.87.17  # prox4
# утилита и команды
pvesh get /nodes/prox4/lxc/169/config
pvesh get /nodes/prox4/lxc/169/interfaces  # 192.168.87.219/24
pvesh get /nodes/prox4/storage  # проверить все места хранения
```

Создаём снепшот:
```bash
# Создаём там же, где и контейнер, на ssd_1tb
# pvesh
pvesh create /nodes/prox4/lxc/169/snapshot \
    --snapname "before-update" \
    --description "Снэпшот перед обновлением Jira"

# pct
pct snapshot 169 "backup-2024" --description "Резервная копия на 2024 год" --vmstate --live
```

Клонируем:
```bash
pvesh create /nodes/prox4/lxc/169/clone \
    --newid 181 \
    --storage ssd_1tb \
    --hostname jira-cluster
```

**2) Через pct.**
  <br/> Если `pvesh` не работает, можно использовать `pct` (Proxmox Container Toolkit):
```bash
pct clone 169 181 \
    --storage ssd_1tb \
    --hostname jira-cluster
```

В результате получаем ***Container 181 (jira-cluster) on node 'prox4'*** c IP = 192.168.87.140/24 (желательно выдать static IP).
<br/>
<br/>


## 2. NFS: установка 
Читай **[16. NFS. autofs, Сетевое хранилище](https://github.com/sherbettt/BASH-cheats/blob/main/16.%20NFS.%20autofs,%20Сетевое%20хранилище.md)**
### 1. Установка на сервере jira-cluster (192.168.87.140):
```bash
apt install nfs-kernel-server
 # или
apt install autofs
# проверить
nfsstat -v
cat /proc/fs/nfs/exports
dpkg -l | grep nfs  # модули ядра
```

### 2. Установка на сервере jira-new (192.168.87.219):
```bash
apt update -y && apt upgrade -y
apt install nfs-common
```
<br/>

## 3. NFS: настройка
### 1. Настройка на сервере jira-cluster:
```bash
# настройка NFS на сервере jira-cluster
sudo apt-get install nfs-kernel-server
sudo mkdir -p /srv/jira/shared
sudo chown -R jira:jira /srv/jira/shared
echo "/srv/jira/shared *(rw,sync,no_subtree_check)" | sudo tee -a /etc/exports 
sudo exportfs -a
```
Либо руками пишем в `/etc/exports` или `/etc/fstab`:
```conf
/srv/jira/shared 192.168.87.219/24(rw,sync,no_subtree_check,no_root_squash)
```
Где:
- **/srv/jira/shared** – экспортируемая папка
- **192.168.87.219/24** – разрешенные клиенты (можно указать конкретный IP или * для всех)
- **rw** – чтение и запись
- **sync** – синхронная запись
- **no_subtree_check** – отключает проверку поддеревьев (улучшает производительность)
- **no_root_squash** – позволяет root-пользователю клиента иметь root-права (осторожно!)


### 2. Настройка на сервере jira-new:
```bash
# создать папку для монтирования
sudo mkdir -p /mnt/nfs_share
# примонтировать
sudo mount -t nfs 192.168.87.140:/srv/nfs/share /mnt/nfs_share
```

Настройка на сервере jira-new
```bash

```

<br/>
<br/>



## 3. Конфигурирование Jira




# Инструкция: Поиск IP-адреса виртуальной машины в Proxmox

## Ситуация
Имеется запущенная VM в Proxmox, но неизвестен её IP-адрес (нет статической настройки в конфигурации).

## Последовательность действий

### 1. **Получение MAC-адреса виртуальной машины**
```bash
# Просмотр конфигурации VM
qm config <VMID>

# Или конкретно сетевых настроек
qm config <VMID> | grep net0
```
**Пример вывода:**
```
net0: virtio=4E:E1:B4:64:7C:8F,bridge=vmbr0,firewall=1
```
**Результат:** MAC-адрес = `4E:E1:B4:64:7C:8F`

---

### 2. **Определение сетевого интерфейса хоста**
```bash
# Просмотр сетевых интерфейсов
ip addr show

# Или конкретно bridge интерфейса
ip addr show vmbr0
```
**Результат:** Сеть = `192.168.87.0/24`

---

### 3. **Поиск IP по MAC-адресу в сети**

#### Способ A: Через ARP таблицу
```bash
# Просмотр всей ARP таблицы
arp -a

# Поиск по конкретному MAC
arp -a | grep -i "4e:e1:b4:64:7c:8f"

# Альтернативный вариант
ip neigh show | grep -i "4E:E1:B4:64:7C:8F"
```

#### Способ B: Сканирование сети (если ARP не сработал)
```bash
# Установка arp-scan (если не установлен)
apt update && apt install arp-scan

# Сканирование сети
arp-scan --interface=vmbr0 --localnet
```
**Ищем в выводе:**
```
192.168.87.132  4e:e1:b4:64:7c:8f       (Unknown: locally administered)
```

---

### 4. **Проверка доступности найденного IP**
```bash
# Проверка ping
ping 192.168.87.132

# Проверка открытых портов (SSH)
nmap -p 22 192.168.87.132
```

---

### 5. **Подключение к виртуальной машине**

#### Вариант A: По SSH
```bash
ssh username@192.168.87.132
```

#### Вариант B: Через веб-консоль Proxmox
- Веб-интерфейс Proxmox → VM → Console → noVNC

#### Вариант C: Через терминал Proxmox
```bash
qm terminal <VMID>
```

---

## Быстрая команда для поиска (все в одной строке)
```bash
MAC=$(qm config <VMID> | grep net0 | awk -F'=' '{print $2}' | awk -F',' '{print $1}') && arp-scan --interface=vmbr0 --localnet | grep -i "$MAC"
```

---

## Для предотвращения проблемы в будущем

### Настройка статического IP в Proxmox:
```bash
qm set <VMID> --ipconfig0 ip=192.168.87.132/24,gw=192.168.87.1
```

### Или в гостевой ОС настроить статический IP.

---

## Ключевые моменты
1. **MAC-адрес** - уникальный идентификатор сетевого интерфейса
2. **ARP-таблица** - связывает IP и MAC адреса в локальной сети  
3. **ARP-scan** - активно ищет все устройства в сети
4. **Bridge интерфейс** - виртуальный коммутатор Proxmox

Эта методика работает для любых VM в Proxmox при условии, что они находятся в той же сети, что и хост.
